(()=>{function xt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function we(e,t=""){if(!Number.isSafeInteger(e)||e<0){let n=t&&`"${t}" `;throw new Error(`${n}expected integer >= 0, got ${e}`)}}function D(e,t,n=""){let r=xt(e),o=e?.length,s=t!==void 0;if(!r||s&&o!==t){let i=n&&`"${n}" `,a=s?` of length ${t}`:"",c=r?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return e}function Ge(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash must wrapped by utils.createHasher");we(e.outputLen),we(e.blockLen)}function st(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function po(e,t){D(e,void 0,"digestInto() output");let n=t.outputLen;if(e.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function Ue(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Ht(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function ke(e,t){return e<<32-t|e>>>t}var yo=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Xi=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function N(e){if(D(e),yo)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=Xi[e[n]];return t}var Ie={_0:48,_9:57,A:65,F:70,a:97,f:102};function ho(e){if(e>=Ie._0&&e<=Ie._9)return e-Ie._0;if(e>=Ie.A&&e<=Ie.F)return e-(Ie.A-10);if(e>=Ie.a&&e<=Ie.f)return e-(Ie.a-10)}function O(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(yo)return Uint8Array.fromHex(e);let t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){let i=ho(e.charCodeAt(s)),a=ho(e.charCodeAt(s+1));if(i===void 0||a===void 0){let c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[o]=i*16+a}return r}function J(...e){let t=0;for(let r=0;r<e.length;r++){let o=e[r];D(o),t+=o.length}let n=new Uint8Array(t);for(let r=0,o=0;r<e.length;r++){let s=e[r];n.set(s,o),o+=s.length}return n}function go(e,t={}){let n=(o,s)=>e(s).update(o).digest(),r=e(void 0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=o=>e(o),Object.assign(n,t),Object.freeze(n)}function he(e=32){let t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}var wo=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});function bo(e,t,n){return e&t^~e&n}function mo(e,t,n){return e&t^e&n^t&n}var qt=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(t,n,r,o){this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.buffer=new Uint8Array(t),this.view=Ht(this.buffer)}update(t){st(this),D(t);let{view:n,buffer:r,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=Ht(t);for(;o<=s-i;i+=o)this.process(c,i);continue}r.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){st(this),po(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,Ue(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(r,0),i=0);for(let f=i;f<o;f++)n[f]=0;r.setBigUint64(o-8,BigInt(this.length*8),s),this.process(r,0);let a=Ht(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)a.setUint32(4*f,u[f],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||=new this.constructor,t.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:a}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=a,o%n&&t.buffer.set(r),t}clone(){return this._cloneInto()}},Pe=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var Qi=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),He=new Uint32Array(64),Un=class extends qt{constructor(t){super(64,t,8,!1)}get(){let{A:t,B:n,C:r,D:o,E:s,F:i,G:a,H:c}=this;return[t,n,r,o,s,i,a,c]}set(t,n,r,o,s,i,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,n){for(let f=0;f<16;f++,n+=4)He[f]=t.getUint32(n,!1);for(let f=16;f<64;f++){let h=He[f-15],d=He[f-2],p=ke(h,7)^ke(h,18)^h>>>3,g=ke(d,17)^ke(d,19)^d>>>10;He[f]=g+He[f-7]+p+He[f-16]|0}let{A:r,B:o,C:s,D:i,E:a,F:c,G:l,H:u}=this;for(let f=0;f<64;f++){let h=ke(a,6)^ke(a,11)^ke(a,25),d=u+h+bo(a,c,l)+Qi[f]+He[f]|0,g=(ke(r,2)^ke(r,13)^ke(r,22))+mo(r,o,s)|0;u=l,l=c,c=a,a=i+d|0,i=s,s=o,o=r,r=d+g|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,o,s,i,a,c,l,u)}roundClean(){Ue(He)}destroy(){this.set(0,0,0,0,0,0,0,0),Ue(this.buffer)}},Pn=class extends Un{A=Pe[0]|0;B=Pe[1]|0;C=Pe[2]|0;D=Pe[3]|0;E=Pe[4]|0;F=Pe[5]|0;G=Pe[6]|0;H=Pe[7]|0;constructor(){super(32)}};var X=go(()=>new Pn,wo(1));var On=BigInt(0),Cn=BigInt(1);function vt(e,t=""){if(typeof e!="boolean"){let n=t&&`"${t}" `;throw new Error(n+"expected boolean, got type="+typeof e)}return e}function xo(e){if(typeof e=="bigint"){if(!Kt(e))throw new Error("positive bigint expected, got "+e)}else we(e);return e}function Et(e){let t=xo(e).toString(16);return t.length&1?"0"+t:t}function vo(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?On:BigInt("0x"+e)}function qe(e){return vo(N(e))}function Nn(e){return vo(N(ea(D(e)).reverse()))}function $t(e,t){we(t),e=xo(e);let n=O(e.toString(16).padStart(t*2,"0"));if(n.length!==t)throw new Error("number too large");return n}function Mn(e,t){return $t(e,t).reverse()}function ea(e){return Uint8Array.from(e)}function Eo(e){return Uint8Array.from(e,(t,n)=>{let r=t.charCodeAt(0);if(t.length!==1||r>127)throw new Error(`string contains non-ASCII character "${e[n]}" with code ${r} at position ${n}`);return r})}var Kt=e=>typeof e=="bigint"&&On<=e;function ta(e,t,n){return Kt(e)&&Kt(t)&&Kt(n)&&t<=e&&e<n}function ko(e,t,n,r){if(!ta(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function Dn(e){let t;for(t=0;e>On;e>>=Cn,t+=1);return t}var kt=e=>(Cn<<BigInt(e))-Cn;function _o(e,t,n){if(we(e,"hashLen"),we(t,"qByteLen"),typeof n!="function")throw new Error("hmacFn must be a function");let r=w=>new Uint8Array(w),o=Uint8Array.of(),s=Uint8Array.of(0),i=Uint8Array.of(1),a=1e3,c=r(e),l=r(e),u=0,f=()=>{c.fill(1),l.fill(0),u=0},h=(...w)=>n(l,J(c,...w)),d=(w=o)=>{l=h(s,w),c=h(),w.length!==0&&(l=h(i,w),c=h())},p=()=>{if(u++>=a)throw new Error("drbg: tried max amount of iterations");let w=0,v=[];for(;w<t;){c=h();let S=c.slice();v.push(S),w+=c.length}return J(...v)};return(w,v)=>{f(),d(w);let S;for(;!(S=v(p()));)d();return f(),S}}function _t(e,t={},n={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function r(s,i,a){let c=e[s];if(a&&c===void 0)return;let l=typeof c;if(l!==i||c===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${l}`)}let o=(s,i)=>Object.entries(s).forEach(([a,c])=>r(a,c,i));o(t,!1),o(n,!0)}function Hn(e){let t=new WeakMap;return(n,...r)=>{let o=t.get(n);if(o!==void 0)return o;let s=e(n,...r);return t.set(n,s),s}}var ue=BigInt(0),le=BigInt(1),Fe=BigInt(2),Ao=BigInt(3),Ro=BigInt(4),To=BigInt(5),na=BigInt(7),Lo=BigInt(8),ra=BigInt(9),Io=BigInt(16);function _e(e,t){let n=e%t;return n>=ue?n:t+n}function pe(e,t,n){let r=e;for(;t-- >ue;)r*=r,r%=n;return r}function Bo(e,t){if(e===ue)throw new Error("invert: expected non-zero number");if(t<=ue)throw new Error("invert: expected positive modulus, got "+t);let n=_e(e,t),r=t,o=ue,s=le,i=le,a=ue;for(;n!==ue;){let l=r/n,u=r%n,f=o-i*l,h=s-a*l;r=n,n=u,o=i,s=a,i=f,a=h}if(r!==le)throw new Error("invert: does not exist");return _e(o,t)}function Kn(e,t,n){if(!e.eql(e.sqr(t),n))throw new Error("Cannot find square root")}function Uo(e,t){let n=(e.ORDER+le)/Ro,r=e.pow(t,n);return Kn(e,r,t),r}function oa(e,t){let n=(e.ORDER-To)/Lo,r=e.mul(t,Fe),o=e.pow(r,n),s=e.mul(t,o),i=e.mul(e.mul(s,Fe),o),a=e.mul(s,e.sub(i,e.ONE));return Kn(e,a,t),a}function sa(e){let t=it(e),n=Po(e),r=n(t,t.neg(t.ONE)),o=n(t,r),s=n(t,t.neg(r)),i=(e+na)/Io;return(a,c)=>{let l=a.pow(c,i),u=a.mul(l,r),f=a.mul(l,o),h=a.mul(l,s),d=a.eql(a.sqr(u),c),p=a.eql(a.sqr(f),c);l=a.cmov(l,u,d),u=a.cmov(h,f,p);let g=a.eql(a.sqr(u),c),w=a.cmov(l,u,g);return Kn(a,w,c),w}}function Po(e){if(e<Ao)throw new Error("sqrt is not defined for small field");let t=e-le,n=0;for(;t%Fe===ue;)t/=Fe,n++;let r=Fe,o=it(e);for(;So(o,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Uo;let s=o.pow(r,t),i=(t+le)/Fe;return function(c,l){if(c.is0(l))return l;if(So(c,l)!==1)throw new Error("Cannot find square root");let u=n,f=c.mul(c.ONE,s),h=c.pow(l,t),d=c.pow(l,i);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let p=1,g=c.sqr(h);for(;!c.eql(g,c.ONE);)if(p++,g=c.sqr(g),p===u)throw new Error("Cannot find square root");let w=le<<BigInt(u-p-1),v=c.pow(f,w);u=p,f=c.sqr(v),h=c.mul(h,f),d=c.mul(d,v)}return d}}function ia(e){return e%Ro===Ao?Uo:e%Lo===To?oa:e%Io===ra?sa(e):Po(e)}var aa=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function $n(e){let t={ORDER:"bigint",BYTES:"number",BITS:"number"},n=aa.reduce((r,o)=>(r[o]="function",r),t);return _t(e,n),e}function ca(e,t,n){if(n<ue)throw new Error("invalid exponent, negatives unsupported");if(n===ue)return e.ONE;if(n===le)return t;let r=e.ONE,o=t;for(;n>ue;)n&le&&(r=e.mul(r,o)),o=e.sqr(o),n>>=le;return r}function Vt(e,t,n=!1){let r=new Array(t.length).fill(n?e.ZERO:void 0),o=t.reduce((i,a,c)=>e.is0(a)?i:(r[c]=i,e.mul(i,a)),e.ONE),s=e.inv(o);return t.reduceRight((i,a,c)=>e.is0(a)?i:(r[c]=e.mul(i,r[c]),e.mul(i,a)),s),r}function So(e,t){let n=(e.ORDER-le)/Fe,r=e.pow(t,n),o=e.eql(r,e.ONE),s=e.eql(r,e.ZERO),i=e.eql(r,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function la(e,t){t!==void 0&&we(t);let n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}var qn=class{ORDER;BITS;BYTES;isLE;ZERO=ue;ONE=le;_lengths;_sqrt;_mod;constructor(t,n={}){if(t<=ue)throw new Error("invalid field: expected ORDER > 0, got "+t);let r;this.isLE=!1,n!=null&&typeof n=="object"&&(typeof n.BITS=="number"&&(r=n.BITS),typeof n.sqrt=="function"&&(this.sqrt=n.sqrt),typeof n.isLE=="boolean"&&(this.isLE=n.isLE),n.allowedLengths&&(this._lengths=n.allowedLengths?.slice()),typeof n.modFromBytes=="boolean"&&(this._mod=n.modFromBytes));let{nBitLength:o,nByteLength:s}=la(t,r);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=t,this.BITS=o,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(t){return _e(t,this.ORDER)}isValid(t){if(typeof t!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof t);return ue<=t&&t<this.ORDER}is0(t){return t===ue}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}isOdd(t){return(t&le)===le}neg(t){return _e(-t,this.ORDER)}eql(t,n){return t===n}sqr(t){return _e(t*t,this.ORDER)}add(t,n){return _e(t+n,this.ORDER)}sub(t,n){return _e(t-n,this.ORDER)}mul(t,n){return _e(t*n,this.ORDER)}pow(t,n){return ca(this,t,n)}div(t,n){return _e(t*Bo(n,this.ORDER),this.ORDER)}sqrN(t){return t*t}addN(t,n){return t+n}subN(t,n){return t-n}mulN(t,n){return t*n}inv(t){return Bo(t,this.ORDER)}sqrt(t){return this._sqrt||(this._sqrt=ia(this.ORDER)),this._sqrt(this,t)}toBytes(t){return this.isLE?Mn(t,this.BYTES):$t(t,this.BYTES)}fromBytes(t,n=!1){D(t);let{_lengths:r,BYTES:o,isLE:s,ORDER:i,_mod:a}=this;if(r){if(!r.includes(t.length)||t.length>o)throw new Error("Field.fromBytes: expected "+r+" bytes, got "+t.length);let l=new Uint8Array(o);l.set(t,s?0:l.length-t.length),t=l}if(t.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);let c=s?Nn(t):qe(t);if(a&&(c=_e(c,i)),!n&&!this.isValid(c))throw new Error("invalid field element: outside of range 0..ORDER");return c}invertBatch(t){return Vt(this,t)}cmov(t,n,r){return r?n:t}};function it(e,t={}){return new qn(e,t)}function Co(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Vn(e){let t=Co(e);return t+Math.ceil(t/2)}function Wt(e,t,n=!1){D(e);let r=e.length,o=Co(t),s=Vn(t);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);let i=n?Nn(e):qe(e),a=_e(i,t-le)+le;return n?Mn(a,o):$t(a,o)}var at=BigInt(0),Je=BigInt(1);function Bt(e,t){let n=t.negate();return e?n:t}function Zn(e,t){let n=Vt(e.Fp,t.map(r=>r.Z));return t.map((r,o)=>e.fromAffine(r.toAffine(n[o])))}function Do(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Wn(e,t){Do(e,t);let n=Math.ceil(t/e)+1,r=2**(e-1),o=2**e,s=kt(e),i=BigInt(e);return{windows:n,windowSize:r,mask:s,maxNumber:o,shiftBy:i}}function Oo(e,t,n){let{windowSize:r,mask:o,maxNumber:s,shiftBy:i}=n,a=Number(e&o),c=e>>i;a>r&&(a-=s,c+=Je);let l=t*r,u=l+Math.abs(a)-1,f=a===0,h=a<0,d=t%2!==0;return{nextN:c,offset:u,isZero:f,isNeg:h,isNegF:d,offsetF:l}}var zn=new WeakMap,Ho=new WeakMap;function jn(e){return Ho.get(e)||1}function No(e){if(e!==at)throw new Error("invalid wNAF")}var zt=class{BASE;ZERO;Fn;bits;constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,r=this.ZERO){let o=t;for(;n>at;)n&Je&&(r=r.add(o)),o=o.double(),n>>=Je;return r}precomputeWindow(t,n){let{windows:r,windowSize:o}=Wn(n,this.bits),s=[],i=t,a=i;for(let c=0;c<r;c++){a=i,s.push(a);for(let l=1;l<o;l++)a=a.add(i),s.push(a);i=a.double()}return s}wNAF(t,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=Wn(t,this.bits);for(let a=0;a<i.windows;a++){let{nextN:c,offset:l,isZero:u,isNeg:f,isNegF:h,offsetF:d}=Oo(r,a,i);r=c,u?s=s.add(Bt(h,n[d])):o=o.add(Bt(f,n[l]))}return No(r),{p:o,f:s}}wNAFUnsafe(t,n,r,o=this.ZERO){let s=Wn(t,this.bits);for(let i=0;i<s.windows&&r!==at;i++){let{nextN:a,offset:c,isZero:l,isNeg:u}=Oo(r,i,s);if(r=a,!l){let f=n[c];o=o.add(u?f.negate():f)}}return No(r),o}getPrecomputes(t,n,r){let o=zn.get(n);return o||(o=this.precomputeWindow(n,t),t!==1&&(typeof r=="function"&&(o=r(o)),zn.set(n,o))),o}cached(t,n,r){let o=jn(t);return this.wNAF(o,this.getPrecomputes(o,t,r),n)}unsafe(t,n,r,o){let s=jn(t);return s===1?this._unsafeLadder(t,n,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,r),n,o)}createCache(t,n){Do(n,this.bits),Ho.set(t,n),zn.delete(t)}hasCache(t){return jn(t)!==1}};function qo(e,t,n,r){let o=t,s=e.ZERO,i=e.ZERO;for(;n>at||r>at;)n&Je&&(s=s.add(o)),r&Je&&(i=i.add(o)),o=o.double(),n>>=Je,r>>=Je;return{p1:s,p2:i}}function Mo(e,t,n){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return $n(t),t}else return it(e,{isLE:n})}function Ko(e,t,n={},r){if(r===void 0&&(r=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let c of["p","n","h"]){let l=t[c];if(!(typeof l=="bigint"&&l>at))throw new Error(`CURVE.${c} must be positive bigint`)}let o=Mo(t.p,n.Fp,r),s=Mo(t.n,n.Fn,r),a=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let c of a)if(!o.isValid(t[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}function jt(e,t){return function(r){let o=e(r);return{secretKey:o,publicKey:t(o)}}}var Zt=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,n){if(Ge(t),D(n,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let r=this.blockLen,o=new Uint8Array(r);o.set(n.length>r?t.create().update(n).digest():n);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),Ue(o)}update(t){return st(this),this.iHash.update(t),this}digestInto(t){st(this),D(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Se=(e,t,n)=>new Zt(e,t).update(n).digest();Se.create=(e,t)=>new Zt(e,t);var $o=(e,t)=>(e+(e>=0?t:-t)/Vo)/t;function ua(e,t,n){let[[r,o],[s,i]]=t,a=$o(i*e,n),c=$o(-o*e,n),l=e-a*r-c*s,u=-a*o-c*i,f=l<Ce,h=u<Ce;f&&(l=-l),h&&(u=-u);let d=kt(Math.ceil(Dn(n)/2))+ct;if(l<Ce||l>=d||u<Ce||u>=d)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:f,k1:l,k2neg:h,k2:u}}function Fn(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function Gn(e,t){let n={};for(let r of Object.keys(t))n[r]=e[r]===void 0?t[r]:e[r];return vt(n.lowS,"lowS"),vt(n.prehash,"prehash"),n.format!==void 0&&Fn(n.format),n}var Jn=class extends Error{constructor(t=""){super(t)}},Ke={Err:Jn,_tlv:{encode:(e,t)=>{let{Err:n}=Ke;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");let r=t.length/2,o=Et(r);if(o.length/2&128)throw new n("tlv.encode: long form length too big");let s=r>127?Et(o.length/2|128):"";return Et(e)+s+o+t},decode(e,t){let{Err:n}=Ke,r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");let o=t[r++],s=!!(o&128),i=0;if(!s)i=o;else{let c=o&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");let l=t.subarray(r,r+c);if(l.length!==c)throw new n("tlv.decode: length bytes not complete");if(l[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(let u of l)i=i<<8|u;if(r+=c,i<128)throw new n("tlv.decode(long): not minimal encoding")}let a=t.subarray(r,r+i);if(a.length!==i)throw new n("tlv.decode: wrong value length");return{v:a,l:t.subarray(r+i)}}},_int:{encode(e){let{Err:t}=Ke;if(e<Ce)throw new t("integer: negative integers are not allowed");let n=Et(e);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){let{Err:t}=Ke;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return qe(e)}},toSig(e){let{Err:t,_int:n,_tlv:r}=Ke,o=D(e,void 0,"signature"),{v:s,l:i}=r.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=r.decode(2,s),{v:l,l:u}=r.decode(2,c);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(l)}},hexFromSig(e){let{_tlv:t,_int:n}=Ke,r=t.encode(2,n.encode(e.r)),o=t.encode(2,n.encode(e.s)),s=r+o;return t.encode(48,s)}},Ce=BigInt(0),ct=BigInt(1),Vo=BigInt(2),Gt=BigInt(3),fa=BigInt(4);function Wo(e,t={}){let n=Ko("weierstrass",e,t),{Fp:r,Fn:o}=n,s=n.CURVE,{h:i,n:a}=s;_t(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});let{endo:c}=t;if(c&&(!r.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let l=jo(r,o);function u(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function f(I,m,b){let{x:y,y:E}=m.toAffine(),_=r.toBytes(y);if(vt(b,"isCompressed"),b){u();let B=!r.isOdd(E);return J(zo(B),_)}else return J(Uint8Array.of(4),_,r.toBytes(E))}function h(I){D(I,void 0,"Point");let{publicKey:m,publicKeyUncompressed:b}=l,y=I.length,E=I[0],_=I.subarray(1);if(y===m&&(E===2||E===3)){let B=r.fromBytes(_);if(!r.isValid(B))throw new Error("bad point: is not on curve, wrong x");let x=g(B),k;try{k=r.sqrt(x)}catch($){let q=$ instanceof Error?": "+$.message:"";throw new Error("bad point: is not on curve, sqrt error"+q)}u();let A=r.isOdd(k);return(E&1)===1!==A&&(k=r.neg(k)),{x:B,y:k}}else if(y===b&&E===4){let B=r.BYTES,x=r.fromBytes(_.subarray(0,B)),k=r.fromBytes(_.subarray(B,B*2));if(!w(x,k))throw new Error("bad point: is not on curve");return{x,y:k}}else throw new Error(`bad point: got length ${y}, expected compressed=${m} or uncompressed=${b}`)}let d=t.toBytes||f,p=t.fromBytes||h;function g(I){let m=r.sqr(I),b=r.mul(m,I);return r.add(r.add(b,r.mul(I,s.a)),s.b)}function w(I,m){let b=r.sqr(m),y=g(I);return r.eql(b,y)}if(!w(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let v=r.mul(r.pow(s.a,Gt),fa),S=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(v,S)))throw new Error("bad curve params: a or b");function U(I,m,b=!1){if(!r.isValid(m)||b&&r.is0(m))throw new Error(`bad point coordinate ${I}`);return m}function M(I){if(!(I instanceof L))throw new Error("Weierstrass Point expected")}function Q(I){if(!c||!c.basises)throw new Error("no endo");return ua(I,c.basises,o.ORDER)}let z=Hn((I,m)=>{let{X:b,Y:y,Z:E}=I;if(r.eql(E,r.ONE))return{x:b,y};let _=I.is0();m==null&&(m=_?r.ONE:r.inv(E));let B=r.mul(b,m),x=r.mul(y,m),k=r.mul(E,m);if(_)return{x:r.ZERO,y:r.ZERO};if(!r.eql(k,r.ONE))throw new Error("invZ was invalid");return{x:B,y:x}}),Y=Hn(I=>{if(I.is0()){if(t.allowInfinityPoint&&!r.is0(I.Y))return;throw new Error("bad point: ZERO")}let{x:m,y:b}=I.toAffine();if(!r.isValid(m)||!r.isValid(b))throw new Error("bad point: x or y not field elements");if(!w(m,b))throw new Error("bad point: equation left != right");if(!I.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function G(I,m,b,y,E){return b=new L(r.mul(b.X,I),b.Y,b.Z),m=Bt(y,m),b=Bt(E,b),m.add(b)}class L{static BASE=new L(s.Gx,s.Gy,r.ONE);static ZERO=new L(r.ZERO,r.ONE,r.ZERO);static Fp=r;static Fn=o;X;Y;Z;constructor(m,b,y){this.X=U("x",m),this.Y=U("y",b,!0),this.Z=U("z",y),Object.freeze(this)}static CURVE(){return s}static fromAffine(m){let{x:b,y}=m||{};if(!m||!r.isValid(b)||!r.isValid(y))throw new Error("invalid affine point");if(m instanceof L)throw new Error("projective point not allowed");return r.is0(b)&&r.is0(y)?L.ZERO:new L(b,y,r.ONE)}static fromBytes(m){let b=L.fromAffine(p(D(m,void 0,"point")));return b.assertValidity(),b}static fromHex(m){return L.fromBytes(O(m))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,b=!0){return H.createCache(this,m),b||this.multiply(Gt),this}assertValidity(){Y(this)}hasEvenY(){let{y:m}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(m)}equals(m){M(m);let{X:b,Y:y,Z:E}=this,{X:_,Y:B,Z:x}=m,k=r.eql(r.mul(b,x),r.mul(_,E)),A=r.eql(r.mul(y,x),r.mul(B,E));return k&&A}negate(){return new L(this.X,r.neg(this.Y),this.Z)}double(){let{a:m,b}=s,y=r.mul(b,Gt),{X:E,Y:_,Z:B}=this,x=r.ZERO,k=r.ZERO,A=r.ZERO,T=r.mul(E,E),$=r.mul(_,_),q=r.mul(B,B),C=r.mul(E,_);return C=r.add(C,C),A=r.mul(E,B),A=r.add(A,A),x=r.mul(m,A),k=r.mul(y,q),k=r.add(x,k),x=r.sub($,k),k=r.add($,k),k=r.mul(x,k),x=r.mul(C,x),A=r.mul(y,A),q=r.mul(m,q),C=r.sub(T,q),C=r.mul(m,C),C=r.add(C,A),A=r.add(T,T),T=r.add(A,T),T=r.add(T,q),T=r.mul(T,C),k=r.add(k,T),q=r.mul(_,B),q=r.add(q,q),T=r.mul(q,C),x=r.sub(x,T),A=r.mul(q,$),A=r.add(A,A),A=r.add(A,A),new L(x,k,A)}add(m){M(m);let{X:b,Y:y,Z:E}=this,{X:_,Y:B,Z:x}=m,k=r.ZERO,A=r.ZERO,T=r.ZERO,$=s.a,q=r.mul(s.b,Gt),C=r.mul(b,_),V=r.mul(y,B),F=r.mul(E,x),oe=r.add(b,y),W=r.add(_,B);oe=r.mul(oe,W),W=r.add(C,V),oe=r.sub(oe,W),W=r.add(b,E);let ce=r.add(_,x);return W=r.mul(W,ce),ce=r.add(C,F),W=r.sub(W,ce),ce=r.add(y,E),k=r.add(B,x),ce=r.mul(ce,k),k=r.add(V,F),ce=r.sub(ce,k),T=r.mul($,W),k=r.mul(q,F),T=r.add(k,T),k=r.sub(V,T),T=r.add(V,T),A=r.mul(k,T),V=r.add(C,C),V=r.add(V,C),F=r.mul($,F),W=r.mul(q,W),V=r.add(V,F),F=r.sub(C,F),F=r.mul($,F),W=r.add(W,F),C=r.mul(V,W),A=r.add(A,C),C=r.mul(ce,W),k=r.mul(oe,k),k=r.sub(k,C),C=r.mul(oe,V),T=r.mul(ce,T),T=r.add(T,C),new L(k,A,T)}subtract(m){return this.add(m.negate())}is0(){return this.equals(L.ZERO)}multiply(m){let{endo:b}=t;if(!o.isValidNot0(m))throw new Error("invalid scalar: out of range");let y,E,_=B=>H.cached(this,B,x=>Zn(L,x));if(b){let{k1neg:B,k1:x,k2neg:k,k2:A}=Q(m),{p:T,f:$}=_(x),{p:q,f:C}=_(A);E=$.add(C),y=G(b.beta,T,q,B,k)}else{let{p:B,f:x}=_(m);y=B,E=x}return Zn(L,[y,E])[0]}multiplyUnsafe(m){let{endo:b}=t,y=this;if(!o.isValid(m))throw new Error("invalid scalar: out of range");if(m===Ce||y.is0())return L.ZERO;if(m===ct)return y;if(H.hasCache(this))return this.multiply(m);if(b){let{k1neg:E,k1:_,k2neg:B,k2:x}=Q(m),{p1:k,p2:A}=qo(L,y,_,x);return G(b.beta,k,A,E,B)}else return H.unsafe(y,m)}toAffine(m){return z(this,m)}isTorsionFree(){let{isTorsionFree:m}=t;return i===ct?!0:m?m(L,this):H.unsafe(this,a).is0()}clearCofactor(){let{clearCofactor:m}=t;return i===ct?this:m?m(L,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(m=!0){return vt(m,"isCompressed"),this.assertValidity(),d(L,this,m)}toHex(m=!0){return N(this.toBytes(m))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let K=o.BITS,H=new zt(L,t.endo?Math.ceil(K/2):K);return L.BASE.precompute(8),L}function zo(e){return Uint8Array.of(e?2:3)}function jo(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function da(e,t={}){let{Fn:n}=e,r=t.randomBytes||he,o=Object.assign(jo(e.Fp,n),{seed:Vn(n.ORDER)});function s(d){try{let p=n.fromBytes(d);return n.isValidNot0(p)}catch{return!1}}function i(d,p){let{publicKey:g,publicKeyUncompressed:w}=o;try{let v=d.length;return p===!0&&v!==g||p===!1&&v!==w?!1:!!e.fromBytes(d)}catch{return!1}}function a(d=r(o.seed)){return Wt(D(d,o.seed,"seed"),n.ORDER)}function c(d,p=!0){return e.BASE.multiply(n.fromBytes(d)).toBytes(p)}function l(d){let{secretKey:p,publicKey:g,publicKeyUncompressed:w}=o;if(!xt(d)||"_lengths"in n&&n._lengths||p===g)return;let v=D(d,void 0,"key").length;return v===g||v===w}function u(d,p,g=!0){if(l(d)===!0)throw new Error("first arg must be private key");if(l(p)===!1)throw new Error("second arg must be public key");let w=n.fromBytes(d);return e.fromBytes(p).multiply(w).toBytes(g)}let f={isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:a},h=jt(a,c);return Object.freeze({getPublicKey:c,getSharedSecret:u,keygen:h,Point:e,utils:f,lengths:o})}function Zo(e,t,n={}){Ge(t),_t(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),n=Object.assign({},n);let r=n.randomBytes||he,o=n.hmac||((b,y)=>Se(t,b,y)),{Fp:s,Fn:i}=e,{ORDER:a,BITS:c}=i,{keygen:l,getPublicKey:u,getSharedSecret:f,utils:h,lengths:d}=da(e,n),p={prehash:!0,lowS:typeof n.lowS=="boolean"?n.lowS:!0,format:"compact",extraEntropy:!1},g=a*Vo<s.ORDER;function w(b){let y=a>>ct;return b>y}function v(b,y){if(!i.isValidNot0(y))throw new Error(`invalid signature ${b}: out of range 1..Point.Fn.ORDER`);return y}function S(){if(g)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function U(b,y){Fn(y);let E=d.signature,_=y==="compact"?E:y==="recovered"?E+1:void 0;return D(b,_)}class M{r;s;recovery;constructor(y,E,_){if(this.r=v("r",y),this.s=v("s",E),_!=null){if(S(),![0,1,2,3].includes(_))throw new Error("invalid recovery id");this.recovery=_}Object.freeze(this)}static fromBytes(y,E=p.format){U(y,E);let _;if(E==="der"){let{r:A,s:T}=Ke.toSig(D(y));return new M(A,T)}E==="recovered"&&(_=y[0],E="compact",y=y.subarray(1));let B=d.signature/2,x=y.subarray(0,B),k=y.subarray(B,B*2);return new M(i.fromBytes(x),i.fromBytes(k),_)}static fromHex(y,E){return this.fromBytes(O(y),E)}assertRecovery(){let{recovery:y}=this;if(y==null)throw new Error("invalid recovery id: must be present");return y}addRecoveryBit(y){return new M(this.r,this.s,y)}recoverPublicKey(y){let{r:E,s:_}=this,B=this.assertRecovery(),x=B===2||B===3?E+a:E;if(!s.isValid(x))throw new Error("invalid recovery id: sig.r+curve.n != R.x");let k=s.toBytes(x),A=e.fromBytes(J(zo((B&1)===0),k)),T=i.inv(x),$=z(D(y,void 0,"msgHash")),q=i.create(-$*T),C=i.create(_*T),V=e.BASE.multiplyUnsafe(q).add(A.multiplyUnsafe(C));if(V.is0())throw new Error("invalid recovery: point at infinify");return V.assertValidity(),V}hasHighS(){return w(this.s)}toBytes(y=p.format){if(Fn(y),y==="der")return O(Ke.hexFromSig(this));let{r:E,s:_}=this,B=i.toBytes(E),x=i.toBytes(_);return y==="recovered"?(S(),J(Uint8Array.of(this.assertRecovery()),B,x)):J(B,x)}toHex(y){return N(this.toBytes(y))}}let Q=n.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");let E=qe(y),_=y.length*8-c;return _>0?E>>BigInt(_):E},z=n.bits2int_modN||function(y){return i.create(Q(y))},Y=kt(c);function G(b){return ko("num < 2^"+c,b,Ce,Y),i.toBytes(b)}function L(b,y){return D(b,void 0,"message"),y?D(t(b),void 0,"prehashed message"):b}function K(b,y,E){let{lowS:_,prehash:B,extraEntropy:x}=Gn(E,p);b=L(b,B);let k=z(b),A=i.fromBytes(y);if(!i.isValidNot0(A))throw new Error("invalid private key");let T=[G(A),G(k)];if(x!=null&&x!==!1){let V=x===!0?r(d.secretKey):x;T.push(D(V,void 0,"extraEntropy"))}let $=J(...T),q=k;function C(V){let F=Q(V);if(!i.isValidNot0(F))return;let oe=i.inv(F),W=e.BASE.multiply(F).toAffine(),ce=i.create(W.x);if(ce===Ce)return;let Dt=i.create(oe*i.create(q+ce*A));if(Dt===Ce)return;let uo=(W.x===ce?0:2)|Number(W.y&ct),fo=Dt;return _&&w(Dt)&&(fo=i.neg(Dt),uo^=1),new M(ce,fo,g?void 0:uo)}return{seed:$,k2sig:C}}function H(b,y,E={}){let{seed:_,k2sig:B}=K(b,y,E);return _o(t.outputLen,i.BYTES,o)(_,B).toBytes(E.format)}function I(b,y,E,_={}){let{lowS:B,prehash:x,format:k}=Gn(_,p);if(E=D(E,void 0,"publicKey"),y=L(y,x),!xt(b)){let A=b instanceof M?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+A)}U(b,k);try{let A=M.fromBytes(b,k),T=e.fromBytes(E);if(B&&A.hasHighS())return!1;let{r:$,s:q}=A,C=z(y),V=i.inv(q),F=i.create(C*V),oe=i.create($*V),W=e.BASE.multiplyUnsafe(F).add(T.multiplyUnsafe(oe));return W.is0()?!1:i.create(W.x)===$}catch{return!1}}function m(b,y,E={}){let{prehash:_}=Gn(E,p);return y=L(y,_),M.fromBytes(b,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:f,utils:h,lengths:d,Point:e,sign:H,verify:I,recoverPublicKey:m,Signature:M,hash:t})}var Yt={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},ha={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},pa=BigInt(0),Yn=BigInt(2);function ya(e){let t=Yt.p,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,f=pe(u,n,t)*u%t,h=pe(f,n,t)*u%t,d=pe(h,Yn,t)*l%t,p=pe(d,o,t)*d%t,g=pe(p,s,t)*p%t,w=pe(g,a,t)*g%t,v=pe(w,c,t)*w%t,S=pe(v,a,t)*g%t,U=pe(S,n,t)*u%t,M=pe(U,i,t)*p%t,Q=pe(M,r,t)*l%t,z=pe(Q,Yn,t);if(!Ft.eql(Ft.sqr(z),e))throw new Error("Cannot find square root");return z}var Ft=it(Yt.p,{sqrt:ya}),Ye=Wo(Yt,{Fp:Ft,endo:ha}),Xe=Zo(Ye,X),Go={};function Jt(e,...t){let n=Go[e];if(n===void 0){let r=X(Eo(e));n=J(r,r),Go[e]=n}return X(J(n,...t))}var Qn=e=>e.toBytes(!0).slice(1),er=e=>e%Yn===pa;function Xn(e){let{Fn:t,BASE:n}=Ye,r=t.fromBytes(e),o=n.multiply(r);return{scalar:er(o.y)?r:t.neg(r),bytes:Qn(o)}}function Jo(e){let t=Ft;if(!t.isValidNot0(e))throw new Error("invalid x: Fail if x \u2265 p");let n=t.create(e*e),r=t.create(n*e+BigInt(7)),o=t.sqrt(r);er(o)||(o=t.neg(o));let s=Ye.fromAffine({x:e,y:o});return s.assertValidity(),s}var St=qe;function Yo(...e){return Ye.Fn.create(St(Jt("BIP0340/challenge",...e)))}function Fo(e){return Xn(e).bytes}function ga(e,t,n=he(32)){let{Fn:r}=Ye,o=D(e,void 0,"message"),{bytes:s,scalar:i}=Xn(t),a=D(n,32,"auxRand"),c=r.toBytes(i^St(Jt("BIP0340/aux",a))),l=Jt("BIP0340/nonce",c,s,o),{bytes:u,scalar:f}=Xn(l),h=Yo(u,s,o),d=new Uint8Array(64);if(d.set(u,0),d.set(r.toBytes(r.create(f+h*i)),32),!Xo(d,o,s))throw new Error("sign: Invalid signature produced");return d}function Xo(e,t,n){let{Fp:r,Fn:o,BASE:s}=Ye,i=D(e,64,"signature"),a=D(t,void 0,"message"),c=D(n,32,"publicKey");try{let l=Jo(St(c)),u=St(i.subarray(0,32));if(!r.isValidNot0(u))return!1;let f=St(i.subarray(32,64));if(!o.isValidNot0(f))return!1;let h=Yo(o.toBytes(u),Qn(l),a),d=s.multiplyUnsafe(f).add(l.multiplyUnsafe(o.neg(h))),{x:p,y:g}=d.toAffine();return!(d.is0()||!er(g)||p!==u)}catch{return!1}}var lt=(()=>{let n=(r=he(48))=>Wt(r,Yt.n);return{keygen:jt(n,Fo),getPublicKey:Fo,sign:ga,verify:Xo,Point:Ye,utils:{randomSecretKey:n,taggedHash:Jt,lift_x:Jo,pointToBytes:Qn},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:32*2,seed:48}}})();function or(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function wa(e){if(!or(e))throw new Error("Uint8Array expected")}function ns(e,t){return Array.isArray(t)?t.length===0?!0:e?t.every(n=>typeof n=="string"):t.every(n=>Number.isSafeInteger(n)):!1}function ba(e){if(typeof e!="function")throw new Error("function expected");return!0}function Qe(e,t){if(typeof t!="string")throw new Error(`${e}: string expected`);return!0}function sr(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function tr(e){if(!Array.isArray(e))throw new Error("array expected")}function Qt(e,t){if(!ns(!0,t))throw new Error(`${e}: array of strings expected`)}function rs(e,t){if(!ns(!1,t))throw new Error(`${e}: array of numbers expected`)}function os(...e){let t=s=>s,n=(s,i)=>a=>s(i(a)),r=e.map(s=>s.encode).reduceRight(n,t),o=e.map(s=>s.decode).reduce(n,t);return{encode:r,decode:o}}function ss(e){let t=typeof e=="string"?e.split(""):e,n=t.length;Qt("alphabet",t);let r=new Map(t.map((o,s)=>[o,s]));return{encode:o=>(tr(o),o.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${e}`);return t[s]})),decode:o=>(tr(o),o.map(s=>{Qe("alphabet.decode",s);let i=r.get(s);if(i===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${e}`);return i}))}}function is(e=""){return Qe("join",e),{encode:t=>(Qt("join.decode",t),t.join(e)),decode:t=>(Qe("join.decode",t),t.split(e))}}function ma(e,t="="){return sr(e),Qe("padding",t),{encode(n){for(Qt("padding.encode",n);n.length*e%8;)n.push(t);return n},decode(n){Qt("padding.decode",n);let r=n.length;if(r*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if((r-1)*e%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,r)}}}var as=(e,t)=>t===0?e:as(t,e%t),en=(e,t)=>e+(t-as(e,t)),Xt=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function nr(e,t,n,r){if(tr(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(en(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${en(t,n)}`);let o=0,s=0,i=Xt[t],a=Xt[n]-1,c=[];for(let l of e){if(sr(l),l>=i)throw new Error(`convertRadix2: invalid data word=${l} from=${t}`);if(o=o<<t|l,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)c.push((o>>s-n&a)>>>0);let u=Xt[s];if(u===void 0)throw new Error("invalid carry");o&=u-1}if(o=o<<n-s&a,!r&&s>=t)throw new Error("Excess padding");if(!r&&o>0)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&c.push(o>>>0),c}function cs(e,t=!1){if(sr(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(en(8,e)>32||en(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!or(n))throw new Error("radix2.encode input should be Uint8Array");return nr(Array.from(n),8,e,!t)},decode:n=>(rs("radix2.decode",n),Uint8Array.from(nr(n,e,8,t)))}}function Qo(e){return ba(e),function(...t){try{return e.apply(null,t)}catch{}}}var xa=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",va=(e,t)=>{Qe("base64",e);let n=t?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,r=t?"base64url":"base64";if(e.length>0&&!n.test(e))throw new Error("invalid base64");return Uint8Array.fromBase64(e,{alphabet:r,lastChunkHandling:"strict"})},fe=xa?{encode(e){return wa(e),e.toBase64()},decode(e){return va(e,!1)}}:os(cs(6),ss("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ma(6),is(""));var rr=os(ss("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),is("")),es=[996825010,642813549,513874426,1027748829,705979059];function At(e){let t=e>>25,n=(e&33554431)<<5;for(let r=0;r<es.length;r++)(t>>r&1)===1&&(n^=es[r]);return n}function ts(e,t,n=1){let r=e.length,o=1;for(let s=0;s<r;s++){let i=e.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);o=At(o)^i>>5}o=At(o);for(let s=0;s<r;s++)o=At(o)^e.charCodeAt(s)&31;for(let s of t)o=At(o)^s;for(let s=0;s<6;s++)o=At(o);return o^=n,rr.encode(nr([o%Xt[30]],30,5,!1))}function Ea(e){let t=e==="bech32"?1:734539939,n=cs(5),r=n.decode,o=n.encode,s=Qo(r);function i(f,h,d=90){Qe("bech32.encode prefix",f),or(h)&&(h=Array.from(h)),rs("bech32.encode",h);let p=f.length;if(p===0)throw new TypeError(`Invalid prefix length ${p}`);let g=p+7+h.length;if(d!==!1&&g>d)throw new TypeError(`Length ${g} exceeds limit ${d}`);let w=f.toLowerCase(),v=ts(w,h,t);return`${w}1${rr.encode(h)}${v}`}function a(f,h=90){Qe("bech32.decode input",f);let d=f.length;if(d<8||h!==!1&&d>h)throw new TypeError(`invalid string length: ${d} (${f}). Expected (8..${h})`);let p=f.toLowerCase();if(f!==p&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");let g=p.lastIndexOf("1");if(g===0||g===-1)throw new Error('Letter "1" must be present between prefix and data only');let w=p.slice(0,g),v=p.slice(g+1);if(v.length<6)throw new Error("Data must be at least 6 characters long");let S=rr.decode(v).slice(0,-6),U=ts(w,S,t);if(!v.endsWith(U))throw new Error(`Invalid checksum in ${f}: expected "${U}"`);return{prefix:w,words:S}}let c=Qo(a);function l(f){let{prefix:h,words:d}=a(f,!1);return{prefix:h,words:d,bytes:r(d)}}function u(f,h){return i(f,o(h))}return{encode:i,decode:a,encodeFromBytes:u,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:s,toWords:o}}var $e=Ea("bech32");function ka(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function tn(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function Rt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function j(e,t,n=""){let r=ka(e),o=e?.length,s=t!==void 0;if(!r||s&&o!==t){let i=n&&`"${n}" `,a=s?` of length ${t}`:"",c=r?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return e}function ir(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ls(e,t){j(e,void 0,"output");let n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function ee(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function se(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function us(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}var _a=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function fs(e,t){return e.buffer===t.buffer&&e.byteOffset<t.byteOffset+t.byteLength&&t.byteOffset<e.byteOffset+e.byteLength}function ar(e,t){if(fs(e,t)&&e.byteOffset<t.byteOffset)throw new Error("complex overlap of input and output is not supported")}function ds(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function et(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}var Tt=(e,t)=>{function n(r,...o){if(j(r,void 0,"key"),!_a)throw new Error("Non little-endian hardware is not yet supported");if(e.nonceLength!==void 0){let u=o[0];j(u,e.varSizeNonce?void 0:e.nonceLength,"nonce")}let s=e.tagLength;s&&o[1]!==void 0&&j(o[1],void 0,"AAD");let i=t(r,...o),a=(u,f)=>{if(f!==void 0){if(u!==2)throw new Error("cipher output not supported");j(f,void 0,"output")}},c=!1;return{encrypt(u,f){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,j(u),a(i.encrypt.length,f),i.encrypt(u,f)},decrypt(u,f){if(j(u),s&&u.length<s)throw new Error('"ciphertext" expected length bigger than tagLength='+s);return a(i.decrypt.length,f),i.decrypt(u,f)}}}return Object.assign(n,e),n};function ut(e,t,n=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error('"output" expected Uint8Array of length '+e+", got: "+t.length);if(n&&!tt(t))throw new Error("invalid output, must be aligned");return t}function cr(e,t,n){tn(n);let r=new Uint8Array(16),o=us(r);return o.setBigUint64(0,BigInt(t),n),o.setBigUint64(8,BigInt(e),n),r}function tt(e){return e.byteOffset%4===0}function be(e){return Uint8Array.from(e)}var ne=16;var Sa=283;function ps(e){if(![16,24,32].includes(e.length))throw new Error('"aes key" expected Uint8Array of length 16/24/32, got length='+e.length)}function hr(e){return e<<1^Sa&-(e>>7)}function ft(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(t&1),e=hr(e);return n}var fr=(()=>{let e=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=hr(r))e[n]=r;let t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return se(e),t})(),Aa=fr.map((e,t)=>fr.indexOf(t)),Ra=e=>e<<24|e>>>8,lr=e=>e<<8|e>>>24;function ys(e,t){if(e.length!==256)throw new Error("Wrong sbox length");let n=new Uint32Array(256).map((l,u)=>t(e[u])),r=n.map(lr),o=r.map(lr),s=o.map(lr),i=new Uint32Array(256*256),a=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let l=0;l<256;l++)for(let u=0;u<256;u++){let f=l*256+u;i[f]=n[l]^r[u],a[f]=o[l]^s[u],c[f]=e[l]<<8|e[u]}return{sbox:e,sbox2:c,T0:n,T1:r,T2:o,T3:s,T01:i,T23:a}}var pr=ys(fr,e=>ft(e,3)<<24|e<<16|e<<8|ft(e,2)),gs=ys(Aa,e=>ft(e,11)<<24|ft(e,13)<<16|ft(e,9)<<8|ft(e,14)),Ta=(()=>{let e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=hr(n))e[t]=n;return e})();function yr(e){j(e);let t=e.length;ps(e);let{sbox2:n}=pr,r=[];tt(e)||r.push(e=be(e));let o=ee(e),s=o.length,i=c=>Ae(n,c,c,c,c),a=new Uint32Array(t+28);a.set(o);for(let c=s;c<a.length;c++){let l=a[c-1];c%s===0?l=i(Ra(l))^Ta[c/s-1]:s>6&&c%s===4&&(l=i(l)),a[c]=a[c-s]^l}return se(...r),a}function La(e){let t=yr(e),n=t.slice(),r=t.length,{sbox2:o}=pr,{T0:s,T1:i,T2:a,T3:c}=gs;for(let l=0;l<r;l+=4)for(let u=0;u<4;u++)n[l+u]=t[r-l-4+u];se(t);for(let l=4;l<r-4;l++){let u=n[l],f=Ae(o,u,u,u,u);n[l]=s[f&255]^i[f>>>8&255]^a[f>>>16&255]^c[f>>>24]}return n}function Ve(e,t,n,r,o,s){return e[n<<8&65280|r>>>8&255]^t[o>>>8&65280|s>>>24&255]}function Ae(e,t,n,r,o){return e[t&255|n&65280]|e[r>>>16&255|o>>>16&65280]<<16}function dr(e,t,n,r,o){let{sbox2:s,T01:i,T23:a}=pr,c=0;t^=e[c++],n^=e[c++],r^=e[c++],o^=e[c++];let l=e.length/4-2;for(let p=0;p<l;p++){let g=e[c++]^Ve(i,a,t,n,r,o),w=e[c++]^Ve(i,a,n,r,o,t),v=e[c++]^Ve(i,a,r,o,t,n),S=e[c++]^Ve(i,a,o,t,n,r);t=g,n=w,r=v,o=S}let u=e[c++]^Ae(s,t,n,r,o),f=e[c++]^Ae(s,n,r,o,t),h=e[c++]^Ae(s,r,o,t,n),d=e[c++]^Ae(s,o,t,n,r);return{s0:u,s1:f,s2:h,s3:d}}function Ia(e,t,n,r,o){let{sbox2:s,T01:i,T23:a}=gs,c=0;t^=e[c++],n^=e[c++],r^=e[c++],o^=e[c++];let l=e.length/4-2;for(let p=0;p<l;p++){let g=e[c++]^Ve(i,a,t,o,r,n),w=e[c++]^Ve(i,a,n,t,o,r),v=e[c++]^Ve(i,a,r,n,t,o),S=e[c++]^Ve(i,a,o,r,n,t);t=g,n=w,r=v,o=S}let u=e[c++]^Ae(s,t,o,r,n),f=e[c++]^Ae(s,n,t,o,r),h=e[c++]^Ae(s,r,n,t,o),d=e[c++]^Ae(s,o,r,n,t);return{s0:u,s1:f,s2:h,s3:d}}function Ua(e){if(j(e),e.length%ne!==0)throw new Error("aes-(cbc/ecb).decrypt ciphertext should consist of blocks with size "+ne)}function Pa(e,t,n){j(e);let r=e.length,o=r%ne;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");tt(e)||(e=be(e));let s=ee(e);if(t){let a=ne-o;a||(a=ne),r=r+a}n=ut(r,n),ar(e,n);let i=ee(n);return{b:s,o:i,out:n}}function Ca(e,t){if(!t)return e;let n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");let r=e[n-1];if(r<=0||r>16)throw new Error("aes/pcks5: wrong padding");let o=e.subarray(0,-r);for(let s=0;s<r;s++)if(e[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function Oa(e){let t=new Uint8Array(16),n=ee(t);t.set(e);let r=ne-e.length;for(let o=ne-r;o<ne;o++)t[o]=r;return n}var gr=Tt({blockSize:16,nonceLength:16},function(t,n,r={}){let o=!r.disablePadding;return{encrypt(s,i){let a=yr(t),{b:c,o:l,out:u}=Pa(s,o,i),f=n,h=[a];tt(f)||h.push(f=be(f));let d=ee(f),p=d[0],g=d[1],w=d[2],v=d[3],S=0;for(;S+4<=c.length;)p^=c[S+0],g^=c[S+1],w^=c[S+2],v^=c[S+3],{s0:p,s1:g,s2:w,s3:v}=dr(a,p,g,w,v),l[S++]=p,l[S++]=g,l[S++]=w,l[S++]=v;if(o){let U=Oa(s.subarray(S*4));p^=U[0],g^=U[1],w^=U[2],v^=U[3],{s0:p,s1:g,s2:w,s3:v}=dr(a,p,g,w,v),l[S++]=p,l[S++]=g,l[S++]=w,l[S++]=v}return se(...h),u},decrypt(s,i){Ua(s);let a=La(t),c=n,l=[a];tt(c)||l.push(c=be(c));let u=ee(c);i=ut(s.length,i),tt(s)||l.push(s=be(s)),ar(s,i);let f=ee(s),h=ee(i),d=u[0],p=u[1],g=u[2],w=u[3];for(let v=0;v+4<=f.length;){let S=d,U=p,M=g,Q=w;d=f[v+0],p=f[v+1],g=f[v+2],w=f[v+3];let{s0:z,s1:Y,s2:G,s3:L}=Ia(a,d,p,g,w);h[v++]=z^S,h[v++]=Y^U,h[v++]=G^M,h[v++]=L^Q}return se(...l),Ca(i,o)}}});function Na(e){return e instanceof Uint32Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint32Array"}function ur(e,t){if(j(t,16,"block"),!Na(e))throw new Error("_encryptBlock accepts result of expandKeyLE");let n=ee(t),{s0:r,s1:o,s2:s,s3:i}=dr(e,n[0],n[1],n[2],n[3]);return n[0]=r,n[1]=o,n[2]=s,n[3]=i,t}function hs(e){let t=0;for(let n=ne-1;n>=0;n--){let r=(e[n]&128)>>>7;e[n]=e[n]<<1|t,t=r}return t&&(e[ne-1]^=135),e}function nn(e,t){if(e.length!==t.length)throw new Error("xorBlock: blocks must have same length");for(let n=0;n<e.length;n++)e[n]=e[n]^t[n];return e}var rn=class{buffer;destroyed;k1;k2;xk;constructor(t){j(t),ps(t),this.xk=yr(t),this.buffer=new Uint8Array(0),this.destroyed=!1;let n=new Uint8Array(ne);ur(this.xk,n),this.k1=hs(n),this.k2=hs(new Uint8Array(this.k1))}update(t){let{destroyed:n,buffer:r}=this;if(n)throw new Error("CMAC instance was destroyed");j(t);let o=new Uint8Array(r.length+t.length);return o.set(r),o.set(t,r.length),this.buffer=o,this}digest(){if(this.destroyed)throw new Error("CMAC instance was destroyed");let{buffer:t}=this,n=t.length,r=Math.ceil(n/ne),o;r===0?(r=1,o=!1):o=n%ne===0;let s=(r-1)*ne,i=t.subarray(s),a;if(o)a=nn(new Uint8Array(i),this.k1);else{let l=new Uint8Array(ne);l.set(i),l[i.length]=128,a=nn(l,this.k2)}let c=new Uint8Array(ne);for(let l=0;l<r-1;l++){let u=t.subarray(l*ne,(l+1)*ne);nn(c,u),ur(this.xk,c)}return nn(c,a),ur(this.xk,c),se(a),c}destroy(){let{buffer:t,destroyed:n,xk:r,k1:o,k2:s}=this;n||(this.destroyed=!0,se(t,r,o,s))}},Ma=(e,t)=>new rn(e).update(t).digest();Ma.create=e=>new rn(e);var bs=e=>Uint8Array.from(e.split(""),t=>t.charCodeAt(0)),Da=bs("expand 16-byte k"),Ha=bs("expand 32-byte k"),qa=ee(Da),Ka=ee(Ha);function R(e,t){return e<<t|e>>>32-t}function wr(e){return e.byteOffset%4===0}var on=64,$a=16,ms=2**32-1,ws=Uint32Array.of();function Va(e,t,n,r,o,s,i,a){let c=o.length,l=new Uint8Array(on),u=ee(l),f=wr(o)&&wr(s),h=f?ee(o):ws,d=f?ee(s):ws;for(let p=0;p<c;i++){if(e(t,n,r,u,i,a),i>=ms)throw new Error("arx: counter overflow");let g=Math.min(on,c-p);if(f&&g===on){let w=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let v=0,S;v<$a;v++)S=w+v,d[S]=h[S]^u[v];p+=on;continue}for(let w=0,v;w<g;w++)v=p+w,s[v]=o[v]^l[w];p+=g}}function br(e,t){let{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=ds({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return Rt(o),Rt(i),tn(s),tn(n),(a,c,l,u,f=0)=>{j(a,void 0,"key"),j(c,void 0,"nonce"),j(l,void 0,"data");let h=l.length;if(u===void 0&&(u=new Uint8Array(h)),j(u,void 0,"output"),Rt(f),f<0||f>=ms)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);let d=[],p=a.length,g,w;if(p===32)d.push(g=be(a)),w=Ka;else if(p===16&&n)g=new Uint8Array(32),g.set(a),g.set(a,16),w=qa,d.push(g);else throw j(a,32,"arx key"),new Error("invalid key size");wr(c)||d.push(c=be(c));let v=ee(g);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(w,v,ee(c.subarray(0,16)),v),c=c.subarray(16)}let S=16-o;if(S!==c.length)throw new Error(`arx: nonce must be ${S} or 16 bytes`);if(S!==12){let M=new Uint8Array(12);M.set(c,s?0:12-c.length),c=M,d.push(c)}let U=ee(c);return Va(e,w,v,U,l,u,f,i),se(...d),u}}function ie(e,t){return e[t++]&255|(e[t++]&255)<<8}var mr=class{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(t){t=be(j(t,32,"key"));let n=ie(t,0),r=ie(t,2),o=ie(t,4),s=ie(t,6),i=ie(t,8),a=ie(t,10),c=ie(t,12),l=ie(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=ie(t,16+2*u)}process(t,n,r=!1){let o=r?0:2048,{h:s,r:i}=this,a=i[0],c=i[1],l=i[2],u=i[3],f=i[4],h=i[5],d=i[6],p=i[7],g=i[8],w=i[9],v=ie(t,n+0),S=ie(t,n+2),U=ie(t,n+4),M=ie(t,n+6),Q=ie(t,n+8),z=ie(t,n+10),Y=ie(t,n+12),G=ie(t,n+14),L=s[0]+(v&8191),K=s[1]+((v>>>13|S<<3)&8191),H=s[2]+((S>>>10|U<<6)&8191),I=s[3]+((U>>>7|M<<9)&8191),m=s[4]+((M>>>4|Q<<12)&8191),b=s[5]+(Q>>>1&8191),y=s[6]+((Q>>>14|z<<2)&8191),E=s[7]+((z>>>11|Y<<5)&8191),_=s[8]+((Y>>>8|G<<8)&8191),B=s[9]+(G>>>5|o),x=0,k=x+L*a+K*(5*w)+H*(5*g)+I*(5*p)+m*(5*d);x=k>>>13,k&=8191,k+=b*(5*h)+y*(5*f)+E*(5*u)+_*(5*l)+B*(5*c),x+=k>>>13,k&=8191;let A=x+L*c+K*a+H*(5*w)+I*(5*g)+m*(5*p);x=A>>>13,A&=8191,A+=b*(5*d)+y*(5*h)+E*(5*f)+_*(5*u)+B*(5*l),x+=A>>>13,A&=8191;let T=x+L*l+K*c+H*a+I*(5*w)+m*(5*g);x=T>>>13,T&=8191,T+=b*(5*p)+y*(5*d)+E*(5*h)+_*(5*f)+B*(5*u),x+=T>>>13,T&=8191;let $=x+L*u+K*l+H*c+I*a+m*(5*w);x=$>>>13,$&=8191,$+=b*(5*g)+y*(5*p)+E*(5*d)+_*(5*h)+B*(5*f),x+=$>>>13,$&=8191;let q=x+L*f+K*u+H*l+I*c+m*a;x=q>>>13,q&=8191,q+=b*(5*w)+y*(5*g)+E*(5*p)+_*(5*d)+B*(5*h),x+=q>>>13,q&=8191;let C=x+L*h+K*f+H*u+I*l+m*c;x=C>>>13,C&=8191,C+=b*a+y*(5*w)+E*(5*g)+_*(5*p)+B*(5*d),x+=C>>>13,C&=8191;let V=x+L*d+K*h+H*f+I*u+m*l;x=V>>>13,V&=8191,V+=b*c+y*a+E*(5*w)+_*(5*g)+B*(5*p),x+=V>>>13,V&=8191;let F=x+L*p+K*d+H*h+I*f+m*u;x=F>>>13,F&=8191,F+=b*l+y*c+E*a+_*(5*w)+B*(5*g),x+=F>>>13,F&=8191;let oe=x+L*g+K*p+H*d+I*h+m*f;x=oe>>>13,oe&=8191,oe+=b*u+y*l+E*c+_*a+B*(5*w),x+=oe>>>13,oe&=8191;let W=x+L*w+K*g+H*p+I*d+m*h;x=W>>>13,W&=8191,W+=b*f+y*u+E*l+_*c+B*a,x+=W>>>13,W&=8191,x=(x<<2)+x|0,x=x+k|0,k=x&8191,x=x>>>13,A+=x,s[0]=k,s[1]=A,s[2]=T,s[3]=$,s[4]=q,s[5]=C,s[6]=V,s[7]=F,s[8]=oe,s[9]=W}finalize(){let{h:t,pad:n}=this,r=new Uint16Array(10),o=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=o,o=t[a]>>>13,t[a]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,r[0]=t[0]+5,o=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=t[a]+o,o=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(o^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)t[a]=t[a]&s|r[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+n[0];t[0]=i&65535;for(let a=1;a<8;a++)i=(t[a]+n[a]|0)+(i>>>16)|0,t[a]=i&65535;se(r)}update(t){ir(this),j(t),t=be(t);let{buffer:n,blockLen:r}=this,o=t.length;for(let s=0;s<o;){let i=Math.min(r-this.pos,o-s);if(i===r){for(;r<=o-s;s+=r)this.process(t,s);continue}n.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){se(this.h,this.r,this.buffer,this.pad)}digestInto(t){ir(this),ls(t,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)t[s++]=r[i]>>>0,t[s++]=r[i]>>>8;return t}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}};function Wa(e){let t=(r,o)=>e(o).update(r).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}var xs=Wa(e=>new mr(e));function ks(e,t,n,r,o,s=20){let i=e[0],a=e[1],c=e[2],l=e[3],u=t[0],f=t[1],h=t[2],d=t[3],p=t[4],g=t[5],w=t[6],v=t[7],S=o,U=n[0],M=n[1],Q=n[2],z=i,Y=a,G=c,L=l,K=u,H=f,I=h,m=d,b=p,y=g,E=w,_=v,B=S,x=U,k=M,A=Q;for(let $=0;$<s;$+=2)z=z+K|0,B=R(B^z,16),b=b+B|0,K=R(K^b,12),z=z+K|0,B=R(B^z,8),b=b+B|0,K=R(K^b,7),Y=Y+H|0,x=R(x^Y,16),y=y+x|0,H=R(H^y,12),Y=Y+H|0,x=R(x^Y,8),y=y+x|0,H=R(H^y,7),G=G+I|0,k=R(k^G,16),E=E+k|0,I=R(I^E,12),G=G+I|0,k=R(k^G,8),E=E+k|0,I=R(I^E,7),L=L+m|0,A=R(A^L,16),_=_+A|0,m=R(m^_,12),L=L+m|0,A=R(A^L,8),_=_+A|0,m=R(m^_,7),z=z+H|0,A=R(A^z,16),E=E+A|0,H=R(H^E,12),z=z+H|0,A=R(A^z,8),E=E+A|0,H=R(H^E,7),Y=Y+I|0,B=R(B^Y,16),_=_+B|0,I=R(I^_,12),Y=Y+I|0,B=R(B^Y,8),_=_+B|0,I=R(I^_,7),G=G+m|0,x=R(x^G,16),b=b+x|0,m=R(m^b,12),G=G+m|0,x=R(x^G,8),b=b+x|0,m=R(m^b,7),L=L+K|0,k=R(k^L,16),y=y+k|0,K=R(K^y,12),L=L+K|0,k=R(k^L,8),y=y+k|0,K=R(K^y,7);let T=0;r[T++]=i+z|0,r[T++]=a+Y|0,r[T++]=c+G|0,r[T++]=l+L|0,r[T++]=u+K|0,r[T++]=f+H|0,r[T++]=h+I|0,r[T++]=d+m|0,r[T++]=p+b|0,r[T++]=g+y|0,r[T++]=w+E|0,r[T++]=v+_|0,r[T++]=S+B|0,r[T++]=U+x|0,r[T++]=M+k|0,r[T++]=Q+A|0}function za(e,t,n,r){let o=e[0],s=e[1],i=e[2],a=e[3],c=t[0],l=t[1],u=t[2],f=t[3],h=t[4],d=t[5],p=t[6],g=t[7],w=n[0],v=n[1],S=n[2],U=n[3];for(let Q=0;Q<20;Q+=2)o=o+c|0,w=R(w^o,16),h=h+w|0,c=R(c^h,12),o=o+c|0,w=R(w^o,8),h=h+w|0,c=R(c^h,7),s=s+l|0,v=R(v^s,16),d=d+v|0,l=R(l^d,12),s=s+l|0,v=R(v^s,8),d=d+v|0,l=R(l^d,7),i=i+u|0,S=R(S^i,16),p=p+S|0,u=R(u^p,12),i=i+u|0,S=R(S^i,8),p=p+S|0,u=R(u^p,7),a=a+f|0,U=R(U^a,16),g=g+U|0,f=R(f^g,12),a=a+f|0,U=R(U^a,8),g=g+U|0,f=R(f^g,7),o=o+l|0,U=R(U^o,16),p=p+U|0,l=R(l^p,12),o=o+l|0,U=R(U^o,8),p=p+U|0,l=R(l^p,7),s=s+u|0,w=R(w^s,16),g=g+w|0,u=R(u^g,12),s=s+u|0,w=R(w^s,8),g=g+w|0,u=R(u^g,7),i=i+f|0,v=R(v^i,16),h=h+v|0,f=R(f^h,12),i=i+f|0,v=R(v^i,8),h=h+v|0,f=R(f^h,7),a=a+c|0,S=R(S^a,16),d=d+S|0,c=R(c^d,12),a=a+c|0,S=R(S^a,8),d=d+S|0,c=R(c^d,7);let M=0;r[M++]=o,r[M++]=s,r[M++]=i,r[M++]=a,r[M++]=w,r[M++]=v,r[M++]=S,r[M++]=U}var nt=br(ks,{counterRight:!1,counterLength:4,allowShortKeys:!1}),ja=br(ks,{counterRight:!1,counterLength:8,extendNonceFn:za,allowShortKeys:!1});var Za=new Uint8Array(16),vs=(e,t)=>{e.update(t);let n=t.length%16;n&&e.update(Za.subarray(n))},Ga=new Uint8Array(32);function Es(e,t,n,r,o){o!==void 0&&j(o,void 0,"AAD");let s=e(t,n,Ga),i=cr(r.length,o?o.length:0,!0),a=xs.create(s);o&&vs(a,o),vs(a,r),a.update(i);let c=a.digest();return se(s,i),c}var _s=e=>(t,n,r)=>({encrypt(s,i){let a=s.length;i=ut(a+16,i,!1),i.set(s);let c=i.subarray(0,-16);e(t,n,c,c,1);let l=Es(e,t,n,c,r);return i.set(l,a),se(l),i},decrypt(s,i){i=ut(s.length-16,i,!1);let a=s.subarray(0,-16),c=s.subarray(-16),l=Es(e,t,n,a,r);if(!et(c,l))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),e(t,n,i,i,1),se(l),i}}),Jd=Tt({blockSize:64,nonceLength:12,tagLength:16},_s(nt)),Yd=Tt({blockSize:64,nonceLength:24,tagLength:16},_s(ja));function sn(e,t,n){return Ge(e),n===void 0&&(n=new Uint8Array(e.outputLen)),Se(e,n,t)}var xr=Uint8Array.of(0),Bs=Uint8Array.of();function an(e,t,n,r=32){Ge(e),we(r,"length");let o=e.outputLen;if(r>255*o)throw new Error("Length must be <= 255*HashLen");let s=Math.ceil(r/o);n===void 0?n=Bs:D(n,void 0,"info");let i=new Uint8Array(s*o),a=Se.create(e,t),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)xr[0]=u+1,c.update(u===0?Bs:l).update(n).update(xr).digestInto(l),i.set(l,o*u),a._cloneInto(c);return a.destroy(),c.destroy(),Ue(l,xr),i.slice(0,r)}var Fa=Object.defineProperty,Z=(e,t)=>{for(var n in t)Fa(e,n,{get:t[n],enumerable:!0})},dt=Symbol("verified"),Ja=e=>e instanceof Object;function Br(e){if(!Ja(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var Ya={};Z(Ya,{binarySearch:()=>Sr,bytesToHex:()=>N,hexToBytes:()=>O,insertEventIntoAscendingList:()=>ec,insertEventIntoDescendingList:()=>Qa,mergeReverseSortedLists:()=>tc,normalizeURL:()=>Xa,utf8Decoder:()=>Me,utf8Encoder:()=>me});var Me=new TextDecoder("utf-8"),me=new TextEncoder;function Xa(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.protocol==="http:"?t.protocol="ws:":t.protocol==="https:"&&(t.protocol="wss:"),t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function Qa(e,t){let[n,r]=Sr(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return r||e.splice(n,0,t),e}function ec(e,t){let[n,r]=Sr(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return r||e.splice(n,0,t),e}function Sr(e,t){let n=0,r=e.length-1;for(;n<=r;){let o=Math.floor((n+r)/2),s=t(e[o]);if(s===0)return[o,!0];s<0?r=o-1:n=o+1}return[n,!1]}function tc(e,t){let n=new Array(e.length+t.length);n.length=0;let r=0,o=0,s=[];for(;r<e.length&&o<t.length;){let i;if(e[r]?.created_at>t[o]?.created_at?(i=e[r],r++):(i=t[o],o++),n.length>0&&n[n.length-1].created_at===i.created_at){if(s.includes(i.id))continue}else s.length=0;n.push(i),s.push(i.id)}for(;r<e.length;){let i=e[r];if(r++,n.length>0&&n[n.length-1].created_at===i.created_at){if(s.includes(i.id))continue}else s.length=0;n.push(i),s.push(i.id)}for(;o<t.length;){let i=t[o];if(o++,n.length>0&&n[n.length-1].created_at===i.created_at){if(s.includes(i.id))continue}else s.length=0;n.push(i),s.push(i.id)}return n}var nc=class{generateSecretKey(){return lt.utils.randomSecretKey()}getPublicKey(e){return N(lt.getPublicKey(e))}finalizeEvent(e,t){let n=e;return n.pubkey=N(lt.getPublicKey(t)),n.id=ln(n),n.sig=N(lt.sign(O(ln(n)),t)),n[dt]=!0,n}verifyEvent(e){if(typeof e[dt]=="boolean")return e[dt];let t=ln(e);if(t!==e.id)return e[dt]=!1,!1;try{let n=lt.verify(O(e.sig),O(t),O(e.pubkey));return e[dt]=n,n}catch{return e[dt]=!1,!1}}};function rc(e){if(!Br(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function ln(e){let t=X(me.encode(rc(e)));return N(t)}var dn=new nc,Lt=dn.generateSecretKey,De=dn.getPublicKey,re=dn.finalizeEvent,Ar=dn.verifyEvent,oc={};Z(oc,{Application:()=>gl,BadgeAward:()=>dc,BadgeDefinition:()=>ll,BlockedRelaysList:()=>zc,BlossomServerList:()=>Xc,BookmarkList:()=>$c,Bookmarksets:()=>il,Calendar:()=>kl,CalendarEventRSVP:()=>_l,ChannelCreation:()=>Ps,ChannelHideMessage:()=>Ns,ChannelMessage:()=>Os,ChannelMetadata:()=>Cs,ChannelMuteUser:()=>Ms,ChatMessage:()=>hc,ClassifiedListing:()=>ml,ClientAuth:()=>Hs,Comment:()=>Ec,CommunitiesList:()=>Vc,CommunityDefinition:()=>Rl,CommunityPostApproval:()=>Lc,Contacts:()=>lc,CreateOrUpdateProduct:()=>dl,CreateOrUpdateStall:()=>fl,Curationsets:()=>al,Date:()=>vl,DirectMessageRelaysList:()=>Jc,DraftClassifiedListing:()=>xl,DraftLong:()=>pl,Emojisets:()=>yl,EncryptedDirectMessage:()=>uc,EventDeletion:()=>fc,FavoriteRelays:()=>Zc,FileMessage:()=>yc,FileMetadata:()=>vc,FileServerPreference:()=>Yc,Followsets:()=>rl,ForumThread:()=>pc,GenericRepost:()=>Ur,Genericlists:()=>ol,GiftWrap:()=>Ds,GroupMetadata:()=>Tl,HTTPAuth:()=>Pr,Handlerinformation:()=>Al,Handlerrecommendation:()=>Sl,Highlights:()=>Mc,InterestsList:()=>Gc,Interestsets:()=>ul,JobFeedback:()=>Pc,JobRequest:()=>Ic,JobResult:()=>Uc,Label:()=>Tc,LightningPubRPC:()=>el,LiveChatMessage:()=>kc,LiveEvent:()=>wl,LongFormArticle:()=>hl,Metadata:()=>ac,Mutelist:()=>Hc,NWCWalletInfo:()=>Qc,NWCWalletRequest:()=>qs,NWCWalletResponse:()=>tl,NormalVideo:()=>wc,NostrConnect:()=>nl,OpenTimestamps:()=>mc,Photo:()=>gc,Pinlist:()=>qc,Poll:()=>xc,PollResponse:()=>Dc,PrivateDirectMessage:()=>Us,ProblemTracker:()=>Sc,ProfileBadges:()=>cl,PublicChatsList:()=>Wc,Reaction:()=>Ir,RecommendRelay:()=>cc,RelayList:()=>Kc,RelayReview:()=>Bl,Relaysets:()=>sl,Report:()=>Ac,Reporting:()=>Rc,Repost:()=>Lr,Seal:()=>Is,SearchRelaysList:()=>jc,ShortTextNote:()=>Ls,ShortVideo:()=>bc,Time:()=>El,UserEmojiList:()=>Fc,UserStatuses:()=>bl,Voice:()=>_c,VoiceComment:()=>Bc,Zap:()=>Nc,ZapGoal:()=>Cc,ZapRequest:()=>Oc,classifyKind:()=>sc,isAddressableKind:()=>Tr,isEphemeralKind:()=>Ts,isKind:()=>ic,isRegularKind:()=>Rs,isReplaceableKind:()=>Rr});function Rs(e){return e<1e4&&e!==0&&e!==3}function Rr(e){return e===0||e===3||1e4<=e&&e<2e4}function Ts(e){return 2e4<=e&&e<3e4}function Tr(e){return 3e4<=e&&e<4e4}function sc(e){return Rs(e)?"regular":Rr(e)?"replaceable":Ts(e)?"ephemeral":Tr(e)?"parameterized":"unknown"}function ic(e,t){let n=t instanceof Array?t:[t];return Br(e)&&n.includes(e.kind)||!1}var ac=0,Ls=1,cc=2,lc=3,uc=4,fc=5,Lr=6,Ir=7,dc=8,hc=9,pc=11,Is=13,Us=14,yc=15,Ur=16,gc=20,wc=21,bc=22,Ps=40,Cs=41,Os=42,Ns=43,Ms=44,mc=1040,Ds=1059,xc=1068,vc=1063,Ec=1111,kc=1311,_c=1222,Bc=1244,Sc=1971,Ac=1984,Rc=1984,Tc=1985,Lc=4550,Ic=5999,Uc=6999,Pc=7e3,Cc=9041,Oc=9734,Nc=9735,Mc=9802,Dc=1018,Hc=1e4,qc=10001,Kc=10002,$c=10003,Vc=10004,Wc=10005,zc=10006,jc=10007,Zc=10012,Gc=10015,Fc=10030,Jc=10050,Yc=10096,Xc=10063,Qc=13194,el=21e3,Hs=22242,qs=23194,tl=23195,nl=24133,Pr=27235,rl=3e4,ol=30001,sl=30002,il=30003,al=30004,cl=30008,ll=30009,ul=30015,fl=30017,dl=30018,hl=30023,pl=30024,yl=30030,gl=30078,wl=30311,bl=30315,ml=30402,xl=30403,vl=31922,El=31923,kl=31924,_l=31925,Bl=31987,Sl=31989,Al=31990,Rl=34550,Tl=39e3;var Ll={};Z(Ll,{getHex64:()=>Cr,getInt:()=>Ks,getSubscriptionId:()=>Il,matchEventId:()=>Ul,matchEventKind:()=>Cl,matchEventPubkey:()=>Pl});function Cr(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}function Ks(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,o=e.slice(r),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function Il(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return e.slice(r+1,s)}function Ul(e,t){return t===Cr(e,"id")}function Pl(e,t){return t===Cr(e,"pubkey")}function Cl(e,t){return t===Ks(e,"kind")}var Ol={};Z(Ol,{makeAuthEvent:()=>Nl});function Nl(e,t){return{kind:Hs,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var Ml;try{Ml=WebSocket}catch{}var Dl;try{Dl=WebSocket}catch{}var We={};Z(We,{BECH32_REGEX:()=>$s,Bech32MaxSize:()=>Or,NostrTypeGuard:()=>Hl,decode:()=>hn,decodeNostrURI:()=>Kl,encodeBytes:()=>yn,naddrEncode:()=>Zl,neventEncode:()=>jl,noteEncode:()=>Wl,nprofileEncode:()=>zl,npubEncode:()=>Vl,nsecEncode:()=>$l});var Hl={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},Or=5e3,$s=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function ql(e){let t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function Kl(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),hn(e)}catch{return{type:"invalid",data:null}}}function hn(e){let{prefix:t,words:n}=$e.decode(e,Or),r=new Uint8Array($e.fromWords(n));switch(t){case"nprofile":{let o=vr(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:N(o[0][0]),relays:o[1]?o[1].map(s=>Me.decode(s)):[]}}}case"nevent":{let o=vr(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:N(o[0][0]),relays:o[1]?o[1].map(s=>Me.decode(s)):[],author:o[2]?.[0]?N(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(N(o[3][0]),16):void 0}}}case"naddr":{let o=vr(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Me.decode(o[0][0]),pubkey:N(o[2][0]),kind:parseInt(N(o[3][0]),16),relays:o[1]?o[1].map(s=>Me.decode(s)):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:N(r)};default:throw new Error(`unknown prefix ${t}`)}}function vr(e){let t={},n=e;for(;n.length>0;){let r=n[0],o=n[1],s=n.slice(2,2+o);if(n=n.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(s)}return t}function $l(e){return yn("nsec",e)}function Vl(e){return yn("npub",O(e))}function Wl(e){return yn("note",O(e))}function pn(e,t){let n=$e.toWords(t);return $e.encode(e,n,Or)}function yn(e,t){return pn(e,t)}function zl(e){let t=Nr({0:[O(e.pubkey)],1:(e.relays||[]).map(n=>me.encode(n))});return pn("nprofile",t)}function jl(e){let t;e.kind!==void 0&&(t=ql(e.kind));let n=Nr({0:[O(e.id)],1:(e.relays||[]).map(r=>me.encode(r)),2:e.author?[O(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return pn("nevent",n)}function Zl(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=Nr({0:[me.encode(e.identifier)],1:(e.relays||[]).map(r=>me.encode(r)),2:[O(e.pubkey)],3:[new Uint8Array(t)]});return pn("naddr",n)}function Nr(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(n)],0),s.set([o.length],1),s.set(o,2),t.push(s)})}),J(...t)}var gn={};Z(gn,{decrypt:()=>Gl,encrypt:()=>Vs});function Vs(e,t,n){let r=e instanceof Uint8Array?e:O(e),o=Xe.getSharedSecret(r,O("02"+t)),s=Ws(o),i=Uint8Array.from(he(16)),a=me.encode(n),c=gr(s,i).encrypt(a),l=fe.encode(new Uint8Array(c)),u=fe.encode(new Uint8Array(i.buffer));return`${l}?iv=${u}`}function Gl(e,t,n){let r=e instanceof Uint8Array?e:O(e),[o,s]=n.split("?iv="),i=Xe.getSharedSecret(r,O("02"+t)),a=Ws(i),c=fe.decode(s),l=fe.decode(o),u=gr(a,c).decrypt(l);return Me.decode(u)}function Ws(e){return e.slice(1,33)}var Fl={};Z(Fl,{NIP05_REGEX:()=>Mr,isNip05:()=>Jl,isValid:()=>Ql,queryProfile:()=>zs,searchDomain:()=>Xl,useFetchImplementation:()=>Yl});var Mr=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,Jl=e=>Mr.test(e||""),wn;try{wn=fetch}catch{}function Yl(e){wn=e}async function Xl(e,t=""){try{let n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await wn(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function zs(e){let t=e.match(Mr);if(!t)return null;let[,n="_",r]=t;try{let o=`https://${r}/.well-known/nostr.json?name=${n}`,s=await wn(o,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");let i=await s.json(),a=i.names[n];return a?{pubkey:a,relays:i.relays?.[a]}:null}catch{return null}}async function Ql(e,t){let n=await zs(t);return n?n.pubkey===e:!1}var eu={};Z(eu,{parse:()=>tu});function tu(e){let t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]},n,r;for(let o=e.tags.length-1;o>=0;o--){let s=e.tags[o];if(s[0]==="e"&&s[1]){let[i,a,c,l,u]=s,f={id:a,relays:c?[c]:[],author:u};if(l==="root"){t.root=f;continue}if(l==="reply"){t.reply=f;continue}if(l==="mention"){t.mentions.push(f);continue}n?r=f:n=f,t.mentions.push(f);continue}if(s[0]==="q"&&s[1]){let[i,a,c]=s;t.quotes.push({id:a,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(o=>{if(!o)return;let s=t.mentions.indexOf(o);if(s!==-1&&t.mentions.splice(s,1),o.author){let i=t.profiles.find(a=>a.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(a=>{o.relays?.indexOf(a)===-1&&o.relays.push(a)}),i.relays=o.relays)}}),t.mentions.forEach(o=>{if(o.author){let s=t.profiles.find(i=>i.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(i=>{o.relays.indexOf(i)===-1&&o.relays.push(i)}),s.relays=o.relays)}}),t}var nu={};Z(nu,{fetchRelayInformation:()=>ou,useFetchImplementation:()=>ru});var js;try{js=fetch}catch{}function ru(e){js=e}async function ou(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var su={};Z(su,{getPow:()=>iu,minePow:()=>cu});function iu(e){let t=0;for(let n=0;n<64;n+=8){let r=parseInt(e.substring(n,n+8),16);if(r===0)t+=32;else{t+=Math.clz32(r);break}}return t}function au(e){let t=0;for(let n=0;n<e.length;n++){let r=e[n];if(r===0)t+=8;else{t+=Math.clz32(r)-24;break}}return t}function cu(e,t){let n=0,r=e,o=["nonce",n.toString(),t.toString()];for(r.tags.push(o);;){let s=Math.floor(new Date().getTime()/1e3);s!==r.created_at&&(n=0,r.created_at=s),o[1]=(++n).toString();let i=X(me.encode(JSON.stringify([0,r.pubkey,r.created_at,r.kind,r.tags,r.content])));if(au(i)>=t){r.id=N(i);break}}return r}var lu={};Z(lu,{unwrapEvent:()=>xu,unwrapManyEvents:()=>vu,wrapEvent:()=>si,wrapManyEvents:()=>mu});var uu={};Z(uu,{createRumor:()=>ti,createSeal:()=>ni,createWrap:()=>ri,unwrapEvent:()=>$r,unwrapManyEvents:()=>oi,wrapEvent:()=>fn,wrapManyEvents:()=>wu});var pt={};Z(pt,{decrypt:()=>Kr,encrypt:()=>qr,getConversationKey:()=>Dr,v2:()=>yu});var Zs=1,Gs=65535;function Dr(e,t){let n=Xe.getSharedSecret(e,O("02"+t)).subarray(1,33);return sn(X,n,me.encode("nip44-v2"))}function Fs(e,t){let n=an(X,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function Hr(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;let t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function fu(e){if(!Number.isSafeInteger(e)||e<Zs||e>Gs)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");let t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function du(e){let t=me.encode(e),n=t.length,r=fu(n),o=new Uint8Array(Hr(n)-n);return J(r,t,o)}function hu(e){let t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<Zs||t>Gs||n.length!==t||e.length!==2+Hr(t))throw new Error("invalid padding");return Me.decode(n)}function Js(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");let r=J(n,t);return Se(X,e,r)}function pu(e){if(typeof e!="string")throw new Error("payload must be a valid string");let t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=fe.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}let r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);let o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function qr(e,t,n=he(32)){let{chacha_key:r,chacha_nonce:o,hmac_key:s}=Fs(t,n),i=du(e),a=nt(r,o,i),c=Js(s,a,n);return fe.encode(J(new Uint8Array([2]),n,a,c))}function Kr(e,t){let{nonce:n,ciphertext:r,mac:o}=pu(e),{chacha_key:s,chacha_nonce:i,hmac_key:a}=Fs(t,n),c=Js(a,r,n);if(!et(c,o))throw new Error("invalid MAC");let l=nt(s,i,r);return hu(l)}var yu={utils:{getConversationKey:Dr,calcPaddedLen:Hr},encrypt:qr,decrypt:Kr},gu=2*24*60*60,Ys=()=>Math.round(Date.now()/1e3),Xs=()=>Math.round(Ys()-Math.random()*gu),Qs=(e,t)=>Dr(e,t),ei=(e,t,n)=>qr(JSON.stringify(e),Qs(t,n)),Ss=(e,t)=>JSON.parse(Kr(e.content,Qs(t,e.pubkey)));function ti(e,t){let n={created_at:Ys(),content:"",tags:[],...e,pubkey:De(t)};return n.id=ln(n),n}function ni(e,t,n){return re({kind:Is,content:ei(e,t,n),created_at:Xs(),tags:[]},t)}function ri(e,t){let n=Lt();return re({kind:Ds,content:ei(e,n,t),created_at:Xs(),tags:[["p",t]]},n)}function fn(e,t,n){let r=ti(e,t),o=ni(r,t,n);return ri(o,n)}function wu(e,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");let r=De(t),o=[fn(e,t,r)];return n.forEach(s=>{o.push(fn(e,t,s))}),o}function $r(e,t){let n=Ss(e,t);return Ss(n,t)}function oi(e,t){let n=[];return e.forEach(r=>{n.push($r(r,t))}),n.sort((r,o)=>r.created_at-o.created_at),n}function bu(e,t,n,r){let o={created_at:Math.ceil(Date.now()/1e3),kind:Us,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:i,relayUrl:a})=>{o.tags.push(a?["p",i,a]:["p",i])}),r&&o.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&o.tags.push(["subject",n]),o}function si(e,t,n,r,o){let s=bu(t,n,r,o);return fn(s,e,t.publicKey)}function mu(e,t,n,r,o){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:De(e)},...t].map(i=>si(e,i,n,r,o))}var xu=$r,vu=oi,Eu={};Z(Eu,{finishRepostEvent:()=>ku,getRepostedEvent:()=>_u,getRepostedEventPointer:()=>ii});function ku(e,t,n,r){let o,s=[...e.tags??[],["e",t.id,n],["p",t.pubkey]];return t.kind===Ls?o=Lr:(o=Ur,s.push(["k",String(t.kind)])),re({kind:o,tags:s,content:e.content===""||t.tags?.find(i=>i[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},r)}function ii(e){if(![Lr,Ur].includes(e.kind))return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){let o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(t!==void 0)return{id:t[1],relays:[t[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function _u(e,{skipVerification:t}={}){let n=ii(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!Ar(r)))return r}var Bu={};Z(Bu,{NOSTR_URI_REGEX:()=>Vr,parse:()=>Au,test:()=>Su});var Vr=new RegExp(`nostr:(${$s.source})`);function Su(e){return typeof e=="string"&&new RegExp(`^${Vr.source}$`).test(e)}function Au(e){let t=e.match(new RegExp(`^${Vr.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:hn(t[1])}}var Ru={};Z(Ru,{finishReactionEvent:()=>Tu,getReactedEventPointer:()=>Lu});function Tu(e,t,n){let r=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return re({...e,kind:Ir,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function Lu(e){if(e.kind!==Ir)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){let o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Iu={};Z(Iu,{parse:()=>Pu});var Er=/\W/m,As=/[^\w\/] |[^\w\/]$|$|,| /m,Uu=42;function*Pu(e){let t=[];if(typeof e!="string"){for(let s=0;s<e.tags.length;s++){let i=e.tags[s];i[0]==="emoji"&&i.length>=3&&t.push({type:"emoji",shortcode:i[1],url:i[2]})}e=e.content}let n=e.length,r=0,o=0;e:for(;o<n;){let s=e.indexOf(":",o),i=e.indexOf("#",o);if(s===-1&&i===-1)break e;if(s===-1||i>=0&&i<s){if(i===0||e[i-1].match(Er)){let a=e.slice(i+1,i+Uu).match(Er),c=a?i+1+a.index:n;yield{type:"text",text:e.slice(r,i)},yield{type:"hashtag",value:e.slice(i+1,c)},o=c,r=o;continue e}o=i+1;continue e}if(e.slice(s-5,s)==="nostr"){let a=e.slice(s+60).match(Er),c=a?s+60+a.index:n;try{let l,{data:u,type:f}=hn(e.slice(s+1,c));switch(f){case"npub":l={pubkey:u};break;case"note":l={id:u};break;case"nsec":o=c+1;continue;default:l=u}r!==s-5&&(yield{type:"text",text:e.slice(r,s-5)}),yield{type:"reference",pointer:l},o=c,r=o;continue e}catch{o=s+1;continue e}}else if(e.slice(s-5,s)==="https"||e.slice(s-4,s)==="http"){let a=e.slice(s+4).match(As),c=a?s+4+a.index:n,l=e[s-1]==="s"?5:4;try{let u=new URL(e.slice(s-l,c));if(u.hostname.indexOf(".")===-1)throw new Error("invalid url");if(r!==s-l&&(yield{type:"text",text:e.slice(r,s-l)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(u.pathname)){yield{type:"image",url:u.toString()},o=c,r=o;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(u.pathname)){yield{type:"video",url:u.toString()},o=c,r=o;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(u.pathname)){yield{type:"audio",url:u.toString()},o=c,r=o;continue e}yield{type:"url",url:u.toString()},o=c,r=o;continue e}catch{o=c+1;continue e}}else if(e.slice(s-3,s)==="wss"||e.slice(s-2,s)==="ws"){let a=e.slice(s+4).match(As),c=a?s+4+a.index:n,l=e[s-1]==="s"?3:2;try{let u=new URL(e.slice(s-l,c));if(u.hostname.indexOf(".")===-1)throw new Error("invalid ws url");r!==s-l&&(yield{type:"text",text:e.slice(r,s-l)}),yield{type:"relay",url:u.toString()},o=c,r=o;continue e}catch{o=c+1;continue e}}else{for(let a=0;a<t.length;a++){let c=t[a];if(e[s+c.shortcode.length+1]===":"&&e.slice(s+1,s+c.shortcode.length+1)===c.shortcode){r!==s&&(yield{type:"text",text:e.slice(r,s)}),yield c,o=s+c.shortcode.length+2,r=o;continue e}}o=s+1;continue e}}r!==n&&(yield{type:"text",text:e.slice(r)})}var Cu={};Z(Cu,{channelCreateEvent:()=>Ou,channelHideMessageEvent:()=>Du,channelMessageEvent:()=>Mu,channelMetadataEvent:()=>Nu,channelMuteUserEvent:()=>Hu});var Ou=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return re({kind:Ps,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},Nu=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return re({kind:Cs,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Mu=(e,t)=>{let n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),re({kind:Os,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},Du=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return re({kind:Ns,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Hu=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return re({kind:Ms,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},qu={};Z(qu,{EMOJI_SHORTCODE_REGEX:()=>ai,matchAll:()=>Ku,regex:()=>Wr,replaceAll:()=>$u});var ai=/:(\w+):/,Wr=()=>new RegExp(`\\B${ai.source}\\B`,"g");function*Ku(e){let t=e.matchAll(Wr());for(let n of t)try{let[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function $u(e,t){return e.replaceAll(Wr(),(n,r)=>t({shortcode:n,name:r}))}var Vu={};Z(Vu,{useFetchImplementation:()=>Wu,validateGithub:()=>zu});var zr;try{zr=fetch}catch{}function Wu(e){zr=e}async function zu(e,t,n){try{return await(await zr(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var ju={};Z(ju,{makeNwcRequestEvent:()=>Gu,parseConnectionString:()=>Zu});function Zu(e){let{host:t,pathname:n,searchParams:r}=new URL(e),o=n||t,s=r.get("relay"),i=r.get("secret");if(!o||!s||!i)throw new Error("invalid connection string");return{pubkey:o,relay:s,secret:i}}async function Gu(e,t,n){let o=Vs(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:qs,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e]]};return re(s,t)}var Fu={};Z(Fu,{normalizeIdentifier:()=>Ju});function Ju(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>/\p{Letter}/u.test(t)||/\p{Number}/u.test(t)?t:"-").join("")}var Yu={};Z(Yu,{getSatoshisAmountFromBolt11:()=>rf,getZapEndpoint:()=>Qu,makeZapReceipt:()=>nf,makeZapRequest:()=>ef,useFetchImplementation:()=>Xu,validateZapRequest:()=>tf});var jr;try{jr=fetch}catch{}function Xu(e){jr=e}async function Qu(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(r){let[i,a]=r.split("@");t=new URL(`/.well-known/lnurlp/${i}`,`https://${a}`).toString()}else if(n){let{words:i}=$e.decode(n,1e3),a=$e.fromWords(i);t=Me.decode(a)}else return null;let s=await(await jr(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function ef(e){let t={kind:9734,created_at:Math.round(Date.now()/1e3),content:e.comment||"",tags:[["p","pubkey"in e?e.pubkey:e.event.pubkey],["amount",e.amount.toString()],["relays",...e.relays]]};if("event"in e){if(t.tags.push(["e",e.event.id]),Rr(e.event.kind)){let n=["a",`${e.event.kind}:${e.event.pubkey}:`];t.tags.push(n)}else if(Tr(e.event.kind)){let n=e.event.tags.find(([o,s])=>o==="d"&&s);if(!n)throw new Error("d tag not found or is empty");let r=["a",`${e.event.kind}:${e.event.pubkey}:${n[1]}`];t.tags.push(r)}t.tags.push(["k",e.event.kind.toString()])}return t}function tf(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!Br(t))return"Zap request is not a valid Nostr event.";if(!Ar(t))return"Invalid signature on zap request.";let n=t.tags.find(([s,i])=>s==="p"&&i);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([s,i])=>s==="e"&&i);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function nf({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let o=JSON.parse(e),s=o.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),i={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",n],["description",e]]};return t&&i.tags.push(["preimage",t]),i}function rf(e){if(e.length<50)return 0;e=e.substring(0,50);let t=e.lastIndexOf("1");if(t===-1)return 0;let n=e.substring(0,t);if(!n.startsWith("lnbc"))return 0;let r=n.substring(4);if(r.length<1)return 0;let o=r[r.length-1],s=o.charCodeAt(0)-48,i=s>=0&&s<=9,a=r.length-1;if(i&&a++,a<1)return 0;let c=parseInt(r.substring(0,a));switch(o){case"m":return c*1e5;case"u":return c*100;case"n":return c/10;case"p":return c/1e4;default:return c*1e8}}var of={};Z(of,{Negentropy:()=>li,NegentropyStorageVector:()=>cf,NegentropySync:()=>lf});var kr=97,ht=32,ci=16,rt={Skip:0,Fingerprint:1,IdList:2},Ne=class{_raw;length;constructor(e){typeof e=="number"?(this._raw=new Uint8Array(e),this.length=0):e instanceof Uint8Array?(this._raw=new Uint8Array(e),this.length=e.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(e){if(e instanceof Ne&&(e=e.unwrap()),typeof e.length!="number")throw Error("bad length");let t=e.length+this.length;if(this.capacity<t){let n=this._raw,r=Math.max(this.capacity*2,t);this._raw=new Uint8Array(r),this._raw.set(n)}this._raw.set(e,this.length),this.length+=e.length}shift(){let e=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,e}shiftN(e=1){let t=this._raw.subarray(0,e);return this._raw=this._raw.subarray(e),this.length-=e,t}};function cn(e){let t=0;for(;;){if(e.length===0)throw Error("parse ends prematurely");let n=e.shift();if(t=t<<7|n&127,!(n&128))break}return t}function Oe(e){if(e===0)return new Ne(new Uint8Array([0]));let t=[];for(;e!==0;)t.push(e&127),e>>>=7;t.reverse();for(let n=0;n<t.length-1;n++)t[n]|=128;return new Ne(new Uint8Array(t))}function sf(e){return un(e,1)[0]}function un(e,t){if(e.length<t)throw Error("parse ends prematurely");return e.shiftN(t)}var af=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(ht)}add(e){let t=0,n=0,r=new DataView(this.buf.buffer),o=new DataView(e.buffer);for(let s=0;s<8;s++){let i=s*4,a=r.getUint32(i,!0),c=o.getUint32(i,!0),l=a;l+=t,l+=c,l>4294967295&&(n=1),r.setUint32(i,l&4294967295,!0),t=n,n=0}}negate(){let e=new DataView(this.buf.buffer);for(let n=0;n<8;n++){let r=n*4;e.setUint32(r,~e.getUint32(r,!0))}let t=new Uint8Array(ht);t[0]=1,this.add(t)}getFingerprint(e){let t=new Ne;return t.extend(this.buf),t.extend(Oe(e)),X(t.unwrap()).subarray(0,ci)}},cf=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(e,t){if(this.sealed)throw Error("already sealed");let n=O(t);if(n.byteLength!==ht)throw Error("bad id size for added item");this.items.push({timestamp:e,id:n})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(_r);for(let e=1;e<this.items.length;e++)if(_r(this.items[e-1],this.items[e])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(e){if(this._checkSealed(),e>=this.items.length)throw Error("out of range");return this.items[e]}iterate(e,t,n){this._checkSealed(),this._checkBounds(e,t);for(let r=e;r<t&&n(this.items[r],r);++r);}findLowerBound(e,t,n){return this._checkSealed(),this._checkBounds(e,t),this._binarySearch(this.items,e,t,r=>_r(r,n)<0)}fingerprint(e,t){let n=new af;return n.setToZero(),this.iterate(e,t,r=>(n.add(r.id),!0)),n.getFingerprint(t-e)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(e,t){if(e>t||t>this.items.length)throw Error("bad range")}_binarySearch(e,t,n,r){let o=n-t;for(;o>0;){let s=t,i=Math.floor(o/2);s+=i,r(e[s])?(t=++s,o-=i+1):o=i}return t}},li=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(e,t=6e4){if(t<4096)throw Error("frameSizeLimit too small");this.storage=e,this.frameSizeLimit=t,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(e,t){return{timestamp:e,id:t||new Uint8Array(0)}}initiate(){let e=new Ne;return e.extend(new Uint8Array([kr])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),e),N(e.unwrap())}reconcile(e,t,n){let r=new Ne(O(e));this.lastTimestampIn=this.lastTimestampOut=0;let o=new Ne;o.extend(new Uint8Array([kr]));let s=sf(r);if(s<96||s>111)throw Error("invalid negentropy protocol version byte");if(s!==kr)throw Error("unsupported negentropy protocol version requested: "+(s-96));let i=this.storage.size(),a=this._bound(0),c=0,l=!1;for(;r.length!==0;){let u=new Ne,f=()=>{l&&(l=!1,u.extend(this.encodeBound(a)),u.extend(Oe(rt.Skip)))},h=this.decodeBound(r),d=cn(r),p=c,g=this.storage.findLowerBound(c,i,h);if(d===rt.Skip)l=!0;else if(d===rt.Fingerprint){let w=un(r,ci),v=this.storage.fingerprint(p,g);ui(w,v)!==0?(f(),this.splitRange(p,g,h,u)):l=!0}else if(d===rt.IdList){let w=cn(r),v={};for(let S=0;S<w;S++){let U=un(r,ht);v[N(U)]=U}if(l=!0,this.storage.iterate(p,g,S=>{let U=S.id,M=N(U);return v[M]?delete v[N(U)]:t?.(M),!0}),n)for(let S of Object.values(v))n(N(S))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(o.length+u.length)){let w=this.storage.fingerprint(g,i);o.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),o.extend(Oe(rt.Fingerprint)),o.extend(w);break}else o.extend(u);c=g,a=h}return o.length===1?null:N(o.unwrap())}splitRange(e,t,n,r){let o=t-e,s=16;if(o<s*2)r.extend(this.encodeBound(n)),r.extend(Oe(rt.IdList)),r.extend(Oe(o)),this.storage.iterate(e,t,i=>(r.extend(i.id),!0));else{let i=Math.floor(o/s),a=o%s,c=e;for(let l=0;l<s;l++){let u=i+(l<a?1:0),f=this.storage.fingerprint(c,c+u);c+=u;let h;if(c===t)h=n;else{let d,p;this.storage.iterate(c-1,c+1,(g,w)=>(w===c-1?d=g:p=g,!0)),h=this.getMinimalBound(d,p)}r.extend(this.encodeBound(h)),r.extend(Oe(rt.Fingerprint)),r.extend(f)}}}exceededFrameSizeLimit(e){return e>this.frameSizeLimit-200}decodeTimestampIn(e){let t=cn(e);return t=t===0?Number.MAX_VALUE:t-1,this.lastTimestampIn===Number.MAX_VALUE||t===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(t+=this.lastTimestampIn,this.lastTimestampIn=t,t)}decodeBound(e){let t=this.decodeTimestampIn(e),n=cn(e);if(n>ht)throw Error("bound key too long");let r=un(e,n);return{timestamp:t,id:r}}encodeTimestampOut(e){if(e===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,Oe(0);let t=e;return e-=this.lastTimestampOut,this.lastTimestampOut=t,Oe(e+1)}encodeBound(e){let t=new Ne;return t.extend(this.encodeTimestampOut(e.timestamp)),t.extend(Oe(e.id.length)),t.extend(e.id),t}getMinimalBound(e,t){if(t.timestamp!==e.timestamp)return this._bound(t.timestamp);{let n=0,r=t.id,o=e.id;for(let s=0;s<ht&&r[s]===o[s];s++)n++;return this._bound(t.timestamp,t.id.subarray(0,n+1))}}};function ui(e,t){for(let n=0;n<e.byteLength;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}function _r(e,t){return e.timestamp===t.timestamp?ui(e.id,t.id):e.timestamp-t.timestamp}var lf=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(e,t,n,r={}){this.relay=e,this.storage=t,this.neg=new li(t),this.onhave=r.onhave,this.onneed=r.onneed,this.filter=n,this.subscription=this.relay.prepareSubscription([{}],{label:r.label||"negentropy"}),this.subscription.oncustom=o=>{switch(o[0]){case"NEG-MSG":{o.length<3;try{let s=this.neg.reconcile(o[2],this.onhave,this.onneed);s?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${s}"]`):(this.close(),r.onclose?.())}catch(s){r?.onclose?.(`reconcile error: ${s}`)}break}case"NEG-CLOSE":{let s=o[2];r.onclose?.(s);break}case"NEG-ERR":r.onclose?.()}}}async start(){let e=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${e}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},uf={};Z(uf,{getToken:()=>ff,hashPayload:()=>Zr,unpackEventFromToken:()=>di,validateEvent:()=>bi,validateEventKind:()=>pi,validateEventMethodTag:()=>gi,validateEventPayloadTag:()=>wi,validateEventTimestamp:()=>hi,validateEventUrlTag:()=>yi,validateToken:()=>df});var fi="Nostr ";async function ff(e,t,n,r=!1,o){let s={kind:Pr,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",Zr(o)]);let i=await n(s);return(r?fi:"")+fe.encode(me.encode(JSON.stringify(i)))}async function df(e,t,n){let r=await di(e).catch(s=>{throw s});return await bi(r,t,n).catch(s=>{throw s})}async function di(e){if(!e)throw new Error("Missing token");e=e.replace(fi,"");let t=Me.decode(fe.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function hi(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function pi(e){return e.kind===Pr}function yi(e,t){let n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function gi(e,t){let n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function Zr(e){let t=X(me.encode(JSON.stringify(e)));return N(t)}function wi(e,t){let n=e.tags.find(o=>o[0]==="payload");if(!n)return!1;let r=Zr(t);return n.length>0&&n[1]===r}async function bi(e,t,n,r){if(!Ar(e))throw new Error("Invalid nostr event, signature invalid");if(!pi(e))throw new Error("Invalid nostr event, kind invalid");if(!hi(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!yi(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!gi(e,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!wi(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var Oh=new Error("timeout while waiting for mutex to become available"),Nh=new Error("mutex already locked"),hf=new Error("request for lock canceled"),pf=function(e,t,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{l(r.next(u))}catch(f){i(f)}}function c(u){try{l(r.throw(u))}catch(f){i(f)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((r=r.apply(e,t||[])).next())})},Gr=class{constructor(t,n=hf){this._value=t,this._cancelError=n,this._queue=[],this._weightedWaiters=[]}acquire(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((r,o)=>{let s={resolve:r,reject:o,weight:t,priority:n},i=mi(this._queue,a=>n<=a.priority);i===-1&&t<=this._value?this._dispatchItem(s):this._queue.splice(i+1,0,s)})}runExclusive(t){return pf(this,arguments,void 0,function*(n,r=1,o=0){let[s,i]=yield this.acquire(r,o);try{return yield n(s)}finally{i()}})}waitForUnlock(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,n)?Promise.resolve():new Promise(r=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),yf(this._weightedWaiters[t-1],{resolve:r,priority:n})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){let n=this._value;this._value-=t.weight,t.resolve([n,this._newReleaser(t.weight)])}_newReleaser(t){let n=!1;return()=>{n||(n=!0,this.release(t))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let t=this._value;t>0;t--){let n=this._weightedWaiters[t-1];n&&(n.forEach(r=>r.resolve()),this._weightedWaiters[t-1]=[])}else{let t=this._queue[0].priority;for(let n=this._value;n>0;n--){let r=this._weightedWaiters[n-1];if(!r)continue;let o=r.findIndex(s=>s.priority<=t);(o===-1?r:r.splice(0,o)).forEach(s=>s.resolve())}}}_couldLockImmediately(t,n){return(this._queue.length===0||this._queue[0].priority<n)&&t<=this._value}};function yf(e,t){let n=mi(e,r=>t.priority<=r.priority);e.splice(n+1,0,t)}function mi(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}var gf=function(e,t,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{l(r.next(u))}catch(f){i(f)}}function c(u){try{l(r.throw(u))}catch(f){i(f)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((r=r.apply(e,t||[])).next())})},bn=class{constructor(t){this._semaphore=new Gr(1,t)}acquire(){return gf(this,arguments,void 0,function*(t=0){let[,n]=yield this._semaphore.acquire(1,t);return n})}runExclusive(t,n=0){return this._semaphore.runExclusive(()=>t(),1,n)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};var P=typeof browser<"u"?browser:typeof chrome<"u"?chrome:null;if(!P)throw new Error("browser-polyfill: No extension API namespace found (neither browser nor chrome).");var xe=typeof browser>"u"&&typeof chrome<"u";function ve(e,t){return(...n)=>{try{let r=t.apply(e,n);if(r&&typeof r.then=="function")return r}catch{}return new Promise((r,o)=>{t.apply(e,[...n,(...s)=>{P.runtime&&P.runtime.lastError?o(new Error(P.runtime.lastError.message)):r(s.length<=1?s[0]:s)}])})}}var de={};de.runtime={sendMessage(...e){return xe?ve(P.runtime,P.runtime.sendMessage)(...e):P.runtime.sendMessage(...e)},onMessage:P.runtime.onMessage,getURL(e){return P.runtime.getURL(e)},openOptionsPage(){return xe?ve(P.runtime,P.runtime.openOptionsPage)():P.runtime.openOptionsPage()},get id(){return P.runtime.id}};de.storage={local:{get(...e){return xe?ve(P.storage.local,P.storage.local.get)(...e):P.storage.local.get(...e)},set(...e){return xe?ve(P.storage.local,P.storage.local.set)(...e):P.storage.local.set(...e)},clear(...e){return xe?ve(P.storage.local,P.storage.local.clear)(...e):P.storage.local.clear(...e)},remove(...e){return xe?ve(P.storage.local,P.storage.local.remove)(...e):P.storage.local.remove(...e)}}};de.tabs={create(...e){return xe?ve(P.tabs,P.tabs.create)(...e):P.tabs.create(...e)},query(...e){return xe?ve(P.tabs,P.tabs.query)(...e):P.tabs.query(...e)},remove(...e){return xe?ve(P.tabs,P.tabs.remove)(...e):P.tabs.remove(...e)},update(...e){return xe?ve(P.tabs,P.tabs.update)(...e):P.tabs.update(...e)},get(...e){return xe?ve(P.tabs,P.tabs.get)(...e):P.tabs.get(...e)},getCurrent(...e){return xe?ve(P.tabs,P.tabs.getCurrent)(...e):P.tabs.getCurrent(...e)}};function It(e){let t=new Uint8Array(e),n="";for(let r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function mn(e){let t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n.buffer}async function xi(e,t){let n=new TextEncoder,r=await crypto.subtle.importKey("raw",n.encode(e),"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t instanceof Uint8Array?t:new Uint8Array(t),iterations:6e5,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function Ut(e,t){let n=crypto.getRandomValues(new Uint8Array(16)),r=crypto.getRandomValues(new Uint8Array(12)),o=await xi(t,n),s=new TextEncoder,i=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},o,s.encode(e));return JSON.stringify({salt:It(n),iv:It(r),ciphertext:It(i)})}async function xn(e,t){let{salt:n,iv:r,ciphertext:o}=JSON.parse(e),s=new Uint8Array(mn(n)),i=new Uint8Array(mn(r)),a=mn(o),c=await xi(t,s),l=await crypto.subtle.decrypt({name:"AES-GCM",iv:i},c,a);return new TextDecoder().decode(l)}async function vn(e,t){t?typeof t=="string"&&(t=new Uint8Array(mn(t))):t=crypto.getRandomValues(new Uint8Array(16));let n=new TextEncoder,r=await crypto.subtle.importKey("raw",n.encode(e),"PBKDF2",!1,["deriveBits"]),o=await crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:6e5,hash:"SHA-256"},r,256);return{hash:It(o),salt:It(t)}}async function vi(e,t,n){let{hash:r}=await vn(e,n);return r===t}var Re=de.storage.local,$h=[new URL("wss://relay.damus.io"),new URL("wss://relay.snort.social"),new URL("wss://nos.lol"),new URL("wss://brb.io"),new URL("wss://nostr.orangepill.dev")];async function ze(){return(await Re.get({profiles:[]})).profiles}async function ae(e){return(await ze())[e]}async function te(){return(await Re.get({profileIndex:0})).profileIndex}async function En(e){return(await Re.get(e))[e]}async function Ei(e,t){let n=await te();return(await ae(n)).hosts?.[e]?.[t]||"ask"}async function Fr(e,t,n,r=null){let o=await ze();r||(r=await te());let s=o[r],i=s.hosts[e]||{};i={...i,[t]:n},s.hosts[e]=i,o[r]=s,await Re.set({profiles:o})}async function kn(){return(await Re.get({isEncrypted:!1})).isEncrypted}async function wf(e){let{hash:t,salt:n}=await vn(e);await Re.set({passwordHash:t,passwordSalt:n,isEncrypted:!0})}async function _n(e){let t=await Re.get({passwordHash:null,passwordSalt:null});return!t.passwordHash||!t.passwordSalt?!1:vi(e,t.passwordHash,t.passwordSalt)}async function ki(e){if(!await _n(e))throw new Error("Invalid password");let n=await ze();for(let r=0;r<n.length;r++)n[r].type!=="bunker"&&yt(n[r].privKey)&&(n[r].privKey=await xn(n[r].privKey,e));await Re.set({profiles:n,isEncrypted:!1,passwordHash:null,passwordSalt:null})}async function _i(e){let t=await ze();for(let n=0;n<t.length;n++)t[n].type!=="bunker"&&(yt(t[n].privKey)||(t[n].privKey=await Ut(t[n].privKey,e)));await wf(e),await Re.set({profiles:t})}async function Bi(e,t){let n=await ze();for(let s=0;s<n.length;s++){if(n[s].type==="bunker")continue;let i=n[s].privKey;yt(i)&&(i=await xn(i,e)),n[s].privKey=await Ut(i,t)}let{hash:r,salt:o}=await vn(t);await Re.set({profiles:n,passwordHash:r,passwordSalt:o,isEncrypted:!0})}async function Si(e,t){return e.type==="bunker"?"":yt(e.privKey)?xn(e.privKey,t):e.privKey}function yt(e){if(typeof e!="string")return!1;try{let t=JSON.parse(e);return!!(t.salt&&t.iv&&t.ciphertext)}catch{return!1}}var Xr=(e,t)=>t.some(n=>e instanceof n),Ai,Ri;function bf(){return Ai||(Ai=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function mf(){return Ri||(Ri=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Qr=new WeakMap,Jr=new WeakMap,Bn=new WeakMap;function xf(e){let t=new Promise((n,r)=>{let o=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{n(ot(e.result)),o()},i=()=>{r(e.error),o()};e.addEventListener("success",s),e.addEventListener("error",i)});return Bn.set(t,e),t}function vf(e){if(Qr.has(e))return;let t=new Promise((n,r)=>{let o=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{n(),o()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});Qr.set(e,t)}var eo={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return Qr.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ot(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Ui(e){eo=e(eo)}function Ef(e){return mf().includes(e)?function(...t){return e.apply(to(this),t),ot(this.request)}:function(...t){return ot(e.apply(to(this),t))}}function kf(e){return typeof e=="function"?Ef(e):(e instanceof IDBTransaction&&vf(e),Xr(e,bf())?new Proxy(e,eo):e)}function ot(e){if(e instanceof IDBRequest)return xf(e);if(Jr.has(e))return Jr.get(e);let t=kf(e);return t!==e&&(Jr.set(e,t),Bn.set(t,e)),t}var to=e=>Bn.get(e);function Pi(e,t,{blocked:n,upgrade:r,blocking:o,terminated:s}={}){let i=indexedDB.open(e,t),a=ot(i);return r&&i.addEventListener("upgradeneeded",c=>{r(ot(i.result),c.oldVersion,c.newVersion,ot(i.transaction),c)}),n&&i.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),o&&c.addEventListener("versionchange",l=>o(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}var _f=["get","getKey","getAll","getAllKeys","count"],Bf=["put","add","delete","clear"],Yr=new Map;function Ti(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Yr.get(t))return Yr.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,o=Bf.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||_f.includes(n)))return;let s=async function(i,...a){let c=this.transaction(i,o?"readwrite":"readonly"),l=c.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[n](...a),o&&c.done]))[0]};return Yr.set(t,s),s}Ui(e=>({...e,get:(t,n,r)=>Ti(t,n)||e.get(t,n,r),has:(t,n)=>!!Ti(t,n)||e.has(t,n)}));var Sf=["continue","continuePrimaryKey","advance"],Li={},no=new WeakMap,Ci=new WeakMap,Af={get(e,t){if(!Sf.includes(t))return e[t];let n=Li[t];return n||(n=Li[t]=function(...r){no.set(this,Ci.get(this)[t](...r))}),n}};async function*Rf(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;let n=new Proxy(t,Af);for(Ci.set(n,t),Bn.set(n,to(t));t;)yield n,t=await(no.get(n)||t.continue()),no.delete(n)}function Ii(e,t){return t===Symbol.asyncIterator&&Xr(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&Xr(e,[IDBIndex,IDBObjectStore])}Ui(e=>({...e,get(t,n,r){return Ii(t,n)?Rf:e.get(t,n,r)},has(t,n){return Ii(t,n)||e.has(t,n)}}));async function Tf(){return await Pi("events",1,{upgrade(e){let t=e.createObjectStore("events",{keyPath:"event.id"});t.createIndex("pubkey","event.pubkey"),t.createIndex("created_at","event.created_at"),t.createIndex("kind","event.kind"),t.createIndex("host","metadata.host")}})}async function Oi(e){return(await Tf()).put("events",e)}var Lf=new TextDecoder("utf-8"),Ni=new TextEncoder,Mi=1,Di=65535;function If(e,t){let n=Xe.getSharedSecret(e,O("02"+t)).subarray(1,33);return sn(X,n,Ni.encode("nip44-v2"))}function Hi(e,t){let n=an(X,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function ro(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;let t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function Uf(e){if(!Number.isSafeInteger(e)||e<Mi||e>Di)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");let t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function Pf(e){let t=Ni.encode(e),n=t.length,r=Uf(n),o=new Uint8Array(ro(n)-n);return J(r,t,o)}function Cf(e){let t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<Mi||t>Di||n.length!==t||e.length!==2+ro(t))throw new Error("invalid padding");return Lf.decode(n)}function qi(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");let r=J(n,t);return Se(X,e,r)}function Of(e){if(typeof e!="string")throw new Error("payload must be a valid string");let t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=fe.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}let r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);let o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function Nf(e,t,n=he(32)){let{chacha_key:r,chacha_nonce:o,hmac_key:s}=Hi(t,n),i=Pf(e),a=nt(r,o,i),c=qi(s,a,n);return fe.encode(J(new Uint8Array([2]),n,a,c))}function Mf(e,t){let{nonce:n,ciphertext:r,mac:o}=Of(e),{chacha_key:s,chacha_nonce:i,hmac_key:a}=Hi(t,n),c=qi(a,r,n);if(!et(c,o))throw new Error("invalid MAC");let l=nt(s,i,r);return Cf(l)}var Pt={utils:{getConversationKey:If,calcPaddedLen:ro},encrypt:Nf,decrypt:Mf};var Ct=de.storage.local,ye=e=>{},ge=new Map;function Ki(e){if(!e.startsWith("bunker://"))throw new Error("Invalid bunker URL: must start with bunker://");let t=new URL(e),n=t.hostname||t.pathname.replace("//","");if(!/^[0-9a-f]{64}$/i.test(n))throw new Error("Invalid bunker URL: pubkey must be 64 hex characters");let r=t.searchParams.getAll("relay");if(r.length===0)throw new Error("Invalid bunker URL: at least one relay is required");for(let s of r)try{let i=new URL(s);if(i.protocol!=="wss:"&&i.protocol!=="ws:")throw new Error(`Invalid relay protocol: ${i.protocol}`)}catch{throw new Error(`Invalid relay URL: ${s}`)}let o=t.searchParams.get("secret")||null;return{remotePubkey:n,relays:r,secret:o}}var Ot=class{constructor(t){this.url=t,this.ws=null,this.subscriptions=new Map,this.eoseCallbacks=new Map,this.connected=!1,this.reconnectTimer=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5}connect(){return new Promise((t,n)=>{try{this.ws=new WebSocket(this.url)}catch(o){n(new Error(`Failed to create WebSocket: ${o.message}`));return}let r=setTimeout(()=>{this.ws?.close(),n(new Error(`Connection timeout: ${this.url}`))},1e4);this.ws.onopen=()=>{clearTimeout(r),this.connected=!0,this.reconnectAttempts=0,ye(`Connected to ${this.url}`),t()},this.ws.onerror=o=>{clearTimeout(r),ye(`WebSocket error: ${this.url}`),n(new Error(`WebSocket error: ${this.url}`))},this.ws.onclose=()=>{this.connected=!1,ye(`Disconnected from ${this.url}`),this.scheduleReconnect()},this.ws.onmessage=o=>{try{let s=JSON.parse(o.data);this.handleMessage(s)}catch(s){ye(`Failed to parse message: ${s.message}`)}}})}handleMessage(t){let[n,r,...o]=t;if(n==="EVENT"&&r&&o[0]){let s=o[0],i=this.subscriptions.get(r);i&&i(s)}else if(n==="EOSE"&&r){let s=this.eoseCallbacks.get(r);s&&(this.eoseCallbacks.delete(r),s())}else n==="OK"||n==="NOTICE"&&ye(`Relay notice: ${o[0]}`)}subscribe(t,n,r,o=null){if(!this.connected||!this.ws)throw new Error("Not connected");this.subscriptions.set(t,r),o&&this.eoseCallbacks.set(t,o),this.ws.send(JSON.stringify(["REQ",t,...n]))}unsubscribe(t){this.ws&&this.connected&&this.ws.send(JSON.stringify(["CLOSE",t])),this.subscriptions.delete(t),this.eoseCallbacks.delete(t)}publish(t){if(!this.connected||!this.ws)throw new Error("Not connected");this.ws.send(JSON.stringify(["EVENT",t]))}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){ye(`Max reconnect attempts reached for ${this.url}`);return}let t=Math.min(1e3*Math.pow(2,this.reconnectAttempts),3e4);this.reconnectAttempts++,this.reconnectTimer=setTimeout(()=>{ye(`Reconnecting to ${this.url} (attempt ${this.reconnectAttempts})`),this.connect().catch(()=>{})},t)}close(){clearTimeout(this.reconnectTimer),this.maxReconnectAttempts=0,this.subscriptions.clear(),this.eoseCallbacks.clear(),this.ws&&(this.ws.close(),this.ws=null),this.connected=!1}},Sn=class{constructor({remotePubkey:t,relays:n,secret:r}){this.remotePubkey=t,this.relayUrls=n,this.secret=r,this.sessionPrivkey=Lt(),this.sessionPubkey=De(this.sessionPrivkey),this.conversationKey=Pt.utils.getConversationKey(this.sessionPrivkey,this.remotePubkey),this.relays=[],this.pendingRequests=new Map,this.connected=!1,this.subId=`nostrkey-${crypto.randomUUID().slice(0,8)}`}async connect(){let t=this.relayUrls.map(o=>{let s=new Ot(o);return s.connect().then(()=>(this.relays.push(s),s))}),r=(await Promise.allSettled(t)).filter(o=>o.status==="fulfilled");if(r.length===0)throw new Error("Failed to connect to any relay");ye(`Connected to ${r.length}/${this.relayUrls.length} relays`);for(let o of this.relays)o.subscribe(this.subId,[{kinds:[24133],"#p":[this.sessionPubkey]}],s=>this.handleResponse(s));this.connected=!0,this.secret?await this.sendRequest("connect",[this.remotePubkey,this.secret]):await this.sendRequest("connect",[this.remotePubkey])}handleResponse(t){if(t.pubkey!==this.remotePubkey){ye(`Ignoring event from unknown pubkey: ${t.pubkey}`);return}try{let n=Pt.decrypt(t.content,this.conversationKey),r=JSON.parse(n);ye(`Response: ${r.id} -> ${r.result?"ok":r.error}`);let o=this.pendingRequests.get(r.id);o&&(this.pendingRequests.delete(r.id),r.error?o.reject(new Error(r.error)):o.resolve(r.result))}catch(n){ye(`Failed to handle response: ${n.message}`)}}async sendRequest(t,n=[]){if(!this.connected&&t!=="connect")throw new Error("Not connected to bunker");let r=crypto.randomUUID(),o=JSON.stringify({id:r,method:t,params:n}),s=Pt.encrypt(o,this.conversationKey),i=re({kind:24133,content:s,tags:[["p",this.remotePubkey]],created_at:Math.floor(Date.now()/1e3)},this.sessionPrivkey);for(let a of this.relays)try{a.publish(i)}catch(c){ye(`Failed to publish to ${a.url}: ${c.message}`)}return new Promise((a,c)=>{let l=setTimeout(()=>{this.pendingRequests.delete(r),c(new Error(`Request timeout: ${t}`))},3e4);this.pendingRequests.set(r,{resolve:u=>{clearTimeout(l),a(u)},reject:u=>{clearTimeout(l),c(u)}})})}async getPublicKey(){return await this.sendRequest("get_public_key")}async signEvent(t){let n=await this.sendRequest("sign_event",[JSON.stringify(t)]);return JSON.parse(n)}async nip04Encrypt(t,n){return await this.sendRequest("nip04_encrypt",[t,n])}async nip04Decrypt(t,n){return await this.sendRequest("nip04_decrypt",[t,n])}async nip44Encrypt(t,n){return await this.sendRequest("nip44_encrypt",[t,n])}async nip44Decrypt(t,n){return await this.sendRequest("nip44_decrypt",[t,n])}async ping(){return await this.sendRequest("ping")}getSessionInfo(){return{remotePubkey:this.remotePubkey,relayUrls:this.relayUrls,secret:this.secret,sessionPrivkey:N(this.sessionPrivkey),sessionPubkey:this.sessionPubkey}}disconnect(){for(let t of this.relays)t.unsubscribe(this.subId),t.close();this.relays=[],this.pendingRequests.clear(),this.connected=!1,ye("Disconnected from bunker")}};function Hf(e){let t=new Sn({remotePubkey:e.remotePubkey,relays:e.relayUrls,secret:e.secret});return t.sessionPrivkey=O(e.sessionPrivkey),t.sessionPubkey=e.sessionPubkey,t.conversationKey=Pt.utils.getConversationKey(t.sessionPrivkey,t.remotePubkey),t}async function Ee(e){if(ge.has(e)){let o=ge.get(e);if(o.connected)return o;o.disconnect(),ge.delete(e)}let n=(await Ct.get({bunkerSessions:{}})).bunkerSessions?.[e];if(!n)throw new Error("No bunker session configured for this profile");let r=Hf(n);return await r.connect(),ge.set(e,r),r}async function $i(e,t){ge.has(e)&&(ge.get(e).disconnect(),ge.delete(e));let n=Ki(t),r=new Sn(n);await r.connect();let s=(await Ct.get({bunkerSessions:{}})).bunkerSessions||{};return s[e]=r.getSessionInfo(),await Ct.set({bunkerSessions:s}),ge.set(e,r),r}async function Vi(e){ge.has(e)&&(ge.get(e).disconnect(),ge.delete(e));let n=(await Ct.get({bunkerSessions:{}})).bunkerSessions||{};delete n[e],await Ct.set({bunkerSessions:n})}function Wi(e){return ge.has(e)&&ge.get(e).connected}function zi(e){try{return Ki(e),{valid:!0,error:null}}catch(t){return{valid:!1,error:t.message}}}var An="nostrkey:",qf="nostrkey";function oo(e,t){return{kind:30078,content:t,tags:[["d",`${An}${e}`],["client",qf]],created_at:Math.floor(Date.now()/1e3)}}function so(e,t){return{kind:5,content:"vault document deleted",tags:[["e",e],["a",`30078::${An}${t}`]],created_at:Math.floor(Date.now()/1e3)}}function ji(e){return{kinds:[30078],authors:[e]}}function Zi(e){if(e.kind!==30078)return null;let t=e.tags?.find(r=>r[0]==="d");if(!t||!t[1]?.startsWith(An))return null;let n=t[1].slice(An.length);return n?{path:n,content:e.content,createdAt:e.created_at,eventId:e.id}:null}var Ln=de.storage.local,Mt=e=>{},Te={},Be={mutex:new bn,release:null,tabId:null},io=new Map,Kf=5,$f=1e4;function Vf(e){let t=Date.now(),n=io.get(e)||[];return n=n.filter(r=>t-r<$f),n.length>=Kf?(io.set(e,n),!0):(n.push(t),io.set(e,n),!1)}var bt=new Map,Nt=null,mt=!0,Gi=15*60*1e3,wt=null;function Ze(){wt&&clearTimeout(wt),mt||(wt=setTimeout(()=>{Fi()},Gi))}function Fi(){bt.clear(),Nt=null,mt=!0,wt&&(clearTimeout(wt),wt=null),Mt("Session locked.")}async function ao(e){if(!await _n(e))return{success:!1,error:"Invalid password"};let n=await ze();for(let r=0;r<n.length;r++){if(n[r].type==="bunker")continue;let o=await Si(n[r],e);bt.set(r,o)}return Nt=e,mt=!1,Ze(),Mt("Session unlocked."),{success:!0}}async function Ji(){return await kn()?mt:(mt=!1,!1)}de.runtime.onMessage.addListener((e,t,n)=>{Mt(e);let r=crypto.randomUUID(),o;switch(e.kind){case"closePrompt":return Be.release?.(),Promise.resolve(!0);case"allowed":return Ze(),Yi(e),Promise.resolve(!0);case"denied":return co(e),Promise.resolve(!0);case"generatePrivateKey":return Promise.resolve(zf());case"savePrivateKey":return Ze(),Zf(e.payload);case"getNpub":return Ze(),Ff(e.payload);case"getNsec":return Ze(),Gf(e.payload);case"calcPubKey":return Promise.resolve(De(e.payload));case"npubEncode":return Promise.resolve(We.npubEncode(e.payload));case"copy":return typeof navigator<"u"&&navigator.clipboard?.writeText?navigator.clipboard.writeText(e.payload):Promise.resolve(!1);case"isLocked":return Ji();case"isEncrypted":return kn();case"unlock":return ao(e.payload);case"lock":return Fi(),Promise.resolve(!0);case"setPassword":return(async()=>(await _i(e.payload),ao(e.payload)))();case"changePassword":return(async()=>{let{oldPassword:s,newPassword:i}=e.payload;return await _n(s)?(await Bi(s,i),ao(i)):{success:!1,error:"Invalid current password"}})();case"removePassword":return(async()=>{try{return await ki(e.payload),bt.clear(),Nt=null,mt=!1,{success:!0}}catch(s){return{success:!1,error:s.message}}})();case"setAutoLockTimeout":return Gi=e.payload*60*1e3,Ze(),Promise.resolve(!0);case"resetAutoLock":return Ze(),Promise.resolve(!0);case"getProfileType":return(async()=>{let s=e.payload??await te();return(await ae(s))?.type||"local"})();case"bunker.connect":return(async()=>{try{let{profileIndex:s,bunkerUrl:i}=e.payload,c=await(await $i(s,i)).getPublicKey(),l=await ze();return l[s].remotePubkey=c,l[s].bunkerUrl=i,await Ln.set({profiles:l}),{success:!0,remotePubkey:c}}catch(s){return{success:!1,error:s.message}}})();case"bunker.disconnect":return(async()=>{try{let s=e.payload;return await Vi(s),{success:!0}}catch(s){return{success:!1,error:s.message}}})();case"bunker.status":return(async()=>{let s=e.payload??await te();return{connected:Wi(s)}})();case"bunker.ping":return(async()=>{try{let s=e.payload??await te();return{success:!0,result:await(await Ee(s)).ping()}}catch(s){return{success:!1,error:s.message}}})();case"bunker.validateUrl":return Promise.resolve(zi(e.payload));case"vault.publish":return(async()=>{try{let{path:s,content:i}=e.payload,a=await je(),c=await Rn({pubKey:a,plainText:i}),l=oo(s,c),u=await te(),f=await ae(u),h;if(f.type==="bunker")h=await(await Ee(u)).signEvent(l);else{let d=await Le();h=re(l,d)}return await gt("write",async d=>{for(let p of d)try{p.publish(h)}catch{}}),{success:!0,eventId:h.id,createdAt:h.created_at}}catch(s){return{success:!1,error:s.message}}})();case"vault.fetch":return(async()=>{try{let s=await je(),i=ji(s),a=[];await gt("read",async f=>{let h=f.map(d=>new Promise(p=>{let g=`vault-${crypto.randomUUID().slice(0,8)}`,w=setTimeout(()=>{try{d.unsubscribe(g)}catch{}p()},15e3);d.subscribe(g,[i],v=>{a.push(v)},()=>{clearTimeout(w);try{d.unsubscribe(g)}catch{}p()})}));await Promise.all(h)});let c=new Map;for(let f of a){let h=Zi(f);if(!h)continue;let d=c.get(h.path);(!d||h.createdAt>d.createdAt)&&c.set(h.path,{event:f,parsed:h})}let l=[],u=await je();for(let{event:f,parsed:h}of c.values())try{let d=await Tn({pubKey:u,cipherText:f.content});l.push({path:h.path,content:d,createdAt:h.createdAt,eventId:h.eventId})}catch{}return{success:!0,documents:l}}catch(s){return{success:!1,error:s.message}}})();case"vault.delete":return(async()=>{try{let{path:s,eventId:i}=e.payload,a=so(i,s),c=await te(),l=await ae(c),u;if(l.type==="bunker")u=await(await Ee(c)).signEvent(a);else{let f=await Le();u=re(a,f)}return await gt("write",async f=>{for(let h of f)try{h.publish(u)}catch{}}),{success:!0}}catch(s){return{success:!1,error:s.message}}})();case"vault.getRelays":return(async()=>{try{let i=(await In()).relays||[],a=i.filter(l=>l.read).map(l=>l.url),c=i.filter(l=>l.write).map(l=>l.url);return{read:a,write:c}}catch{return{read:[],write:[]}}})();case"apikeys.publish":return(async()=>{try{let{keys:s}=e.payload,i=await je(),a=JSON.stringify(s),c=await Rn({pubKey:i,plainText:a}),l=oo("vault/api-keys",c),u=await te(),f=await ae(u),h;if(f.type==="bunker")h=await(await Ee(u)).signEvent(l);else{let d=await Le();h=re(l,d)}return await gt("write",async d=>{for(let p of d)try{p.publish(h)}catch{}}),{success:!0,eventId:h.id,createdAt:h.created_at}}catch(s){return{success:!1,error:s.message}}})();case"apikeys.fetch":return(async()=>{try{let s=await je(),i={kinds:[30078],authors:[s],"#d":["nostrkey:vault/api-keys"]},a=[];await gt("read",async f=>{let h=f.map(d=>new Promise(p=>{let g=`apikeys-${crypto.randomUUID().slice(0,8)}`,w=setTimeout(()=>{try{d.unsubscribe(g)}catch{}p()},15e3);d.subscribe(g,[i],v=>{a.push(v)},()=>{clearTimeout(w);try{d.unsubscribe(g)}catch{}p()})}));await Promise.all(h)});let c=null;for(let f of a)(!c||f.created_at>c.created_at)&&(c=f);if(!c)return{success:!0,keys:null,eventId:null,createdAt:null};let l=await Tn({pubKey:s,cipherText:c.content});return{success:!0,keys:JSON.parse(l),eventId:c.id,createdAt:c.created_at}}catch(s){return{success:!1,error:s.message}}})();case"apikeys.delete":return(async()=>{try{let{eventId:s}=e.payload,i=so(s,"vault/api-keys"),a=await te(),c=await ae(a),l;if(c.type==="bunker")l=await(await Ee(a)).signEvent(i);else{let u=await Le();l=re(i,u)}return await gt("write",async u=>{for(let f of u)try{f.publish(l)}catch{}}),{success:!0}}catch(s){return{success:!1,error:s.message}}})();case"apikeys.encrypt":return(async()=>{try{let{plainText:s}=e.payload,i=await je();return{success:!0,cipherText:await Rn({pubKey:i,plainText:s})}}catch(s){return{success:!1,error:s.message}}})();case"apikeys.decrypt":return(async()=>{try{let{cipherText:s}=e.payload,i=await je();return{success:!0,plainText:await Tn({pubKey:i,cipherText:s})}}catch(s){return{success:!1,error:s.message}}})();case"replaceURL":return(async()=>{let{protocol_handler:s}=await Ln.get(["protocol_handler"]);if(!s)return!1;let{url:i}=e.payload,a=i.split("nostr:")[1];if(!a)return!1;try{let{type:c,data:l}=We.decode(a),u={raw:a,hrp:c,hex:c==="npub"||c==="note"?l:c==="nprofile"?l.pubkey:c==="nevent"?l.id:c==="naddr"?l.pubkey:a,p_or_e:{npub:"p",note:"e",nprofile:"p",nevent:"e",naddr:"a"}[c]||"",u_or_n:{npub:"u",note:"n",nprofile:"u",nevent:"n",naddr:"n"}[c]||"",relay0:l?.relays?.[0]||"",relay1:l?.relays?.[1]||"",relay2:l?.relays?.[2]||""},f=s;for(let[h,d]of Object.entries(u))f=f.replace(new RegExp(`\\{ *${h} *\\}`,"g"),d);return f}catch{return!1}})();case"getPubKey":case"signEvent":case"nip04.encrypt":case"nip04.decrypt":case"nip44.encrypt":case"nip44.decrypt":case"getRelays":return Te[r]=n,jf(r,e),setTimeout(()=>{Te[r]&&co({payload:r,origKind:e.kind,host:e.host}),Be.release?.()},1e4),!0;default:return Promise.resolve()}});async function Wf(){if(Be.tabId!==null)try{await de.tabs.get(Be.tabId)}catch{Be.release?.(),Be.tabId=null}}async function zf(){let e=Lt();return N(e)}async function jf(e,{kind:t,host:n,payload:r}){let o=await te();if(!((await ae(o))?.type==="bunker")&&await Ji()){let d=Te[e];delete Te[e],d?.({error:"locked",message:"Extension is locked. Please unlock with your master password."});return}if(Vf(n)){let h=Te[e];delete Te[e],h?.({error:"rate_limited",message:"Too many requests. Please wait."}),Mt(`Rate limited: ${n}`);return}Ze(),await Wf(),Be.release=await Be.mutex.acquire();let a=t==="signEvent"?`signEvent:${r.kind}`:t,c=await Ei(n,a);if(c==="allow"){Yi({payload:e,origKind:t,event:r,remember:!1,host:n}),Be.release();return}if(c==="deny"){co({payload:e,origKind:t,host:n}),Be.release();return}let l=new URLSearchParams({uuid:e,kind:t,host:n,payload:JSON.stringify(r||!1)}),u=await de.tabs.getCurrent(),f=await de.tabs.create({url:de.runtime.getURL(`permission/permission.html?${l.toString()}`),openerTabId:u?.id});return Be.tabId=f.id,!0}function Yi({payload:e,origKind:t,event:n,remember:r,host:o}){let s=Te[e];if(delete Te[e],r){let i=t==="signEvent"?`signEvent:${n.kind}`:t;Fr(o,i,"allow")}if(s){let i=a=>{Mt(`Error in ${t}: ${a.message}`),s({error:"bunker_error",message:a.message})};switch(t){case"getPubKey":je().then(a=>s(a)).catch(i);break;case"signEvent":Jf(n,o).then(a=>s(a)).catch(i);break;case"nip04.encrypt":Yf(n).then(a=>s(a)).catch(i);break;case"nip04.decrypt":Xf(n).then(a=>s(a)).catch(i);break;case"nip44.encrypt":Rn(n).then(a=>s(a)).catch(i);break;case"nip44.decrypt":Tn(n).then(a=>s(a)).catch(i);break;case"getRelays":Qf().then(a=>s(a)).catch(i);break}}}function co({origKind:e,host:t,payload:n,remember:r,event:o}){let s=Te[n];if(delete Te[n],r){let i=e==="signEvent"?`signEvent:${o.kind}`:e;Fr(t,i,"deny")}return s?.(void 0),!1}async function Zf([e,t]){if((await ae(e))?.type==="bunker")throw new Error("Cannot set private key on a bunker profile");if(typeof t!="string"||t.length===0)throw new Error("Invalid private key: must be a non-empty string");if(t.startsWith("nsec"))try{t=We.decode(t).data}catch{throw new Error("Invalid nsec key")}let r=N(t);if(!/^[0-9a-f]{64}$/i.test(r))throw new Error("Invalid private key: must be 64 hex characters or valid nsec");let o=await En("profiles");if(!o||e<0||e>=o.length)throw new Error("Invalid profile index");return await kn()&&Nt?(o[e].privKey=await Ut(r,Nt),bt.set(e,r)):o[e].privKey=r,await Ln.set({profiles:o}),!0}async function Gf(e){let t=await ae(e);if(t.type==="bunker")return null;let n=await lo(e,t);return We.nsecEncode(O(n))}async function Ff(e){let t=await ae(e);if(t.type==="bunker")return t.remotePubkey?We.npubEncode(t.remotePubkey):null;let n=await lo(e,t),r=De(O(n));return We.npubEncode(r)}async function lo(e,t){if(yt(t.privKey)){if(bt.has(e))return bt.get(e);throw new Error("Extension is locked \u2014 cannot access private key")}return t.privKey}async function Le(){let e=await te(),t=await In(),n=await lo(e,t);return O(n)}async function je(){let e=await te(),t=await ae(e);if(t.type==="bunker"){if(t.remotePubkey)return t.remotePubkey;let s=await(await Ee(e)).getPublicKey(),i=await En("profiles");return i[e].remotePubkey=s,await Ln.set({profiles:i}),s}let n=await Le();return De(n)}async function In(){let e=await te();return(await En("profiles"))[e]}async function Jf(e,t){e=JSON.parse(JSON.stringify(e));let n=await te();if((await ae(n)).type==="bunker")e=await(await Ee(n)).signEvent(e);else{let o=await Le();e=re(e,o)}return Oi({event:e,metadata:{host:t,signed_at:Math.round(Date.now()/1e3)}}),e}async function Yf({pubKey:e,plainText:t}){let n=await te();if((await ae(n)).type==="bunker")return(await Ee(n)).nip04Encrypt(e,t);let o=await Le();return gn.encrypt(o,e,t)}async function Xf({pubKey:e,cipherText:t}){let n=await te();if((await ae(n)).type==="bunker")return(await Ee(n)).nip04Decrypt(e,t);let o=await Le();return gn.decrypt(o,e,t)}async function Rn({pubKey:e,plainText:t}){let n=await te();if((await ae(n)).type==="bunker")return(await Ee(n)).nip44Encrypt(e,t);let o=await Le(),s=pt.v2.utils.getConversationKey(o,e);return pt.v2.encrypt(t,s)}async function Tn({pubKey:e,cipherText:t}){let n=await te();if((await ae(n)).type==="bunker")return(await Ee(n)).nip44Decrypt(e,t);let o=await Le(),s=pt.v2.utils.getConversationKey(o,e);return pt.v2.decrypt(t,s)}async function Qf(){let t=(await In()).relays,n={};return t.forEach(r=>{let{url:o,read:s,write:i}=r;n[o]={read:s,write:i}}),n}async function gt(e,t){let o=((await In()).relays||[]).filter(a=>e==="read"?a.read:a.write).map(a=>a.url);if(o.length===0)throw new Error("No relays configured");let s=[],i=o.map(async a=>{let c=new Ot(a);try{await c.connect(),s.push(c)}catch{}});if(await Promise.allSettled(i),s.length===0)throw new Error("Failed to connect to any relay");try{await t(s)}finally{for(let a of s)a.close()}}})();
/*! Bundled license information:

@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@scure/base/index.js:
  (*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
