(()=>{window.nostr={requests:{},async getPublicKey(){return await this.broadcast("getPubKey")},async signEvent(t){return await this.broadcast("signEvent",t)},async getRelays(){return await this.broadcast("getRelays")},async enable(){return{enabled:!0}},broadcast(t,e){let n=crypto.randomUUID();return new Promise((r,s)=>{let a=setTimeout(()=>{delete this.requests[n],s(new Error("NostrKey: request timed out"))},3e4);this.requests[n]=i=>{clearTimeout(a),r(i)},window.postMessage({kind:t,reqId:n,payload:e},"*")})},nip04:{async encrypt(t,e){return await window.nostr.broadcast("nip04.encrypt",{pubKey:t,plainText:e})},async decrypt(t,e){return await window.nostr.broadcast("nip04.decrypt",{pubKey:t,cipherText:e})}},nip44:{async encrypt(t,e){return await window.nostr.broadcast("nip44.encrypt",{pubKey:t,plainText:e})},async decrypt(t,e){return await window.nostr.broadcast("nip44.decrypt",{pubKey:t,cipherText:e})}}};window.addEventListener("message",t=>{let e=["getPubKey","signEvent","getRelays","nip04.encrypt","nip04.decrypt","nip44.encrypt","nip44.decrypt"].map(a=>`return_${a}`),{kind:n,reqId:r,payload:s}=t.data;e.includes(n)&&(window.nostr.requests[r]?.(s),delete window.nostr.requests[r])});})();
