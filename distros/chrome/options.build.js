(()=>{var Pr=Object.create;var tt=Object.defineProperty;var kr=Object.getOwnPropertyDescriptor;var Br=Object.getOwnPropertyNames;var vr=Object.getPrototypeOf,Ir=Object.prototype.hasOwnProperty;var m=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var xr=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Br(e))!Ir.call(t,i)&&i!==r&&tt(t,i,{get:()=>e[i],enumerable:!(s=kr(e,i))||s.enumerable});return t};var Cr=(t,e,r)=>(r=t!=null?Pr(vr(t)):{},xr(e||!t||!t.__esModule?tt(r,"default",{value:t,enumerable:!0}):r,t));var yt=m((bo,ft)=>{ft.exports=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}});var A=m(q=>{var xe,Lr=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];q.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};q.getSymbolTotalCodewords=function(e){return Lr[e]};q.getBCHDigit=function(t){let e=0;for(;t!==0;)e++,t>>>=1;return e};q.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');xe=e};q.isKanjiModeEnabled=function(){return typeof xe<"u"};q.toSJIS=function(e){return xe(e)}});var ie=m(x=>{x.L={bit:1};x.M={bit:0};x.Q={bit:3};x.H={bit:2};function Tr(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return x.L;case"m":case"medium":return x.M;case"q":case"quartile":return x.Q;case"h":case"high":return x.H;default:throw new Error("Unknown EC Level: "+t)}}x.isValid=function(e){return e&&typeof e.bit<"u"&&e.bit>=0&&e.bit<4};x.from=function(e,r){if(x.isValid(e))return e;try{return Tr(e)}catch{return r}}});var mt=m((ko,ht)=>{function gt(){this.buffer=[],this.length=0}gt.prototype={get:function(t){let e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)===1},put:function(t,e){for(let r=0;r<e;r++)this.putBit((t>>>e-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){let e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};ht.exports=gt});var bt=m((Bo,wt)=>{function Y(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}Y.prototype.set=function(t,e,r,s){let i=t*this.size+e;this.data[i]=r,s&&(this.reservedBit[i]=!0)};Y.prototype.get=function(t,e){return this.data[t*this.size+e]};Y.prototype.xor=function(t,e,r){this.data[t*this.size+e]^=r};Y.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]};wt.exports=Y});var Et=m(ae=>{var Mr=A().getSymbolSize;ae.getRowColCoords=function(e){if(e===1)return[];let r=Math.floor(e/7)+2,s=Mr(e),i=s===145?26:Math.ceil((s-13)/(2*r-2))*2,a=[s-7];for(let c=1;c<r-1;c++)a[c]=a[c-1]-i;return a.push(6),a.reverse()};ae.getPositions=function(e){let r=[],s=ae.getRowColCoords(e),i=s.length;for(let a=0;a<i;a++)for(let c=0;c<i;c++)a===0&&c===0||a===0&&c===i-1||a===i-1&&c===0||r.push([s[a],s[c]]);return r}});var Bt=m(kt=>{var Ar=A().getSymbolSize,Pt=7;kt.getPositions=function(e){let r=Ar(e);return[[0,0],[r-Pt,0],[0,r-Pt]]}});var vt=m(b=>{b.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var H={N1:3,N2:3,N3:40,N4:10};b.isValid=function(e){return e!=null&&e!==""&&!isNaN(e)&&e>=0&&e<=7};b.from=function(e){return b.isValid(e)?parseInt(e,10):void 0};b.getPenaltyN1=function(e){let r=e.size,s=0,i=0,a=0,c=null,l=null;for(let u=0;u<r;u++){i=a=0,c=l=null;for(let y=0;y<r;y++){let g=e.get(u,y);g===c?i++:(i>=5&&(s+=H.N1+(i-5)),c=g,i=1),g=e.get(y,u),g===l?a++:(a>=5&&(s+=H.N1+(a-5)),l=g,a=1)}i>=5&&(s+=H.N1+(i-5)),a>=5&&(s+=H.N1+(a-5))}return s};b.getPenaltyN2=function(e){let r=e.size,s=0;for(let i=0;i<r-1;i++)for(let a=0;a<r-1;a++){let c=e.get(i,a)+e.get(i,a+1)+e.get(i+1,a)+e.get(i+1,a+1);(c===4||c===0)&&s++}return s*H.N2};b.getPenaltyN3=function(e){let r=e.size,s=0,i=0,a=0;for(let c=0;c<r;c++){i=a=0;for(let l=0;l<r;l++)i=i<<1&2047|e.get(c,l),l>=10&&(i===1488||i===93)&&s++,a=a<<1&2047|e.get(l,c),l>=10&&(a===1488||a===93)&&s++}return s*H.N3};b.getPenaltyN4=function(e){let r=0,s=e.data.length;for(let a=0;a<s;a++)r+=e.data[a];return Math.abs(Math.ceil(r*100/s/5)-10)*H.N4};function Ur(t,e,r){switch(t){case b.Patterns.PATTERN000:return(e+r)%2===0;case b.Patterns.PATTERN001:return e%2===0;case b.Patterns.PATTERN010:return r%3===0;case b.Patterns.PATTERN011:return(e+r)%3===0;case b.Patterns.PATTERN100:return(Math.floor(e/2)+Math.floor(r/3))%2===0;case b.Patterns.PATTERN101:return e*r%2+e*r%3===0;case b.Patterns.PATTERN110:return(e*r%2+e*r%3)%2===0;case b.Patterns.PATTERN111:return(e*r%3+(e+r)%2)%2===0;default:throw new Error("bad maskPattern:"+t)}}b.applyMask=function(e,r){let s=r.size;for(let i=0;i<s;i++)for(let a=0;a<s;a++)r.isReserved(a,i)||r.xor(a,i,Ur(e,a,i))};b.getBestMask=function(e,r){let s=Object.keys(b.Patterns).length,i=0,a=1/0;for(let c=0;c<s;c++){r(c),b.applyMask(c,e);let l=b.getPenaltyN1(e)+b.getPenaltyN2(e)+b.getPenaltyN3(e)+b.getPenaltyN4(e);b.applyMask(c,e),l<a&&(a=l,i=c)}return i}});var Se=m(Ce=>{var U=ie(),ce=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],le=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Ce.getBlocksCount=function(e,r){switch(r){case U.L:return ce[(e-1)*4+0];case U.M:return ce[(e-1)*4+1];case U.Q:return ce[(e-1)*4+2];case U.H:return ce[(e-1)*4+3];default:return}};Ce.getTotalCodewordsCount=function(e,r){switch(r){case U.L:return le[(e-1)*4+0];case U.M:return le[(e-1)*4+1];case U.Q:return le[(e-1)*4+2];case U.H:return le[(e-1)*4+3];default:return}}});var It=m(de=>{var j=new Uint8Array(512),ue=new Uint8Array(256);(function(){let e=1;for(let r=0;r<255;r++)j[r]=e,ue[e]=r,e<<=1,e&256&&(e^=285);for(let r=255;r<512;r++)j[r]=j[r-255]})();de.log=function(e){if(e<1)throw new Error("log("+e+")");return ue[e]};de.exp=function(e){return j[e]};de.mul=function(e,r){return e===0||r===0?0:j[ue[e]+ue[r]]}});var xt=m(G=>{var Ne=It();G.mul=function(e,r){let s=new Uint8Array(e.length+r.length-1);for(let i=0;i<e.length;i++)for(let a=0;a<r.length;a++)s[i+a]^=Ne.mul(e[i],r[a]);return s};G.mod=function(e,r){let s=new Uint8Array(e);for(;s.length-r.length>=0;){let i=s[0];for(let c=0;c<r.length;c++)s[c]^=Ne.mul(r[c],i);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s};G.generateECPolynomial=function(e){let r=new Uint8Array([1]);for(let s=0;s<e;s++)r=G.mul(r,new Uint8Array([1,Ne.exp(s)]));return r}});var Nt=m((Ro,St)=>{var Ct=xt();function Re(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}Re.prototype.initialize=function(e){this.degree=e,this.genPoly=Ct.generateECPolynomial(this.degree)};Re.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");let r=new Uint8Array(e.length+this.degree);r.set(e);let s=Ct.mod(r,this.genPoly),i=this.degree-s.length;if(i>0){let a=new Uint8Array(this.degree);return a.set(s,i),a}return s};St.exports=Re});var Le=m(Rt=>{Rt.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}});var Te=m(L=>{var Lt="[0-9]+",Kr="[A-Z $%*+\\-./:]+",W="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";W=W.replace(/u/g,"\\u");var Dr="(?:(?![A-Z0-9 $%*+\\-./:]|"+W+`)(?:.|[\r
]))+`;L.KANJI=new RegExp(W,"g");L.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");L.BYTE=new RegExp(Dr,"g");L.NUMERIC=new RegExp(Lt,"g");L.ALPHANUMERIC=new RegExp(Kr,"g");var qr=new RegExp("^"+W+"$"),Hr=new RegExp("^"+Lt+"$"),_r=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");L.testKanji=function(e){return qr.test(e)};L.testNumeric=function(e){return Hr.test(e)};L.testAlphanumeric=function(e){return _r.test(e)}});var K=m(P=>{var Fr=Le(),Me=Te();P.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]};P.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]};P.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]};P.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]};P.MIXED={bit:-1};P.getCharCountIndicator=function(e,r){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!Fr.isValid(r))throw new Error("Invalid version: "+r);return r>=1&&r<10?e.ccBits[0]:r<27?e.ccBits[1]:e.ccBits[2]};P.getBestModeForData=function(e){return Me.testNumeric(e)?P.NUMERIC:Me.testAlphanumeric(e)?P.ALPHANUMERIC:Me.testKanji(e)?P.KANJI:P.BYTE};P.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")};P.isValid=function(e){return e&&e.bit&&e.ccBits};function Qr(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return P.NUMERIC;case"alphanumeric":return P.ALPHANUMERIC;case"kanji":return P.KANJI;case"byte":return P.BYTE;default:throw new Error("Unknown mode: "+t)}}P.from=function(e,r){if(P.isValid(e))return e;try{return Qr(e)}catch{return r}}});var Kt=m(_=>{var pe=A(),zr=Se(),Tt=ie(),D=K(),Ae=Le(),At=7973,Mt=pe.getBCHDigit(At);function Or(t,e,r){for(let s=1;s<=40;s++)if(e<=_.getCapacity(s,r,t))return s}function Ut(t,e){return D.getCharCountIndicator(t,e)+4}function Vr(t,e){let r=0;return t.forEach(function(s){let i=Ut(s.mode,e);r+=i+s.getBitsLength()}),r}function $r(t,e){for(let r=1;r<=40;r++)if(Vr(t,r)<=_.getCapacity(r,e,D.MIXED))return r}_.from=function(e,r){return Ae.isValid(e)?parseInt(e,10):r};_.getCapacity=function(e,r,s){if(!Ae.isValid(e))throw new Error("Invalid QR Code version");typeof s>"u"&&(s=D.BYTE);let i=pe.getSymbolTotalCodewords(e),a=zr.getTotalCodewordsCount(e,r),c=(i-a)*8;if(s===D.MIXED)return c;let l=c-Ut(s,e);switch(s){case D.NUMERIC:return Math.floor(l/10*3);case D.ALPHANUMERIC:return Math.floor(l/11*2);case D.KANJI:return Math.floor(l/13);case D.BYTE:default:return Math.floor(l/8)}};_.getBestVersionForData=function(e,r){let s,i=Tt.from(r,Tt.M);if(Array.isArray(e)){if(e.length>1)return $r(e,i);if(e.length===0)return 1;s=e[0]}else s=e;return Or(s.mode,s.getLength(),i)};_.getEncodedBits=function(e){if(!Ae.isValid(e)||e<7)throw new Error("Invalid QR Code version");let r=e<<12;for(;pe.getBCHDigit(r)-Mt>=0;)r^=At<<pe.getBCHDigit(r)-Mt;return e<<12|r}});var _t=m(Ht=>{var Ue=A(),qt=1335,Jr=21522,Dt=Ue.getBCHDigit(qt);Ht.getEncodedBits=function(e,r){let s=e.bit<<3|r,i=s<<10;for(;Ue.getBCHDigit(i)-Dt>=0;)i^=qt<<Ue.getBCHDigit(i)-Dt;return(s<<10|i)^Jr}});var Qt=m((Ko,Ft)=>{var Yr=K();function z(t){this.mode=Yr.NUMERIC,this.data=t.toString()}z.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};z.prototype.getLength=function(){return this.data.length};z.prototype.getBitsLength=function(){return z.getBitsLength(this.data.length)};z.prototype.write=function(e){let r,s,i;for(r=0;r+3<=this.data.length;r+=3)s=this.data.substr(r,3),i=parseInt(s,10),e.put(i,10);let a=this.data.length-r;a>0&&(s=this.data.substr(r),i=parseInt(s,10),e.put(i,a*3+1))};Ft.exports=z});var Ot=m((Do,zt)=>{var jr=K(),Ke=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function O(t){this.mode=jr.ALPHANUMERIC,this.data=t}O.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};O.prototype.getLength=function(){return this.data.length};O.prototype.getBitsLength=function(){return O.getBitsLength(this.data.length)};O.prototype.write=function(e){let r;for(r=0;r+2<=this.data.length;r+=2){let s=Ke.indexOf(this.data[r])*45;s+=Ke.indexOf(this.data[r+1]),e.put(s,11)}this.data.length%2&&e.put(Ke.indexOf(this.data[r]),6)};zt.exports=O});var $t=m((qo,Vt)=>{var Gr=K();function V(t){this.mode=Gr.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}V.getBitsLength=function(e){return e*8};V.prototype.getLength=function(){return this.data.length};V.prototype.getBitsLength=function(){return V.getBitsLength(this.data.length)};V.prototype.write=function(t){for(let e=0,r=this.data.length;e<r;e++)t.put(this.data[e],8)};Vt.exports=V});var Yt=m((Ho,Jt)=>{var Wr=K(),Zr=A();function $(t){this.mode=Wr.KANJI,this.data=t}$.getBitsLength=function(e){return e*13};$.prototype.getLength=function(){return this.data.length};$.prototype.getBitsLength=function(){return $.getBitsLength(this.data.length)};$.prototype.write=function(t){let e;for(e=0;e<this.data.length;e++){let r=Zr.toSJIS(this.data[e]);if(r>=33088&&r<=40956)r-=33088;else if(r>=57408&&r<=60351)r-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);r=(r>>>8&255)*192+(r&255),t.put(r,13)}};Jt.exports=$});var jt=m((_o,De)=>{"use strict";var Z={single_source_shortest_paths:function(t,e,r){var s={},i={};i[e]=0;var a=Z.PriorityQueue.make();a.push(e,0);for(var c,l,u,y,g,B,E,C,T;!a.empty();){c=a.pop(),l=c.value,y=c.cost,g=t[l]||{};for(u in g)g.hasOwnProperty(u)&&(B=g[u],E=y+B,C=i[u],T=typeof i[u]>"u",(T||C>E)&&(i[u]=E,a.push(u,E),s[u]=l))}if(typeof r<"u"&&typeof i[r]>"u"){var M=["Could not find a path from ",e," to ",r,"."].join("");throw new Error(M)}return s},extract_shortest_path_from_predecessor_list:function(t,e){for(var r=[],s=e,i;s;)r.push(s),i=t[s],s=t[s];return r.reverse(),r},find_path:function(t,e,r){var s=Z.single_source_shortest_paths(t,e,r);return Z.extract_shortest_path_from_predecessor_list(s,r)},PriorityQueue:{make:function(t){var e=Z.PriorityQueue,r={},s;t=t||{};for(s in e)e.hasOwnProperty(s)&&(r[s]=e[s]);return r.queue=[],r.sorter=t.sorter||e.default_sorter,r},default_sorter:function(t,e){return t.cost-e.cost},push:function(t,e){var r={value:t,cost:e};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};typeof De<"u"&&(De.exports=Z)});var nr=m(J=>{var h=K(),Zt=Qt(),Xt=Ot(),er=$t(),tr=Yt(),X=Te(),fe=A(),Xr=jt();function Gt(t){return unescape(encodeURIComponent(t)).length}function ee(t,e,r){let s=[],i;for(;(i=t.exec(r))!==null;)s.push({data:i[0],index:i.index,mode:e,length:i[0].length});return s}function rr(t){let e=ee(X.NUMERIC,h.NUMERIC,t),r=ee(X.ALPHANUMERIC,h.ALPHANUMERIC,t),s,i;return fe.isKanjiModeEnabled()?(s=ee(X.BYTE,h.BYTE,t),i=ee(X.KANJI,h.KANJI,t)):(s=ee(X.BYTE_KANJI,h.BYTE,t),i=[]),e.concat(r,s,i).sort(function(c,l){return c.index-l.index}).map(function(c){return{data:c.data,mode:c.mode,length:c.length}})}function qe(t,e){switch(e){case h.NUMERIC:return Zt.getBitsLength(t);case h.ALPHANUMERIC:return Xt.getBitsLength(t);case h.KANJI:return tr.getBitsLength(t);case h.BYTE:return er.getBitsLength(t)}}function en(t){return t.reduce(function(e,r){let s=e.length-1>=0?e[e.length-1]:null;return s&&s.mode===r.mode?(e[e.length-1].data+=r.data,e):(e.push(r),e)},[])}function tn(t){let e=[];for(let r=0;r<t.length;r++){let s=t[r];switch(s.mode){case h.NUMERIC:e.push([s,{data:s.data,mode:h.ALPHANUMERIC,length:s.length},{data:s.data,mode:h.BYTE,length:s.length}]);break;case h.ALPHANUMERIC:e.push([s,{data:s.data,mode:h.BYTE,length:s.length}]);break;case h.KANJI:e.push([s,{data:s.data,mode:h.BYTE,length:Gt(s.data)}]);break;case h.BYTE:e.push([{data:s.data,mode:h.BYTE,length:Gt(s.data)}])}}return e}function rn(t,e){let r={},s={start:{}},i=["start"];for(let a=0;a<t.length;a++){let c=t[a],l=[];for(let u=0;u<c.length;u++){let y=c[u],g=""+a+u;l.push(g),r[g]={node:y,lastCount:0},s[g]={};for(let B=0;B<i.length;B++){let E=i[B];r[E]&&r[E].node.mode===y.mode?(s[E][g]=qe(r[E].lastCount+y.length,y.mode)-qe(r[E].lastCount,y.mode),r[E].lastCount+=y.length):(r[E]&&(r[E].lastCount=y.length),s[E][g]=qe(y.length,y.mode)+4+h.getCharCountIndicator(y.mode,e))}}i=l}for(let a=0;a<i.length;a++)s[i[a]].end=0;return{map:s,table:r}}function Wt(t,e){let r,s=h.getBestModeForData(t);if(r=h.from(e,s),r!==h.BYTE&&r.bit<s.bit)throw new Error('"'+t+'" cannot be encoded with mode '+h.toString(r)+`.
 Suggested mode is: `+h.toString(s));switch(r===h.KANJI&&!fe.isKanjiModeEnabled()&&(r=h.BYTE),r){case h.NUMERIC:return new Zt(t);case h.ALPHANUMERIC:return new Xt(t);case h.KANJI:return new tr(t);case h.BYTE:return new er(t)}}J.fromArray=function(e){return e.reduce(function(r,s){return typeof s=="string"?r.push(Wt(s,null)):s.data&&r.push(Wt(s.data,s.mode)),r},[])};J.fromString=function(e,r){let s=rr(e,fe.isKanjiModeEnabled()),i=tn(s),a=rn(i,r),c=Xr.find_path(a.map,"start","end"),l=[];for(let u=1;u<c.length-1;u++)l.push(a.table[c[u]].node);return J.fromArray(en(l))};J.rawSplit=function(e){return J.fromArray(rr(e,fe.isKanjiModeEnabled()))}});var sr=m(or=>{var ge=A(),He=ie(),nn=mt(),on=bt(),sn=Et(),an=Bt(),Qe=vt(),ze=Se(),cn=Nt(),ye=Kt(),ln=_t(),un=K(),_e=nr();function dn(t,e){let r=t.size,s=an.getPositions(e);for(let i=0;i<s.length;i++){let a=s[i][0],c=s[i][1];for(let l=-1;l<=7;l++)if(!(a+l<=-1||r<=a+l))for(let u=-1;u<=7;u++)c+u<=-1||r<=c+u||(l>=0&&l<=6&&(u===0||u===6)||u>=0&&u<=6&&(l===0||l===6)||l>=2&&l<=4&&u>=2&&u<=4?t.set(a+l,c+u,!0,!0):t.set(a+l,c+u,!1,!0))}}function pn(t){let e=t.size;for(let r=8;r<e-8;r++){let s=r%2===0;t.set(r,6,s,!0),t.set(6,r,s,!0)}}function fn(t,e){let r=sn.getPositions(e);for(let s=0;s<r.length;s++){let i=r[s][0],a=r[s][1];for(let c=-2;c<=2;c++)for(let l=-2;l<=2;l++)c===-2||c===2||l===-2||l===2||c===0&&l===0?t.set(i+c,a+l,!0,!0):t.set(i+c,a+l,!1,!0)}}function yn(t,e){let r=t.size,s=ye.getEncodedBits(e),i,a,c;for(let l=0;l<18;l++)i=Math.floor(l/3),a=l%3+r-8-3,c=(s>>l&1)===1,t.set(i,a,c,!0),t.set(a,i,c,!0)}function Fe(t,e,r){let s=t.size,i=ln.getEncodedBits(e,r),a,c;for(a=0;a<15;a++)c=(i>>a&1)===1,a<6?t.set(a,8,c,!0):a<8?t.set(a+1,8,c,!0):t.set(s-15+a,8,c,!0),a<8?t.set(8,s-a-1,c,!0):a<9?t.set(8,15-a-1+1,c,!0):t.set(8,15-a-1,c,!0);t.set(s-8,8,1,!0)}function gn(t,e){let r=t.size,s=-1,i=r-1,a=7,c=0;for(let l=r-1;l>0;l-=2)for(l===6&&l--;;){for(let u=0;u<2;u++)if(!t.isReserved(i,l-u)){let y=!1;c<e.length&&(y=(e[c]>>>a&1)===1),t.set(i,l-u,y),a--,a===-1&&(c++,a=7)}if(i+=s,i<0||r<=i){i-=s,s=-s;break}}}function hn(t,e,r){let s=new nn;r.forEach(function(u){s.put(u.mode.bit,4),s.put(u.getLength(),un.getCharCountIndicator(u.mode,t)),u.write(s)});let i=ge.getSymbolTotalCodewords(t),a=ze.getTotalCodewordsCount(t,e),c=(i-a)*8;for(s.getLengthInBits()+4<=c&&s.put(0,4);s.getLengthInBits()%8!==0;)s.putBit(0);let l=(c-s.getLengthInBits())/8;for(let u=0;u<l;u++)s.put(u%2?17:236,8);return mn(s,t,e)}function mn(t,e,r){let s=ge.getSymbolTotalCodewords(e),i=ze.getTotalCodewordsCount(e,r),a=s-i,c=ze.getBlocksCount(e,r),l=s%c,u=c-l,y=Math.floor(s/c),g=Math.floor(a/c),B=g+1,E=y-g,C=new cn(E),T=0,M=new Array(c),Xe=new Array(c),we=0,Er=new Uint8Array(t.buffer);for(let Q=0;Q<c;Q++){let Ee=Q<u?g:B;M[Q]=Er.slice(T,T+Ee),Xe[Q]=C.encode(M[Q]),T+=Ee,we=Math.max(we,Ee)}let be=new Uint8Array(s),et=0,N,R;for(N=0;N<we;N++)for(R=0;R<c;R++)N<M[R].length&&(be[et++]=M[R][N]);for(N=0;N<E;N++)for(R=0;R<c;R++)be[et++]=Xe[R][N];return be}function wn(t,e,r,s){let i;if(Array.isArray(t))i=_e.fromArray(t);else if(typeof t=="string"){let y=e;if(!y){let g=_e.rawSplit(t);y=ye.getBestVersionForData(g,r)}i=_e.fromString(t,y||40)}else throw new Error("Invalid data");let a=ye.getBestVersionForData(i,r);if(!a)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=a;else if(e<a)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+a+`.
`);let c=hn(e,r,i),l=ge.getSymbolSize(e),u=new on(l);return dn(u,e),pn(u),fn(u,e),Fe(u,r,0),e>=7&&yn(u,e),gn(u,c),isNaN(s)&&(s=Qe.getBestMask(u,Fe.bind(null,u,r))),Qe.applyMask(s,u),Fe(u,r,s),{modules:u,version:e,errorCorrectionLevel:r,maskPattern:s,segments:i}}or.create=function(e,r){if(typeof e>"u"||e==="")throw new Error("No input text");let s=He.M,i,a;return typeof r<"u"&&(s=He.from(r.errorCorrectionLevel,He.M),i=ye.from(r.version),a=Qe.from(r.maskPattern),r.toSJISFunc&&ge.setToSJISFunction(r.toSJISFunc)),wn(e,i,s,a)}});var Oe=m(F=>{function ir(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let e=t.slice().replace("#","").split("");if(e.length<3||e.length===5||e.length>8)throw new Error("Invalid hex color: "+t);(e.length===3||e.length===4)&&(e=Array.prototype.concat.apply([],e.map(function(s){return[s,s]}))),e.length===6&&e.push("F","F");let r=parseInt(e.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+e.slice(0,6).join("")}}F.getOptions=function(e){e||(e={}),e.color||(e.color={});let r=typeof e.margin>"u"||e.margin===null||e.margin<0?4:e.margin,s=e.width&&e.width>=21?e.width:void 0,i=e.scale||4;return{width:s,scale:s?4:i,margin:r,color:{dark:ir(e.color.dark||"#000000ff"),light:ir(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}};F.getScale=function(e,r){return r.width&&r.width>=e+r.margin*2?r.width/(e+r.margin*2):r.scale};F.getImageWidth=function(e,r){let s=F.getScale(e,r);return Math.floor((e+r.margin*2)*s)};F.qrToImageData=function(e,r,s){let i=r.modules.size,a=r.modules.data,c=F.getScale(i,s),l=Math.floor((i+s.margin*2)*c),u=s.margin*c,y=[s.color.light,s.color.dark];for(let g=0;g<l;g++)for(let B=0;B<l;B++){let E=(g*l+B)*4,C=s.color.light;if(g>=u&&B>=u&&g<l-u&&B<l-u){let T=Math.floor((g-u)/c),M=Math.floor((B-u)/c);C=y[a[T*i+M]?1:0]}e[E++]=C.r,e[E++]=C.g,e[E++]=C.b,e[E]=C.a}}});var ar=m(he=>{var Ve=Oe();function bn(t,e,r){t.clearRect(0,0,e.width,e.height),e.style||(e.style={}),e.height=r,e.width=r,e.style.height=r+"px",e.style.width=r+"px"}function En(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}he.render=function(e,r,s){let i=s,a=r;typeof i>"u"&&(!r||!r.getContext)&&(i=r,r=void 0),r||(a=En()),i=Ve.getOptions(i);let c=Ve.getImageWidth(e.modules.size,i),l=a.getContext("2d"),u=l.createImageData(c,c);return Ve.qrToImageData(u.data,e,i),bn(l,a,c),l.putImageData(u,0,0),a};he.renderToDataURL=function(e,r,s){let i=s;typeof i>"u"&&(!r||!r.getContext)&&(i=r,r=void 0),i||(i={});let a=he.render(e,r,i),c=i.type||"image/png",l=i.rendererOpts||{};return a.toDataURL(c,l.quality)}});var ur=m(lr=>{var Pn=Oe();function cr(t,e){let r=t.a/255,s=e+'="'+t.hex+'"';return r<1?s+" "+e+'-opacity="'+r.toFixed(2).slice(1)+'"':s}function $e(t,e,r){let s=t+e;return typeof r<"u"&&(s+=" "+r),s}function kn(t,e,r){let s="",i=0,a=!1,c=0;for(let l=0;l<t.length;l++){let u=Math.floor(l%e),y=Math.floor(l/e);!u&&!a&&(a=!0),t[l]?(c++,l>0&&u>0&&t[l-1]||(s+=a?$e("M",u+r,.5+y+r):$e("m",i,0),i=0,a=!1),u+1<e&&t[l+1]||(s+=$e("h",c),c=0)):i++}return s}lr.render=function(e,r,s){let i=Pn.getOptions(r),a=e.modules.size,c=e.modules.data,l=a+i.margin*2,u=i.color.light.a?"<path "+cr(i.color.light,"fill")+' d="M0 0h'+l+"v"+l+'H0z"/>':"",y="<path "+cr(i.color.dark,"stroke")+' d="'+kn(c,a,i.margin)+'"/>',g='viewBox="0 0 '+l+" "+l+'"',E='<svg xmlns="http://www.w3.org/2000/svg" '+(i.width?'width="'+i.width+'" height="'+i.width+'" ':"")+g+' shape-rendering="crispEdges">'+u+y+`</svg>
`;return typeof s=="function"&&s(null,E),E}});var pr=m(te=>{var Bn=yt(),Je=sr(),dr=ar(),vn=ur();function Ye(t,e,r,s,i){let a=[].slice.call(arguments,1),c=a.length,l=typeof a[c-1]=="function";if(!l&&!Bn())throw new Error("Callback required as last argument");if(l){if(c<2)throw new Error("Too few arguments provided");c===2?(i=r,r=e,e=s=void 0):c===3&&(e.getContext&&typeof i>"u"?(i=s,s=void 0):(i=s,s=r,r=e,e=void 0))}else{if(c<1)throw new Error("Too few arguments provided");return c===1?(r=e,e=s=void 0):c===2&&!e.getContext&&(s=r,r=e,e=void 0),new Promise(function(u,y){try{let g=Je.create(r,s);u(t(g,e,s))}catch(g){y(g)}})}try{let u=Je.create(r,s);i(null,t(u,e,s))}catch(u){i(u)}}te.create=Je.create;te.toCanvas=Ye.bind(null,dr.render);te.toDataURL=Ye.bind(null,dr.renderToDataURL);te.toString=Ye.bind(null,function(t,e,r){return vn.render(t,r)})});var f=typeof browser<"u"?browser:typeof chrome<"u"?chrome:null;if(!f)throw new Error("browser-polyfill: No extension API namespace found (neither browser nor chrome).");var v=typeof browser>"u"&&typeof chrome<"u";function I(t,e){return(...r)=>{try{let s=e.apply(t,r);if(s&&typeof s.then=="function")return s}catch{}return new Promise((s,i)=>{e.apply(t,[...r,(...a)=>{f.runtime&&f.runtime.lastError?i(new Error(f.runtime.lastError.message)):s(a.length<=1?a[0]:a)}])})}}var w={};w.runtime={sendMessage(...t){return v?I(f.runtime,f.runtime.sendMessage)(...t):f.runtime.sendMessage(...t)},onMessage:f.runtime.onMessage,getURL(t){return f.runtime.getURL(t)},openOptionsPage(){return v?I(f.runtime,f.runtime.openOptionsPage)():f.runtime.openOptionsPage()},get id(){return f.runtime.id}};w.storage={local:{get(...t){return v?I(f.storage.local,f.storage.local.get)(...t):f.storage.local.get(...t)},set(...t){return v?I(f.storage.local,f.storage.local.set)(...t):f.storage.local.set(...t)},clear(...t){return v?I(f.storage.local,f.storage.local.clear)(...t):f.storage.local.clear(...t)},remove(...t){return v?I(f.storage.local,f.storage.local.remove)(...t):f.storage.local.remove(...t)}}};w.tabs={create(...t){return v?I(f.tabs,f.tabs.create)(...t):f.tabs.create(...t)},query(...t){return v?I(f.tabs,f.tabs.query)(...t):f.tabs.query(...t)},remove(...t){return v?I(f.tabs,f.tabs.remove)(...t):f.tabs.remove(...t)},update(...t){return v?I(f.tabs,f.tabs.update)(...t):f.tabs.update(...t)},get(...t){return v?I(f.tabs,f.tabs.get)(...t):f.tabs.get(...t)},getCurrent(...t){return v?I(f.tabs,f.tabs.getCurrent)(...t):f.tabs.getCurrent(...t)}};var rt=5,k=w.storage.local,Pe=[new URL("wss://relay.damus.io"),new URL("wss://relay.primal.net"),new URL("wss://relay.snort.social"),new URL("wss://relay.getalby.com/v1"),new URL("wss://nos.lol"),new URL("wss://brb.io"),new URL("wss://nostr.orangepill.dev")],Sr=[[0,"Metadata","https://github.com/nostr-protocol/nips/blob/master/01.md"],[1,"Text","https://github.com/nostr-protocol/nips/blob/master/01.md"],[2,"Recommend Relay","https://github.com/nostr-protocol/nips/blob/master/01.md"],[3,"Contacts","https://github.com/nostr-protocol/nips/blob/master/02.md"],[4,"Encrypted Direct Messages","https://github.com/nostr-protocol/nips/blob/master/04.md"],[5,"Event Deletion","https://github.com/nostr-protocol/nips/blob/master/09.md"],[6,"Repost","https://github.com/nostr-protocol/nips/blob/master/18.md"],[7,"Reaction","https://github.com/nostr-protocol/nips/blob/master/25.md"],[8,"Badge Award","https://github.com/nostr-protocol/nips/blob/master/58.md"],[16,"Generic Repost","https://github.com/nostr-protocol/nips/blob/master/18.md"],[40,"Channel Creation","https://github.com/nostr-protocol/nips/blob/master/28.md"],[41,"Channel Metadata","https://github.com/nostr-protocol/nips/blob/master/28.md"],[42,"Channel Message","https://github.com/nostr-protocol/nips/blob/master/28.md"],[43,"Channel Hide Message","https://github.com/nostr-protocol/nips/blob/master/28.md"],[44,"Channel Mute User","https://github.com/nostr-protocol/nips/blob/master/28.md"],[1063,"File Metadata","https://github.com/nostr-protocol/nips/blob/master/94.md"],[1311,"Live Chat Message","https://github.com/nostr-protocol/nips/blob/master/53.md"],[1984,"Reporting","https://github.com/nostr-protocol/nips/blob/master/56.md"],[1985,"Label","https://github.com/nostr-protocol/nips/blob/master/32.md"],[4550,"Community Post Approval","https://github.com/nostr-protocol/nips/blob/master/72.md"],[7e3,"Job Feedback","https://github.com/nostr-protocol/nips/blob/master/90.md"],[9041,"Zap Goal","https://github.com/nostr-protocol/nips/blob/master/75.md"],[9734,"Zap Request","https://github.com/nostr-protocol/nips/blob/master/57.md"],[9735,"Zap","https://github.com/nostr-protocol/nips/blob/master/57.md"],[1e4,"Mute List","https://github.com/nostr-protocol/nips/blob/master/51.md"],[10001,"Pin List","https://github.com/nostr-protocol/nips/blob/master/51.md"],[10002,"Relay List Metadata","https://github.com/nostr-protocol/nips/blob/master/65.md"],[13194,"Wallet Info","https://github.com/nostr-protocol/nips/blob/master/47.md"],[22242,"Client Authentication","https://github.com/nostr-protocol/nips/blob/master/42.md"],[23194,"Wallet Request","https://github.com/nostr-protocol/nips/blob/master/47.md"],[23195,"Wallet Response","https://github.com/nostr-protocol/nips/blob/master/47.md"],[24133,"Nostr Connect","https://github.com/nostr-protocol/nips/blob/master/46.md"],[27235,"HTTP Auth","https://github.com/nostr-protocol/nips/blob/master/98.md"],[3e4,"Categorized People List","https://github.com/nostr-protocol/nips/blob/master/51.md"],[30001,"Categorized Bookmark List","https://github.com/nostr-protocol/nips/blob/master/51.md"],[30008,"Profile Badges","https://github.com/nostr-protocol/nips/blob/master/58.md"],[30009,"Badge Definition","https://github.com/nostr-protocol/nips/blob/master/58.md"],[30017,"Create or update a stall","https://github.com/nostr-protocol/nips/blob/master/15.md"],[30018,"Create or update a product","https://github.com/nostr-protocol/nips/blob/master/15.md"],[30023,"Long-Form Content","https://github.com/nostr-protocol/nips/blob/master/23.md"],[30024,"Draft Long-form Content","https://github.com/nostr-protocol/nips/blob/master/23.md"],[30078,"Application-specific Data","https://github.com/nostr-protocol/nips/blob/master/78.md"],[30311,"Live Event","https://github.com/nostr-protocol/nips/blob/master/53.md"],[30315,"User Statuses","https://github.com/nostr-protocol/nips/blob/master/38.md"],[30402,"Classified Listing","https://github.com/nostr-protocol/nips/blob/master/99.md"],[30403,"Draft Classified Listing","https://github.com/nostr-protocol/nips/blob/master/99.md"],[31922,"Date-Based Calendar Event","https://github.com/nostr-protocol/nips/blob/master/52.md"],[31923,"Time-Based Calendar Event","https://github.com/nostr-protocol/nips/blob/master/52.md"],[31924,"Calendar","https://github.com/nostr-protocol/nips/blob/master/52.md"],[31925,"Calendar Event RSVP","https://github.com/nostr-protocol/nips/blob/master/52.md"],[31989,"Handler recommendation","https://github.com/nostr-protocol/nips/blob/master/89.md"],[31990,"Handler information","https://github.com/nostr-protocol/nips/blob/master/89.md"],[34550,"Community Definition","https://github.com/nostr-protocol/nips/blob/master/72.md"]];async function ot(){await nt("profileIndex",0),await nt("profiles",[await it()]);let t=(await k.get({version:0})).version;for(;t<rt;)t=await Nr(t,rt),await k.set({version:t})}async function Nr(t,e){if(t===0){let r=await S();return r.forEach(s=>s.hosts={}),await k.set({profiles:r}),t+1}if(t===1){let r=await S();return await k.set({profiles:r}),t+1}if(t===2){let r=await S();return r.forEach(s=>s.relayReminder=!0),await k.set({profiles:r}),t+1}if(t===3)return(await k.get({isEncrypted:!1})).isEncrypted||await k.set({isEncrypted:!1}),t+1;if(t===4){let r=await S();return r.forEach(s=>{s.type||(s.type="local"),s.bunkerUrl===void 0&&(s.bunkerUrl=null),s.remotePubkey===void 0&&(s.remotePubkey=null)}),await k.set({profiles:r}),t+1}}async function S(){return(await k.get({profiles:[]})).profiles}async function ne(t){return(await S())[t]}async function ke(){return(await S()).map(e=>e.name)}async function oe(){return(await k.get({profileIndex:0})).profileIndex}async function st(){let t=await k.get({ignoreInstallHook:!1});await k.clear(),await k.set(t)}async function Rr(){return await w.runtime.sendMessage({kind:"generatePrivateKey"})}async function it(t="Default Nostr Profile",e="local"){return{name:t,privKey:e==="local"?await Rr():"",hosts:{},relays:Pe.map(r=>({url:r.href,read:!0,write:!0})),relayReminder:!1,type:e,bunkerUrl:null,remotePubkey:null}}async function nt(t,e){let r=(await k.get(t))[t];return r==null||r==null?(await k.set({[t]:e}),e):r}async function at(t,e){let r=await S();r[t].name=e,await k.set({profiles:r})}async function Be(t,e){await w.runtime.sendMessage({kind:"savePrivateKey",payload:[t,e]})}async function ct(t="New Bunker",e=null){let r=await S(),s=await it(t,"bunker");return s.bunkerUrl=e,r.push(s),await k.set({profiles:r}),r.length-1}async function lt(t){return(await ne(t)).relays||[]}async function se(t,e){let r=JSON.parse(JSON.stringify(e)),s=await S(),i=s[t];i.relays=r,await k.set({profiles:s})}async function ut(t=null){return t==null&&(t=await oe()),await(await ne(t)).hosts}async function dt(t,e,r,s=null){let i=await S();s||(s=await oe());let a=i[s],c=a.hosts[t]||{};c={...c,[e]:r},a.hosts[t]=c,i[s]=a,await k.set({profiles:i})}function pt(t){if(t.startsWith("signEvent:")){let[e,r]=t.split(":");return r=parseInt(r),`Sign event: ${Sr.find(i=>i[0]===r)?.[1]||`Unknown (Kind ${r})`}`}switch(t){case"getPubKey":return"Read public key";case"signEvent":return"Sign event";case"getRelays":return"Read relay list";case"nip04.encrypt":return"Encrypt private message (NIP-04)";case"nip04.decrypt":return"Decrypt private message (NIP-04)";case"nip44.encrypt":return"Encrypt private message (NIP-44)";case"nip44.decrypt":return"Decrypt private message (NIP-44)";default:return"Unknown"}}function ve(t){let e=/^[\da-f]{64}$/i.test(t),r=/^nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58}$/.test(t);return e||r||Ie(t)}function Ie(t){return/^ncryptsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]+$/.test(t)}var Ze=Cr(pr()),o={profileNames:["---"],profileIndex:0,profileName:"",pristineProfileName:"",privKey:"",pristinePrivKey:"",pubKey:"",relays:[],newRelay:"",urlError:"",recommendedRelay:"",permissions:{},host:"",permHosts:[],hostPerms:[],visible:!1,copied:!1,npubQrDataUrl:"",nsecQrDataUrl:"",showNsecQr:!1,ncryptsecPassword:"",ncryptsecError:"",ncryptsecLoading:!1,ncryptsecExportPassword:"",ncryptsecExportConfirm:"",ncryptsecExportResult:"",ncryptsecExportError:"",ncryptsecExportLoading:!1,ncryptsecExportCopied:!1,profileType:"local",bunkerUrl:"",bunkerConnected:!1,bunkerError:"",bunkerConnecting:!1,bunkerPubkey:"",protocolHandler:"",hasPassword:!1,currentPassword:"",newPassword:"",confirmPassword:"",removePasswordInput:"",securityError:"",securitySuccess:"",removeError:""},n={};function p(t){return document.getElementById(t)}function In(){n.profileSelect=p("profiles"),n.settingsContainer=p("settings-container"),n.newBunkerBtn=document.querySelector('[data-action="newBunkerProfile"]'),n.keysSection=document.querySelector('[data-section="keys"]'),n.profileNameInput=p("profile-name"),n.privKeyInput=p("priv-key"),n.pubKeyInput=p("pub-key"),n.visibilityToggle=document.querySelector('[data-action="toggleVisibility"]'),n.copyPubKeyBtn=document.querySelector('[data-action="copyPubKey"]'),n.saveProfileBtn=document.querySelector('[data-action="saveProfile"]'),n.ncryptsecSection=document.querySelector('[data-section="ncryptsec-import"]'),n.ncryptsecPasswordInput=p("ncryptsec-password"),n.ncryptsecError=p("ncryptsec-error"),n.decryptBtn=document.querySelector('[data-action="decryptNcryptsec"]'),n.npubQrContainer=p("npub-qr-container"),n.npubQrImage=p("npub-qr-image"),n.showNsecQrBtn=document.querySelector('[data-action="showNsecQr"]'),n.nsecQrSection=p("nsec-qr-section"),n.nsecQrImage=p("nsec-qr-image"),n.hideNsecQrBtn=document.querySelector('[data-action="hideNsecQr"]'),n.ncryptsecExportPassword=p("ncryptsec-export-password"),n.ncryptsecExportConfirm=p("ncryptsec-export-confirm"),n.ncryptsecExportError=p("ncryptsec-export-error"),n.exportNcryptsecBtn=document.querySelector('[data-action="exportNcryptsec"]'),n.ncryptsecExportResult=p("ncryptsec-export-result"),n.copyNcryptsecBtn=document.querySelector('[data-action="copyNcryptsecExport"]'),n.bunkerSection=document.querySelector('[data-section="bunker"]'),n.bunkerProfileNameInput=p("bunker-profile-name"),n.saveBunkerNameBtn=document.querySelector('[data-action="saveBunkerName"]'),n.bunkerUrlInput=p("bunker-url"),n.connectBunkerBtn=document.querySelector('[data-action="connectBunker"]'),n.disconnectBunkerBtn=document.querySelector('[data-action="disconnectBunker"]'),n.pingBunkerBtn=document.querySelector('[data-action="pingBunker"]'),n.bunkerStatus=p("bunker-status-indicator"),n.bunkerStatusText=p("bunker-status-text"),n.bunkerError=p("bunker-error"),n.bunkerPubKeyInput=p("bunker-pubkey"),n.copyBunkerPubKeyBtn=document.querySelector('[data-action="copyBunkerPubKey"]'),n.relaysTable=p("relays-table"),n.relaysEmpty=p("relays-empty"),n.recommendedRelaySelect=p("recommended-relay"),n.newRelayInput=p("new-relay"),n.addRelayBtn=document.querySelector('[data-action="addRelay"]'),n.relayError=p("relay-error"),n.appSelect=p("app-select"),n.permissionsTable=p("permissions-table"),n.permissionsEmpty=p("permissions-empty"),n.securityStatus=p("security-status"),n.setPasswordSection=p("set-password-section"),n.changePasswordSection=p("change-password-section"),n.newPasswordInput=p("new-password"),n.confirmPasswordInput=p("confirm-password"),n.passwordStrength=p("password-strength"),n.securityError=p("security-error"),n.securitySuccess=p("security-success"),n.setPasswordBtn=document.querySelector('[data-action="setPassword"]'),n.currentPasswordInput=p("current-password"),n.newPasswordChangeInput=p("new-password-change"),n.confirmPasswordChangeInput=p("confirm-password-change"),n.changePasswordBtn=document.querySelector('[data-action="changePassword"]'),n.removePasswordInput=p("remove-password"),n.removeError=p("remove-error"),n.removePasswordBtn=document.querySelector('[data-action="removePassword"]'),n.protocolHandlerInput=p("protocol-handler"),n.useNjumpBtn=document.querySelector('[data-action="useNjump"]'),n.disableHandlerBtn=document.querySelector('[data-action="disableHandler"]'),n.closeBtn=p("close-btn"),n.clearDataBtn=document.querySelector('[data-action="clearData"]')}function d(){xn(),Cn(),o.profileType==="local"?Sn():Nn(),Ln(),Tn(),Mn(),An(),Rn()}function xn(){if(!n.profileSelect)return;let t=o.profileIndex!==null&&o.profileIndex>=0;n.profileSelect.innerHTML='<option value="" disabled'+(t?"":" selected")+">Select a profile...</option>"+o.profileNames.map((e,r)=>`<option value="${r}"${r===o.profileIndex&&t?" selected":""}>${e}</option>`).join(""),n.settingsContainer&&(n.settingsContainer.style.display=t?"block":"none")}function Cn(){let t=o.profileType==="local";n.keysSection&&(n.keysSection.style.display=t?"block":"none"),n.bunkerSection&&(n.bunkerSection.style.display=t?"none":"block")}function Sn(){if(n.profileNameInput&&(n.profileNameInput.value=o.profileName),n.privKeyInput){n.privKeyInput.value=o.privKey,n.privKeyInput.type=o.visible?"text":"password";let e=ve(o.privKey);o.privKey&&!e?n.privKeyInput.classList.add("ring-2","ring-rose-500"):n.privKeyInput.classList.remove("ring-2","ring-rose-500")}n.pubKeyInput&&(n.pubKeyInput.value=o.pubKey),n.visibilityToggle&&(n.visibilityToggle.textContent=o.visible?"Hide":"Show");let t=Ie(o.privKey);if(n.ncryptsecSection&&(n.ncryptsecSection.style.display=t?"block":"none"),n.saveProfileBtn){n.saveProfileBtn.style.display=t?"none":"block";let e=o.privKey!==o.pristinePrivKey||o.profileName!==o.pristineProfileName;n.saveProfileBtn.disabled=!e||!ve(o.privKey)}if(n.npubQrContainer&&o.npubQrDataUrl?(n.npubQrContainer.style.display="flex",n.npubQrImage&&(n.npubQrImage.src=o.npubQrDataUrl)):n.npubQrContainer&&(n.npubQrContainer.style.display="none"),n.showNsecQrBtn&&(n.showNsecQrBtn.style.display=o.visible&&o.privKey&&!t?"block":"none"),n.nsecQrSection&&(n.nsecQrSection.style.display=o.showNsecQr&&o.nsecQrDataUrl?"block":"none",n.nsecQrImage&&o.nsecQrDataUrl&&(n.nsecQrImage.src=o.nsecQrDataUrl)),n.exportNcryptsecBtn){let e=o.ncryptsecExportPassword.length>=8&&o.ncryptsecExportPassword===o.ncryptsecExportConfirm;n.exportNcryptsecBtn.disabled=!e||o.ncryptsecExportLoading,n.exportNcryptsecBtn.textContent=o.ncryptsecExportLoading?"Encrypting...":"Export ncryptsec"}n.ncryptsecExportResult&&(n.ncryptsecExportResult.value=o.ncryptsecExportResult,n.ncryptsecExportResult.parentElement.style.display=o.ncryptsecExportResult?"block":"none"),n.copyNcryptsecBtn&&(n.copyNcryptsecBtn.textContent=o.ncryptsecExportCopied?"Copied!":"Copy")}function Nn(){if(n.bunkerProfileNameInput&&(n.bunkerProfileNameInput.value=o.profileName),n.bunkerUrlInput&&(n.bunkerUrlInput.value=o.bunkerUrl,n.bunkerUrlInput.disabled=o.bunkerConnected),n.connectBunkerBtn&&(n.connectBunkerBtn.style.display=o.bunkerConnected?"none":"inline-block",n.connectBunkerBtn.disabled=o.bunkerConnecting||!o.bunkerUrl,n.connectBunkerBtn.textContent=o.bunkerConnecting?"Connecting...":"Connect"),n.disconnectBunkerBtn&&(n.disconnectBunkerBtn.style.display=o.bunkerConnected?"inline-block":"none"),n.pingBunkerBtn&&(n.pingBunkerBtn.style.display=o.bunkerConnected?"inline-block":"none"),n.bunkerStatus&&(n.bunkerStatus.className=`inline-block w-3 h-3 rounded-full ${o.bunkerConnected?"bg-green-500":"bg-red-500"}`),n.bunkerStatusText&&(n.bunkerStatusText.textContent=o.bunkerConnected?"Connected":"Disconnected"),n.bunkerError&&(n.bunkerError.textContent=o.bunkerError,n.bunkerError.style.display=o.bunkerError?"block":"none"),n.bunkerPubKeyInput&&(n.bunkerPubKeyInput.value=o.pubKey,n.bunkerPubKeyInput.parentElement.style.display=o.bunkerPubkey?"block":"none"),n.saveBunkerNameBtn){let t=o.profileName!==o.pristineProfileName;n.saveBunkerNameBtn.disabled=!t}}function Rn(){n.newRelayInput&&(n.newRelayInput.value=o.newRelay),n.ncryptsecPasswordInput&&(n.ncryptsecPasswordInput.value=o.ncryptsecPassword),n.ncryptsecExportPassword&&(n.ncryptsecExportPassword.value=o.ncryptsecExportPassword),n.ncryptsecExportConfirm&&(n.ncryptsecExportConfirm.value=o.ncryptsecExportConfirm),n.newPasswordInput&&(n.newPasswordInput.value=o.newPassword),n.confirmPasswordInput&&(n.confirmPasswordInput.value=o.confirmPassword),n.currentPasswordInput&&(n.currentPasswordInput.value=o.currentPassword),n.newPasswordChangeInput&&(n.newPasswordChangeInput.value=o.newPassword),n.confirmPasswordChangeInput&&(n.confirmPasswordChangeInput.value=o.confirmPassword),n.removePasswordInput&&(n.removePasswordInput.value=o.removePasswordInput)}function Ln(){if(n.relaysTable){if(o.relays.length>0){n.relaysTable.style.display="table",n.relaysEmpty&&(n.relaysEmpty.style.display="none");let t=n.relaysTable.querySelector("tbody");t&&(t.innerHTML=o.relays.map((e,r)=>`
                <tr>
                    <td class="p-2 w-1/3">${e.url}</td>
                    <td class="p-2 text-center">
                        <input class="checkbox" type="checkbox" ${e.read?"checked":""} data-relay-index="${r}" data-relay-prop="read">
                    </td>
                    <td class="p-2 text-center">
                        <input class="checkbox" type="checkbox" ${e.write?"checked":""} data-relay-index="${r}" data-relay-prop="write">
                    </td>
                    <td class="p-2 text-center">
                        <button class="button" data-action="deleteRelay" data-relay-index="${r}">Delete</button>
                    </td>
                </tr>
            `).join(""),t.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.addEventListener("change",Xn)}),t.querySelectorAll('[data-action="deleteRelay"]').forEach(e=>{e.addEventListener("click",eo)}))}else n.relaysTable.style.display="none",n.relaysEmpty&&(n.relaysEmpty.style.display="block");if(n.recommendedRelaySelect){let t=Un();n.recommendedRelaySelect.parentElement.style.display=t.length>0?"block":"none",n.recommendedRelaySelect.innerHTML='<option value="" disabled selected>Recommended Relays</option>'+t.map(e=>`<option value="${e}">${e}</option>`).join("")}n.relayError&&(n.relayError.textContent=o.urlError,n.relayError.style.display=o.urlError?"block":"none")}}function Tn(){if(n.appSelect)if(o.permHosts.length>0?(n.appSelect.parentElement.style.display="block",n.appSelect.innerHTML='<option value=""></option>'+o.permHosts.map(t=>`<option value="${t}"${t===o.host?" selected":""}>${t}</option>`).join("")):n.appSelect.parentElement.style.display="none",n.permissionsTable&&o.hostPerms.length>0){n.permissionsTable.style.display="table",n.permissionsEmpty&&(n.permissionsEmpty.style.display="none");let t=n.permissionsTable.querySelector("tbody");t&&(t.innerHTML=o.hostPerms.map(([e,r,s])=>`
                <tr>
                    <td class="p-2 w-1/3 md:w-2/4">${r}</td>
                    <td class="p-2 text-center">
                        <select class="input" data-perm-type="${e}" data-perm-value="${s}">
                            <option value="ask"${s==="ask"?" selected":""}>Ask</option>
                            <option value="allow"${s==="allow"?" selected":""}>Allow</option>
                            <option value="deny"${s==="deny"?" selected":""}>Deny</option>
                        </select>
                    </td>
                </tr>
            `).join(""),t.querySelectorAll("select").forEach(e=>{e.addEventListener("change",to)}))}else n.permissionsTable&&(n.permissionsTable.style.display="none"),n.permissionsEmpty&&(n.permissionsEmpty.style.display=o.permHosts.length===0?"block":"none")}function Mn(){if(n.securityStatus&&(n.securityStatus.textContent=o.hasPassword?"Master password is active \u2014 keys are encrypted at rest.":"No master password set \u2014 keys are stored unencrypted."),n.setPasswordSection&&(n.setPasswordSection.style.display=o.hasPassword?"none":"block"),n.changePasswordSection&&(n.changePasswordSection.style.display=o.hasPassword?"block":"none"),n.passwordStrength&&o.newPassword){let t=Kn(o.newPassword),e=["","Too short","Weak","Fair","Strong","Very strong"],r=["","text-red-500","text-orange-500","text-yellow-600","text-green-600","text-green-700 font-bold"];n.passwordStrength.textContent=e[t]||"",n.passwordStrength.className=`text-xs mt-1 ${r[t]||""}`,n.passwordStrength.style.display=o.newPassword?"block":"none"}else n.passwordStrength&&(n.passwordStrength.style.display="none");if(n.setPasswordBtn){let t=o.newPassword.length>=8&&o.newPassword===o.confirmPassword;n.setPasswordBtn.disabled=!t}if(n.changePasswordBtn){let t=o.currentPassword.length>0&&o.newPassword.length>=8&&o.newPassword===o.confirmPassword;n.changePasswordBtn.disabled=!t}n.removePasswordBtn&&(n.removePasswordBtn.disabled=!o.removePasswordInput),n.securityError&&(n.securityError.textContent=o.securityError,n.securityError.style.display=o.securityError?"block":"none"),n.securitySuccess&&(n.securitySuccess.textContent=o.securitySuccess,n.securitySuccess.style.display=o.securitySuccess?"block":"none"),n.removeError&&(n.removeError.textContent=o.removeError,n.removeError.style.display=o.removeError?"block":"none")}function An(){n.protocolHandlerInput&&(n.protocolHandlerInput.value=o.protocolHandler)}function Un(){let t=o.relays.map(e=>new URL(e.url).href);return Pe.filter(e=>!t.includes(e.href)).map(e=>e.href)}function Kn(t){if(t.length===0)return 0;if(t.length<8)return 1;let e=2;return t.length>=12&&e++,/[A-Z]/.test(t)&&/[a-z]/.test(t)&&e++,/\d/.test(t)&&e++,/[^A-Za-z0-9]/.test(t)&&e++,Math.min(e,5)}async function mr(){o.profileNames=await ke(),o.profileIndex=await oe();let e=new URLSearchParams(window.location.search).get("index");e&&(o.profileIndex=parseInt(e)),await re()}async function re(){o.profileNames=await ke(),o.profileName=o.profileNames[o.profileIndex],o.pristineProfileName=o.profileName,o.profileType=await w.runtime.sendMessage({kind:"getProfileType",payload:o.profileIndex}),o.npubQrDataUrl="",o.nsecQrDataUrl="",o.showNsecQr=!1,o.ncryptsecExportResult="",o.ncryptsecExportError="",o.ncryptsecExportPassword="",o.ncryptsecExportConfirm="",o.profileType==="local"?await Dn():await qn(),await me(),await wr(),d()}async function Dn(){o.privKey=await w.runtime.sendMessage({kind:"getNsec",payload:o.profileIndex}),o.pristinePrivKey=o.privKey,o.pubKey=await w.runtime.sendMessage({kind:"getNpub",payload:o.profileIndex}),await Hn()}async function qn(){let t=await ne(o.profileIndex);o.bunkerUrl=t?.bunkerUrl||"",o.bunkerPubkey=t?.remotePubkey||"",o.bunkerError="",o.bunkerPubkey?o.pubKey=await w.runtime.sendMessage({kind:"npubEncode",payload:o.bunkerPubkey}):o.pubKey="";let e=await w.runtime.sendMessage({kind:"bunker.status",payload:o.profileIndex});o.bunkerConnected=e?.connected||!1}async function me(){o.relays=await lt(o.profileIndex)}async function wr(){o.permissions=await ut(o.profileIndex),o.permHosts=Object.keys(o.permissions).sort(),br()}function br(){let t=o.permissions[o.host]||{},e=Object.keys(t).sort();o.hostPerms=e.map(r=>[r,pt(r),t[r]])}async function Hn(){try{if(!o.pubKey){o.npubQrDataUrl="";return}o.npubQrDataUrl=await Ze.default.toDataURL(o.pubKey.toUpperCase(),{width:200,margin:2,color:{dark:"#701a75",light:"#fdf4ff"}})}catch{o.npubQrDataUrl=""}}async function _n(){try{if(!o.visible||!o.privKey){o.nsecQrDataUrl="";return}let t=await w.runtime.sendMessage({kind:"getNsec",payload:o.profileIndex});if(!t){o.nsecQrDataUrl="";return}o.nsecQrDataUrl=await Ze.default.toDataURL(t.toUpperCase(),{width:200,margin:2,color:{dark:"#991b1b",light:"#fef2f2"}})}catch{o.nsecQrDataUrl=""}}async function Fn(){let t=n.profileSelect.value;if(!t&&t!=="0")return;let e=parseInt(t);isNaN(e)||e!==o.profileIndex&&(o.profileIndex=e,o.host="",await re())}async function Qn(){let t=await ct();o.profileIndex=t,await re()}function fr(t){o.profileName=t.target.value,d()}function zn(t){o.privKey=t.target.value,d()}function On(){o.visible=!o.visible,d()}async function yr(){await navigator.clipboard.writeText(o.pubKey),o.copied=!0,d(),setTimeout(()=>{o.copied=!1,d()},1500)}async function gr(){o.profileType==="local"&&await Be(o.profileIndex,o.privKey),await at(o.profileIndex,o.profileName),await re()}async function Vn(){await _n(),o.showNsecQr=!0,d()}function $n(){o.showNsecQr=!1,o.nsecQrDataUrl="",d()}async function Jn(){o.ncryptsecError="",o.ncryptsecLoading=!0,d();try{let t=await w.runtime.sendMessage({kind:"ncryptsec.decrypt",payload:{ncryptsec:o.privKey,password:o.ncryptsecPassword}});t.success?(await Be(o.profileIndex,t.hexKey),o.ncryptsecPassword="",await re()):o.ncryptsecError=t.error||"Decryption failed. Wrong password?"}catch(t){o.ncryptsecError=t.message||"Decryption failed"}o.ncryptsecLoading=!1,d()}async function Yn(){o.ncryptsecExportError="",o.ncryptsecExportResult="",o.ncryptsecExportLoading=!0,d();try{let t=await w.runtime.sendMessage({kind:"ncryptsec.encrypt",payload:{profileIndex:o.profileIndex,password:o.ncryptsecExportPassword}});t.success?(o.ncryptsecExportResult=t.ncryptsec,o.ncryptsecExportPassword="",o.ncryptsecExportConfirm=""):o.ncryptsecExportError=t.error||"Encryption failed"}catch(t){o.ncryptsecExportError=t.message||"Encryption failed"}o.ncryptsecExportLoading=!1,d()}async function jn(){await navigator.clipboard.writeText(o.ncryptsecExportResult),o.ncryptsecExportCopied=!0,d(),setTimeout(()=>{o.ncryptsecExportCopied=!1,d()},1500)}async function Gn(){o.bunkerError="",o.bunkerConnecting=!0,d();try{let t=await w.runtime.sendMessage({kind:"bunker.validateUrl",payload:o.bunkerUrl});if(!t.valid){o.bunkerError=t.error,o.bunkerConnecting=!1,d();return}let e=await w.runtime.sendMessage({kind:"bunker.connect",payload:{profileIndex:o.profileIndex,bunkerUrl:o.bunkerUrl}});e.success?(o.bunkerConnected=!0,o.bunkerPubkey=e.remotePubkey,o.pubKey=await w.runtime.sendMessage({kind:"npubEncode",payload:e.remotePubkey})):o.bunkerError=e.error||"Failed to connect"}catch(t){o.bunkerError=t.message||"Connection failed"}o.bunkerConnecting=!1,d()}async function Wn(){o.bunkerError="";let t=await w.runtime.sendMessage({kind:"bunker.disconnect",payload:o.profileIndex});t.success?o.bunkerConnected=!1:o.bunkerError=t.error||"Failed to disconnect",d()}async function Zn(){o.bunkerError="";let t=await w.runtime.sendMessage({kind:"bunker.ping",payload:o.profileIndex});t.success||(o.bunkerError=t.error||"Ping failed",o.bunkerConnected=!1),d()}async function Xn(t){let e=parseInt(t.target.dataset.relayIndex),r=t.target.dataset.relayProp;o.relays[e][r]=t.target.checked,await se(o.profileIndex,o.relays),await me(),d()}async function eo(t){let e=parseInt(t.target.dataset.relayIndex);o.relays.splice(e,1),await se(o.profileIndex,o.relays),await me(),d()}async function je(){let t=o.recommendedRelay||o.newRelay;try{let e=new URL(t);if(e.protocol!=="wss:"){Ge("Must be a websocket url");return}if(o.relays.map(s=>s.url).includes(e.href)){Ge("URL already exists");return}o.relays.push({url:e.href,read:!0,write:!0}),await se(o.profileIndex,o.relays),o.newRelay="",o.recommendedRelay="",await me(),d()}catch{Ge("Invalid websocket URL")}}function Ge(t){o.urlError=t,d(),setTimeout(()=>{o.urlError="",d()},3e3)}async function to(t){let e=t.target.dataset.permType,r=t.target.value;await dt(o.host,e,r,o.profileIndex),await wr(),d()}async function ro(){if(o.securityError="",o.securitySuccess="",o.newPassword.length<8){o.securityError="Password must be at least 8 characters.",d();return}if(o.newPassword!==o.confirmPassword){o.securityError="Passwords do not match.",d();return}let t=await w.runtime.sendMessage({kind:"setPassword",payload:o.newPassword});t.success?(o.hasPassword=!0,o.newPassword="",o.confirmPassword="",o.securitySuccess="Master password set. Your keys are now encrypted at rest.",d(),setTimeout(()=>{o.securitySuccess="",d()},5e3)):(o.securityError=t.error||"Failed to set password.",d())}async function no(){if(o.securityError="",o.securitySuccess="",!o.currentPassword){o.securityError="Please enter your current password.",d();return}if(o.newPassword.length<8){o.securityError="New password must be at least 8 characters.",d();return}if(o.newPassword!==o.confirmPassword){o.securityError="New passwords do not match.",d();return}let t=await w.runtime.sendMessage({kind:"changePassword",payload:{oldPassword:o.currentPassword,newPassword:o.newPassword}});t.success?(o.currentPassword="",o.newPassword="",o.confirmPassword="",o.securitySuccess="Master password changed successfully.",d(),setTimeout(()=>{o.securitySuccess="",d()},5e3)):(o.securityError=t.error||"Failed to change password.",d())}async function oo(){if(o.removeError="",!o.removePasswordInput){o.removeError="Please enter your current password.",d();return}if(!confirm("This will remove encryption from your private keys. They will be stored as plaintext. Are you sure?"))return;let t=await w.runtime.sendMessage({kind:"removePassword",payload:o.removePasswordInput});t.success?(o.hasPassword=!1,o.removePasswordInput="",o.securitySuccess="Master password removed. Keys are now stored unencrypted.",d(),setTimeout(()=>{o.securitySuccess="",d()},5e3)):(o.removeError=t.error||"Failed to remove password.",d())}async function We(){o.protocolHandler?await w.storage.local.set({protocol_handler:o.protocolHandler}):await w.storage.local.remove("protocol_handler")}async function so(){confirm("This will remove your private keys and all associated data. Are you sure you wish to continue?")&&(await st(),await mr())}function hr(){window.close()}function io(){n.profileSelect&&n.profileSelect.addEventListener("change",Fn),n.newBunkerBtn&&n.newBunkerBtn.addEventListener("click",Qn),n.profileNameInput&&n.profileNameInput.addEventListener("input",fr),n.privKeyInput&&n.privKeyInput.addEventListener("input",zn),n.visibilityToggle&&n.visibilityToggle.addEventListener("click",On),n.copyPubKeyBtn&&n.copyPubKeyBtn.addEventListener("click",yr),n.saveProfileBtn&&n.saveProfileBtn.addEventListener("click",gr),n.decryptBtn&&n.decryptBtn.addEventListener("click",Jn),n.showNsecQrBtn&&n.showNsecQrBtn.addEventListener("click",Vn),n.hideNsecQrBtn&&n.hideNsecQrBtn.addEventListener("click",$n),n.exportNcryptsecBtn&&n.exportNcryptsecBtn.addEventListener("click",Yn),n.copyNcryptsecBtn&&n.copyNcryptsecBtn.addEventListener("click",jn),n.ncryptsecExportPassword&&n.ncryptsecExportPassword.addEventListener("input",e=>{o.ncryptsecExportPassword=e.target.value,d()}),n.ncryptsecExportConfirm&&n.ncryptsecExportConfirm.addEventListener("input",e=>{o.ncryptsecExportConfirm=e.target.value,d()}),n.bunkerProfileNameInput&&n.bunkerProfileNameInput.addEventListener("input",fr),n.saveBunkerNameBtn&&n.saveBunkerNameBtn.addEventListener("click",gr),n.bunkerUrlInput&&n.bunkerUrlInput.addEventListener("input",e=>{o.bunkerUrl=e.target.value,d()}),n.connectBunkerBtn&&n.connectBunkerBtn.addEventListener("click",Gn),n.disconnectBunkerBtn&&n.disconnectBunkerBtn.addEventListener("click",Wn),n.pingBunkerBtn&&n.pingBunkerBtn.addEventListener("click",Zn),n.copyBunkerPubKeyBtn&&n.copyBunkerPubKeyBtn.addEventListener("click",yr),n.ncryptsecPasswordInput&&n.ncryptsecPasswordInput.addEventListener("input",e=>{o.ncryptsecPassword=e.target.value,d()}),n.newRelayInput&&(n.newRelayInput.addEventListener("input",e=>{o.newRelay=e.target.value}),n.newRelayInput.addEventListener("keyup",e=>{e.key==="Enter"&&je()})),n.recommendedRelaySelect&&n.recommendedRelaySelect.addEventListener("change",e=>{o.recommendedRelay=e.target.value,je()}),n.addRelayBtn&&n.addRelayBtn.addEventListener("click",je),n.appSelect&&n.appSelect.addEventListener("change",e=>{o.host=e.target.value,br(),d()}),n.newPasswordInput&&n.newPasswordInput.addEventListener("input",e=>{o.newPassword=e.target.value,d()}),n.confirmPasswordInput&&n.confirmPasswordInput.addEventListener("input",e=>{o.confirmPassword=e.target.value,d()}),n.setPasswordBtn&&n.setPasswordBtn.addEventListener("click",ro),n.currentPasswordInput&&n.currentPasswordInput.addEventListener("input",e=>{o.currentPassword=e.target.value,d()}),n.newPasswordChangeInput&&n.newPasswordChangeInput.addEventListener("input",e=>{o.newPassword=e.target.value,d()}),n.confirmPasswordChangeInput&&n.confirmPasswordChangeInput.addEventListener("input",e=>{o.confirmPassword=e.target.value,d()}),n.changePasswordBtn&&n.changePasswordBtn.addEventListener("click",no),n.removePasswordInput&&n.removePasswordInput.addEventListener("input",e=>{o.removePasswordInput=e.target.value,d()}),n.removePasswordBtn&&n.removePasswordBtn.addEventListener("click",oo),n.protocolHandlerInput&&(n.protocolHandlerInput.addEventListener("input",e=>{o.protocolHandler=e.target.value}),n.protocolHandlerInput.addEventListener("change",We)),n.useNjumpBtn&&n.useNjumpBtn.addEventListener("click",()=>{o.protocolHandler="https://njump.me/{raw}",We(),d()}),n.disableHandlerBtn&&n.disableHandlerBtn.addEventListener("click",()=>{o.protocolHandler="",We(),d()}),n.closeBtn&&n.closeBtn.addEventListener("click",hr);let t=document.querySelector('[data-action="closeOptions"]');t&&t.addEventListener("click",hr),n.clearDataBtn&&n.clearDataBtn.addEventListener("click",so),document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",r=>r.preventDefault())}),document.querySelectorAll("a[data-action]").forEach(e=>{e.addEventListener("click",r=>r.preventDefault())})}async function ao(){await ot(),o.hasPassword=await w.runtime.sendMessage({kind:"isEncrypted"});let{protocol_handler:t}=await w.storage.local.get(["protocol_handler"]);o.protocolHandler=t||"",In(),io(),await mr()}document.addEventListener("DOMContentLoaded",ao);})();
