(()=>{window.nostr={requests:{},async getPublicKey(){return await this.broadcast("getPubKey")},async signEvent(t){return await this.broadcast("signEvent",t)},async getRelays(){return await this.broadcast("getRelays")},async enable(){return{enabled:!0}},broadcast(t,e){let r=crypto.randomUUID();return new Promise((n,s)=>{let a=setTimeout(()=>{delete this.requests[r],s(new Error("NostrKey: request timed out"))},3e4);this.requests[r]=o=>{clearTimeout(a),n(o)},window.postMessage({kind:t,reqId:r,payload:e},"*")})},nip04:{async encrypt(t,e){return await window.nostr.broadcast("nip04.encrypt",{pubKey:t,plainText:e})},async decrypt(t,e){return await window.nostr.broadcast("nip04.decrypt",{pubKey:t,cipherText:e})}},nip44:{async encrypt(t,e){return await window.nostr.broadcast("nip44.encrypt",{pubKey:t,plainText:e})},async decrypt(t,e){return await window.nostr.broadcast("nip44.decrypt",{pubKey:t,cipherText:e})}}};var i=null;document.addEventListener("mousedown",async t=>{if(t.target.tagName!=="A"||!t.target.href.startsWith("nostr:")||i===!1)return;let e=await window.nostr.broadcast("replaceURL",{url:t.target.href});if(e===!1){i=!1;return}t.target.href=e});window.addEventListener("message",t=>{let e=["getPubKey","signEvent","getRelays","nip04.encrypt","nip04.decrypt","nip44.encrypt","nip44.decrypt"].map(a=>`return_${a}`),{kind:r,reqId:n,payload:s}=t.data;e.includes(r)&&(window.nostr.requests[n]?.(s),delete window.nostr.requests[n])});})();
