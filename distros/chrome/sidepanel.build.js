(()=>{var Bn=Object.create;var ot=Object.defineProperty;var Cn=Object.getOwnPropertyDescriptor;var xn=Object.getOwnPropertyNames;var Ln=Object.getPrototypeOf,Nn=Object.prototype.hasOwnProperty;var y=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var In=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of xn(e))!Nn.call(t,i)&&i!==n&&ot(t,i,{get:()=>e[i],enumerable:!(o=Cn(e,i))||o.enumerable});return t};var Sn=(t,e,n)=>(n=t!=null?Bn(Ln(t)):{},In(e||!t||!t.__esModule?ot(n,"default",{value:t,enumerable:!0}):n,t));var gt=y((mo,pt)=>{pt.exports=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}});var M=y(K=>{var Te,Mn=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];K.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};K.getSymbolTotalCodewords=function(e){return Mn[e]};K.getBCHDigit=function(t){let e=0;for(;t!==0;)e++,t>>>=1;return e};K.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');Te=e};K.isKanjiModeEnabled=function(){return typeof Te<"u"};K.toSJIS=function(e){return Te(e)}});var de=y(C=>{C.L={bit:1};C.M={bit:0};C.Q={bit:3};C.H={bit:2};function Un(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return C.L;case"m":case"medium":return C.M;case"q":case"quartile":return C.Q;case"h":case"high":return C.H;default:throw new Error("Unknown EC Level: "+t)}}C.isValid=function(e){return e&&typeof e.bit<"u"&&e.bit>=0&&e.bit<4};C.from=function(e,n){if(C.isValid(e))return e;try{return Un(e)}catch{return n}}});var mt=y((ko,yt)=>{function ht(){this.buffer=[],this.length=0}ht.prototype={get:function(t){let e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)===1},put:function(t,e){for(let n=0;n<e;n++)this.putBit((t>>>e-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){let e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};yt.exports=ht});var bt=y((Eo,wt)=>{function X(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}X.prototype.set=function(t,e,n,o){let i=t*this.size+e;this.data[i]=n,o&&(this.reservedBit[i]=!0)};X.prototype.get=function(t,e){return this.data[t*this.size+e]};X.prototype.xor=function(t,e,n){this.data[t*this.size+e]^=n};X.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]};wt.exports=X});var kt=y(fe=>{var Dn=M().getSymbolSize;fe.getRowColCoords=function(e){if(e===1)return[];let n=Math.floor(e/7)+2,o=Dn(e),i=o===145?26:Math.ceil((o-13)/(2*n-2))*2,s=[o-7];for(let a=1;a<n-1;a++)s[a]=s[a-1]-i;return s.push(6),s.reverse()};fe.getPositions=function(e){let n=[],o=fe.getRowColCoords(e),i=o.length;for(let s=0;s<i;s++)for(let a=0;a<i;a++)s===0&&a===0||s===0&&a===i-1||s===i-1&&a===0||n.push([o[s],o[a]]);return n}});var vt=y(Pt=>{var Vn=M().getSymbolSize,Et=7;Pt.getPositions=function(e){let n=Vn(e);return[[0,0],[n-Et,0],[0,n-Et]]}});var Bt=y(w=>{w.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var q={N1:3,N2:3,N3:40,N4:10};w.isValid=function(e){return e!=null&&e!==""&&!isNaN(e)&&e>=0&&e<=7};w.from=function(e){return w.isValid(e)?parseInt(e,10):void 0};w.getPenaltyN1=function(e){let n=e.size,o=0,i=0,s=0,a=null,c=null;for(let u=0;u<n;u++){i=s=0,a=c=null;for(let p=0;p<n;p++){let g=e.get(u,p);g===a?i++:(i>=5&&(o+=q.N1+(i-5)),a=g,i=1),g=e.get(p,u),g===c?s++:(s>=5&&(o+=q.N1+(s-5)),c=g,s=1)}i>=5&&(o+=q.N1+(i-5)),s>=5&&(o+=q.N1+(s-5))}return o};w.getPenaltyN2=function(e){let n=e.size,o=0;for(let i=0;i<n-1;i++)for(let s=0;s<n-1;s++){let a=e.get(i,s)+e.get(i,s+1)+e.get(i+1,s)+e.get(i+1,s+1);(a===4||a===0)&&o++}return o*q.N2};w.getPenaltyN3=function(e){let n=e.size,o=0,i=0,s=0;for(let a=0;a<n;a++){i=s=0;for(let c=0;c<n;c++)i=i<<1&2047|e.get(a,c),c>=10&&(i===1488||i===93)&&o++,s=s<<1&2047|e.get(c,a),c>=10&&(s===1488||s===93)&&o++}return o*q.N3};w.getPenaltyN4=function(e){let n=0,o=e.data.length;for(let s=0;s<o;s++)n+=e.data[s];return Math.abs(Math.ceil(n*100/o/5)-10)*q.N4};function Kn(t,e,n){switch(t){case w.Patterns.PATTERN000:return(e+n)%2===0;case w.Patterns.PATTERN001:return e%2===0;case w.Patterns.PATTERN010:return n%3===0;case w.Patterns.PATTERN011:return(e+n)%3===0;case w.Patterns.PATTERN100:return(Math.floor(e/2)+Math.floor(n/3))%2===0;case w.Patterns.PATTERN101:return e*n%2+e*n%3===0;case w.Patterns.PATTERN110:return(e*n%2+e*n%3)%2===0;case w.Patterns.PATTERN111:return(e*n%3+(e+n)%2)%2===0;default:throw new Error("bad maskPattern:"+t)}}w.applyMask=function(e,n){let o=n.size;for(let i=0;i<o;i++)for(let s=0;s<o;s++)n.isReserved(s,i)||n.xor(s,i,Kn(e,s,i))};w.getBestMask=function(e,n){let o=Object.keys(w.Patterns).length,i=0,s=1/0;for(let a=0;a<o;a++){n(a),w.applyMask(a,e);let c=w.getPenaltyN1(e)+w.getPenaltyN2(e)+w.getPenaltyN3(e)+w.getPenaltyN4(e);w.applyMask(a,e),c<s&&(s=c,i=a)}return i}});var Me=y(Ae=>{var U=de(),pe=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],ge=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Ae.getBlocksCount=function(e,n){switch(n){case U.L:return pe[(e-1)*4+0];case U.M:return pe[(e-1)*4+1];case U.Q:return pe[(e-1)*4+2];case U.H:return pe[(e-1)*4+3];default:return}};Ae.getTotalCodewordsCount=function(e,n){switch(n){case U.L:return ge[(e-1)*4+0];case U.M:return ge[(e-1)*4+1];case U.Q:return ge[(e-1)*4+2];case U.H:return ge[(e-1)*4+3];default:return}}});var Ct=y(ye=>{var ee=new Uint8Array(512),he=new Uint8Array(256);(function(){let e=1;for(let n=0;n<255;n++)ee[n]=e,he[e]=n,e<<=1,e&256&&(e^=285);for(let n=255;n<512;n++)ee[n]=ee[n-255]})();ye.log=function(e){if(e<1)throw new Error("log("+e+")");return he[e]};ye.exp=function(e){return ee[e]};ye.mul=function(e,n){return e===0||n===0?0:ee[he[e]+he[n]]}});var xt=y(te=>{var Ue=Ct();te.mul=function(e,n){let o=new Uint8Array(e.length+n.length-1);for(let i=0;i<e.length;i++)for(let s=0;s<n.length;s++)o[i+s]^=Ue.mul(e[i],n[s]);return o};te.mod=function(e,n){let o=new Uint8Array(e);for(;o.length-n.length>=0;){let i=o[0];for(let a=0;a<n.length;a++)o[a]^=Ue.mul(n[a],i);let s=0;for(;s<o.length&&o[s]===0;)s++;o=o.slice(s)}return o};te.generateECPolynomial=function(e){let n=new Uint8Array([1]);for(let o=0;o<e;o++)n=te.mul(n,new Uint8Array([1,Ue.exp(o)]));return n}});var It=y((No,Nt)=>{var Lt=xt();function De(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}De.prototype.initialize=function(e){this.degree=e,this.genPoly=Lt.generateECPolynomial(this.degree)};De.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");let n=new Uint8Array(e.length+this.degree);n.set(e);let o=Lt.mod(n,this.genPoly),i=this.degree-o.length;if(i>0){let s=new Uint8Array(this.degree);return s.set(o,i),s}return o};Nt.exports=De});var Ve=y(St=>{St.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}});var Ke=y(S=>{var Rt="[0-9]+",qn="[A-Z $%*+\\-./:]+",ne="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";ne=ne.replace(/u/g,"\\u");var Fn="(?:(?![A-Z0-9 $%*+\\-./:]|"+ne+`)(?:.|[\r
]))+`;S.KANJI=new RegExp(ne,"g");S.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");S.BYTE=new RegExp(Fn,"g");S.NUMERIC=new RegExp(Rt,"g");S.ALPHANUMERIC=new RegExp(qn,"g");var _n=new RegExp("^"+ne+"$"),Hn=new RegExp("^"+Rt+"$"),zn=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");S.testKanji=function(e){return _n.test(e)};S.testNumeric=function(e){return Hn.test(e)};S.testAlphanumeric=function(e){return zn.test(e)}});var D=y(E=>{var On=Ve(),qe=Ke();E.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]};E.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]};E.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]};E.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]};E.MIXED={bit:-1};E.getCharCountIndicator=function(e,n){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!On.isValid(n))throw new Error("Invalid version: "+n);return n>=1&&n<10?e.ccBits[0]:n<27?e.ccBits[1]:e.ccBits[2]};E.getBestModeForData=function(e){return qe.testNumeric(e)?E.NUMERIC:qe.testAlphanumeric(e)?E.ALPHANUMERIC:qe.testKanji(e)?E.KANJI:E.BYTE};E.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")};E.isValid=function(e){return e&&e.bit&&e.ccBits};function Jn(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return E.NUMERIC;case"alphanumeric":return E.ALPHANUMERIC;case"kanji":return E.KANJI;case"byte":return E.BYTE;default:throw new Error("Unknown mode: "+t)}}E.from=function(e,n){if(E.isValid(e))return e;try{return Jn(e)}catch{return n}}});var Dt=y(F=>{var me=M(),$n=Me(),Tt=de(),V=D(),Fe=Ve(),Mt=7973,At=me.getBCHDigit(Mt);function Gn(t,e,n){for(let o=1;o<=40;o++)if(e<=F.getCapacity(o,n,t))return o}function Ut(t,e){return V.getCharCountIndicator(t,e)+4}function Yn(t,e){let n=0;return t.forEach(function(o){let i=Ut(o.mode,e);n+=i+o.getBitsLength()}),n}function Qn(t,e){for(let n=1;n<=40;n++)if(Yn(t,n)<=F.getCapacity(n,e,V.MIXED))return n}F.from=function(e,n){return Fe.isValid(e)?parseInt(e,10):n};F.getCapacity=function(e,n,o){if(!Fe.isValid(e))throw new Error("Invalid QR Code version");typeof o>"u"&&(o=V.BYTE);let i=me.getSymbolTotalCodewords(e),s=$n.getTotalCodewordsCount(e,n),a=(i-s)*8;if(o===V.MIXED)return a;let c=a-Ut(o,e);switch(o){case V.NUMERIC:return Math.floor(c/10*3);case V.ALPHANUMERIC:return Math.floor(c/11*2);case V.KANJI:return Math.floor(c/13);case V.BYTE:default:return Math.floor(c/8)}};F.getBestVersionForData=function(e,n){let o,i=Tt.from(n,Tt.M);if(Array.isArray(e)){if(e.length>1)return Qn(e,i);if(e.length===0)return 1;o=e[0]}else o=e;return Gn(o.mode,o.getLength(),i)};F.getEncodedBits=function(e){if(!Fe.isValid(e)||e<7)throw new Error("Invalid QR Code version");let n=e<<12;for(;me.getBCHDigit(n)-At>=0;)n^=Mt<<me.getBCHDigit(n)-At;return e<<12|n}});var Ft=y(qt=>{var _e=M(),Kt=1335,jn=21522,Vt=_e.getBCHDigit(Kt);qt.getEncodedBits=function(e,n){let o=e.bit<<3|n,i=o<<10;for(;_e.getBCHDigit(i)-Vt>=0;)i^=Kt<<_e.getBCHDigit(i)-Vt;return(o<<10|i)^jn}});var Ht=y((Mo,_t)=>{var Wn=D();function $(t){this.mode=Wn.NUMERIC,this.data=t.toString()}$.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};$.prototype.getLength=function(){return this.data.length};$.prototype.getBitsLength=function(){return $.getBitsLength(this.data.length)};$.prototype.write=function(e){let n,o,i;for(n=0;n+3<=this.data.length;n+=3)o=this.data.substr(n,3),i=parseInt(o,10),e.put(i,10);let s=this.data.length-n;s>0&&(o=this.data.substr(n),i=parseInt(o,10),e.put(i,s*3+1))};_t.exports=$});var Ot=y((Uo,zt)=>{var Zn=D(),He=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function G(t){this.mode=Zn.ALPHANUMERIC,this.data=t}G.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};G.prototype.getLength=function(){return this.data.length};G.prototype.getBitsLength=function(){return G.getBitsLength(this.data.length)};G.prototype.write=function(e){let n;for(n=0;n+2<=this.data.length;n+=2){let o=He.indexOf(this.data[n])*45;o+=He.indexOf(this.data[n+1]),e.put(o,11)}this.data.length%2&&e.put(He.indexOf(this.data[n]),6)};zt.exports=G});var $t=y((Do,Jt)=>{var Xn=D();function Y(t){this.mode=Xn.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}Y.getBitsLength=function(e){return e*8};Y.prototype.getLength=function(){return this.data.length};Y.prototype.getBitsLength=function(){return Y.getBitsLength(this.data.length)};Y.prototype.write=function(t){for(let e=0,n=this.data.length;e<n;e++)t.put(this.data[e],8)};Jt.exports=Y});var Yt=y((Vo,Gt)=>{var er=D(),tr=M();function Q(t){this.mode=er.KANJI,this.data=t}Q.getBitsLength=function(e){return e*13};Q.prototype.getLength=function(){return this.data.length};Q.prototype.getBitsLength=function(){return Q.getBitsLength(this.data.length)};Q.prototype.write=function(t){let e;for(e=0;e<this.data.length;e++){let n=tr.toSJIS(this.data[e]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),t.put(n,13)}};Gt.exports=Q});var Qt=y((Ko,ze)=>{"use strict";var re={single_source_shortest_paths:function(t,e,n){var o={},i={};i[e]=0;var s=re.PriorityQueue.make();s.push(e,0);for(var a,c,u,p,g,P,b,L,T;!s.empty();){a=s.pop(),c=a.value,p=a.cost,g=t[c]||{};for(u in g)g.hasOwnProperty(u)&&(P=g[u],b=p+P,L=i[u],T=typeof i[u]>"u",(T||L>b)&&(i[u]=b,s.push(u,b),o[u]=c))}if(typeof n<"u"&&typeof i[n]>"u"){var A=["Could not find a path from ",e," to ",n,"."].join("");throw new Error(A)}return o},extract_shortest_path_from_predecessor_list:function(t,e){for(var n=[],o=e,i;o;)n.push(o),i=t[o],o=t[o];return n.reverse(),n},find_path:function(t,e,n){var o=re.single_source_shortest_paths(t,e,n);return re.extract_shortest_path_from_predecessor_list(o,n)},PriorityQueue:{make:function(t){var e=re.PriorityQueue,n={},o;t=t||{};for(o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);return n.queue=[],n.sorter=t.sorter||e.default_sorter,n},default_sorter:function(t,e){return t.cost-e.cost},push:function(t,e){var n={value:t,cost:e};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};typeof ze<"u"&&(ze.exports=re)});var rn=y(j=>{var h=D(),Zt=Ht(),Xt=Ot(),en=$t(),tn=Yt(),oe=Ke(),we=M(),nr=Qt();function jt(t){return unescape(encodeURIComponent(t)).length}function ie(t,e,n){let o=[],i;for(;(i=t.exec(n))!==null;)o.push({data:i[0],index:i.index,mode:e,length:i[0].length});return o}function nn(t){let e=ie(oe.NUMERIC,h.NUMERIC,t),n=ie(oe.ALPHANUMERIC,h.ALPHANUMERIC,t),o,i;return we.isKanjiModeEnabled()?(o=ie(oe.BYTE,h.BYTE,t),i=ie(oe.KANJI,h.KANJI,t)):(o=ie(oe.BYTE_KANJI,h.BYTE,t),i=[]),e.concat(n,o,i).sort(function(a,c){return a.index-c.index}).map(function(a){return{data:a.data,mode:a.mode,length:a.length}})}function Oe(t,e){switch(e){case h.NUMERIC:return Zt.getBitsLength(t);case h.ALPHANUMERIC:return Xt.getBitsLength(t);case h.KANJI:return tn.getBitsLength(t);case h.BYTE:return en.getBitsLength(t)}}function rr(t){return t.reduce(function(e,n){let o=e.length-1>=0?e[e.length-1]:null;return o&&o.mode===n.mode?(e[e.length-1].data+=n.data,e):(e.push(n),e)},[])}function or(t){let e=[];for(let n=0;n<t.length;n++){let o=t[n];switch(o.mode){case h.NUMERIC:e.push([o,{data:o.data,mode:h.ALPHANUMERIC,length:o.length},{data:o.data,mode:h.BYTE,length:o.length}]);break;case h.ALPHANUMERIC:e.push([o,{data:o.data,mode:h.BYTE,length:o.length}]);break;case h.KANJI:e.push([o,{data:o.data,mode:h.BYTE,length:jt(o.data)}]);break;case h.BYTE:e.push([{data:o.data,mode:h.BYTE,length:jt(o.data)}])}}return e}function ir(t,e){let n={},o={start:{}},i=["start"];for(let s=0;s<t.length;s++){let a=t[s],c=[];for(let u=0;u<a.length;u++){let p=a[u],g=""+s+u;c.push(g),n[g]={node:p,lastCount:0},o[g]={};for(let P=0;P<i.length;P++){let b=i[P];n[b]&&n[b].node.mode===p.mode?(o[b][g]=Oe(n[b].lastCount+p.length,p.mode)-Oe(n[b].lastCount,p.mode),n[b].lastCount+=p.length):(n[b]&&(n[b].lastCount=p.length),o[b][g]=Oe(p.length,p.mode)+4+h.getCharCountIndicator(p.mode,e))}}i=c}for(let s=0;s<i.length;s++)o[i[s]].end=0;return{map:o,table:n}}function Wt(t,e){let n,o=h.getBestModeForData(t);if(n=h.from(e,o),n!==h.BYTE&&n.bit<o.bit)throw new Error('"'+t+'" cannot be encoded with mode '+h.toString(n)+`.
 Suggested mode is: `+h.toString(o));switch(n===h.KANJI&&!we.isKanjiModeEnabled()&&(n=h.BYTE),n){case h.NUMERIC:return new Zt(t);case h.ALPHANUMERIC:return new Xt(t);case h.KANJI:return new tn(t);case h.BYTE:return new en(t)}}j.fromArray=function(e){return e.reduce(function(n,o){return typeof o=="string"?n.push(Wt(o,null)):o.data&&n.push(Wt(o.data,o.mode)),n},[])};j.fromString=function(e,n){let o=nn(e,we.isKanjiModeEnabled()),i=or(o),s=ir(i,n),a=nr.find_path(s.map,"start","end"),c=[];for(let u=1;u<a.length-1;u++)c.push(s.table[a[u]].node);return j.fromArray(rr(c))};j.rawSplit=function(e){return j.fromArray(nn(e,we.isKanjiModeEnabled()))}});var sn=y(on=>{var ke=M(),Je=de(),sr=mt(),ar=bt(),lr=kt(),cr=vt(),Ye=Bt(),Qe=Me(),ur=It(),be=Dt(),dr=Ft(),fr=D(),$e=rn();function pr(t,e){let n=t.size,o=cr.getPositions(e);for(let i=0;i<o.length;i++){let s=o[i][0],a=o[i][1];for(let c=-1;c<=7;c++)if(!(s+c<=-1||n<=s+c))for(let u=-1;u<=7;u++)a+u<=-1||n<=a+u||(c>=0&&c<=6&&(u===0||u===6)||u>=0&&u<=6&&(c===0||c===6)||c>=2&&c<=4&&u>=2&&u<=4?t.set(s+c,a+u,!0,!0):t.set(s+c,a+u,!1,!0))}}function gr(t){let e=t.size;for(let n=8;n<e-8;n++){let o=n%2===0;t.set(n,6,o,!0),t.set(6,n,o,!0)}}function hr(t,e){let n=lr.getPositions(e);for(let o=0;o<n.length;o++){let i=n[o][0],s=n[o][1];for(let a=-2;a<=2;a++)for(let c=-2;c<=2;c++)a===-2||a===2||c===-2||c===2||a===0&&c===0?t.set(i+a,s+c,!0,!0):t.set(i+a,s+c,!1,!0)}}function yr(t,e){let n=t.size,o=be.getEncodedBits(e),i,s,a;for(let c=0;c<18;c++)i=Math.floor(c/3),s=c%3+n-8-3,a=(o>>c&1)===1,t.set(i,s,a,!0),t.set(s,i,a,!0)}function Ge(t,e,n){let o=t.size,i=dr.getEncodedBits(e,n),s,a;for(s=0;s<15;s++)a=(i>>s&1)===1,s<6?t.set(s,8,a,!0):s<8?t.set(s+1,8,a,!0):t.set(o-15+s,8,a,!0),s<8?t.set(8,o-s-1,a,!0):s<9?t.set(8,15-s-1+1,a,!0):t.set(8,15-s-1,a,!0);t.set(o-8,8,1,!0)}function mr(t,e){let n=t.size,o=-1,i=n-1,s=7,a=0;for(let c=n-1;c>0;c-=2)for(c===6&&c--;;){for(let u=0;u<2;u++)if(!t.isReserved(i,c-u)){let p=!1;a<e.length&&(p=(e[a]>>>s&1)===1),t.set(i,c-u,p),s--,s===-1&&(a++,s=7)}if(i+=o,i<0||n<=i){i-=o,o=-o;break}}}function wr(t,e,n){let o=new sr;n.forEach(function(u){o.put(u.mode.bit,4),o.put(u.getLength(),fr.getCharCountIndicator(u.mode,t)),u.write(o)});let i=ke.getSymbolTotalCodewords(t),s=Qe.getTotalCodewordsCount(t,e),a=(i-s)*8;for(o.getLengthInBits()+4<=a&&o.put(0,4);o.getLengthInBits()%8!==0;)o.putBit(0);let c=(a-o.getLengthInBits())/8;for(let u=0;u<c;u++)o.put(u%2?17:236,8);return br(o,t,e)}function br(t,e,n){let o=ke.getSymbolTotalCodewords(e),i=Qe.getTotalCodewordsCount(e,n),s=o-i,a=Qe.getBlocksCount(e,n),c=o%a,u=a-c,p=Math.floor(o/a),g=Math.floor(s/a),P=g+1,b=p-g,L=new ur(b),T=0,A=new Array(a),nt=new Array(a),Be=0,vn=new Uint8Array(t.buffer);for(let O=0;O<a;O++){let xe=O<u?g:P;A[O]=vn.slice(T,T+xe),nt[O]=L.encode(A[O]),T+=xe,Be=Math.max(Be,xe)}let Ce=new Uint8Array(o),rt=0,N,I;for(N=0;N<Be;N++)for(I=0;I<a;I++)N<A[I].length&&(Ce[rt++]=A[I][N]);for(N=0;N<b;N++)for(I=0;I<a;I++)Ce[rt++]=nt[I][N];return Ce}function kr(t,e,n,o){let i;if(Array.isArray(t))i=$e.fromArray(t);else if(typeof t=="string"){let p=e;if(!p){let g=$e.rawSplit(t);p=be.getBestVersionForData(g,n)}i=$e.fromString(t,p||40)}else throw new Error("Invalid data");let s=be.getBestVersionForData(i,n);if(!s)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=s;else if(e<s)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+s+`.
`);let a=wr(e,n,i),c=ke.getSymbolSize(e),u=new ar(c);return pr(u,e),gr(u),hr(u,e),Ge(u,n,0),e>=7&&yr(u,e),mr(u,a),isNaN(o)&&(o=Ye.getBestMask(u,Ge.bind(null,u,n))),Ye.applyMask(o,u),Ge(u,n,o),{modules:u,version:e,errorCorrectionLevel:n,maskPattern:o,segments:i}}on.create=function(e,n){if(typeof e>"u"||e==="")throw new Error("No input text");let o=Je.M,i,s;return typeof n<"u"&&(o=Je.from(n.errorCorrectionLevel,Je.M),i=be.from(n.version),s=Ye.from(n.maskPattern),n.toSJISFunc&&ke.setToSJISFunction(n.toSJISFunc)),kr(e,i,o,s)}});var je=y(_=>{function an(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let e=t.slice().replace("#","").split("");if(e.length<3||e.length===5||e.length>8)throw new Error("Invalid hex color: "+t);(e.length===3||e.length===4)&&(e=Array.prototype.concat.apply([],e.map(function(o){return[o,o]}))),e.length===6&&e.push("F","F");let n=parseInt(e.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:n&255,hex:"#"+e.slice(0,6).join("")}}_.getOptions=function(e){e||(e={}),e.color||(e.color={});let n=typeof e.margin>"u"||e.margin===null||e.margin<0?4:e.margin,o=e.width&&e.width>=21?e.width:void 0,i=e.scale||4;return{width:o,scale:o?4:i,margin:n,color:{dark:an(e.color.dark||"#000000ff"),light:an(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}};_.getScale=function(e,n){return n.width&&n.width>=e+n.margin*2?n.width/(e+n.margin*2):n.scale};_.getImageWidth=function(e,n){let o=_.getScale(e,n);return Math.floor((e+n.margin*2)*o)};_.qrToImageData=function(e,n,o){let i=n.modules.size,s=n.modules.data,a=_.getScale(i,o),c=Math.floor((i+o.margin*2)*a),u=o.margin*a,p=[o.color.light,o.color.dark];for(let g=0;g<c;g++)for(let P=0;P<c;P++){let b=(g*c+P)*4,L=o.color.light;if(g>=u&&P>=u&&g<c-u&&P<c-u){let T=Math.floor((g-u)/a),A=Math.floor((P-u)/a);L=p[s[T*i+A]?1:0]}e[b++]=L.r,e[b++]=L.g,e[b++]=L.b,e[b]=L.a}}});var ln=y(Ee=>{var We=je();function Er(t,e,n){t.clearRect(0,0,e.width,e.height),e.style||(e.style={}),e.height=n,e.width=n,e.style.height=n+"px",e.style.width=n+"px"}function Pr(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}Ee.render=function(e,n,o){let i=o,s=n;typeof i>"u"&&(!n||!n.getContext)&&(i=n,n=void 0),n||(s=Pr()),i=We.getOptions(i);let a=We.getImageWidth(e.modules.size,i),c=s.getContext("2d"),u=c.createImageData(a,a);return We.qrToImageData(u.data,e,i),Er(c,s,a),c.putImageData(u,0,0),s};Ee.renderToDataURL=function(e,n,o){let i=o;typeof i>"u"&&(!n||!n.getContext)&&(i=n,n=void 0),i||(i={});let s=Ee.render(e,n,i),a=i.type||"image/png",c=i.rendererOpts||{};return s.toDataURL(a,c.quality)}});var dn=y(un=>{var vr=je();function cn(t,e){let n=t.a/255,o=e+'="'+t.hex+'"';return n<1?o+" "+e+'-opacity="'+n.toFixed(2).slice(1)+'"':o}function Ze(t,e,n){let o=t+e;return typeof n<"u"&&(o+=" "+n),o}function Br(t,e,n){let o="",i=0,s=!1,a=0;for(let c=0;c<t.length;c++){let u=Math.floor(c%e),p=Math.floor(c/e);!u&&!s&&(s=!0),t[c]?(a++,c>0&&u>0&&t[c-1]||(o+=s?Ze("M",u+n,.5+p+n):Ze("m",i,0),i=0,s=!1),u+1<e&&t[c+1]||(o+=Ze("h",a),a=0)):i++}return o}un.render=function(e,n,o){let i=vr.getOptions(n),s=e.modules.size,a=e.modules.data,c=s+i.margin*2,u=i.color.light.a?"<path "+cn(i.color.light,"fill")+' d="M0 0h'+c+"v"+c+'H0z"/>':"",p="<path "+cn(i.color.dark,"stroke")+' d="'+Br(a,s,i.margin)+'"/>',g='viewBox="0 0 '+c+" "+c+'"',b='<svg xmlns="http://www.w3.org/2000/svg" '+(i.width?'width="'+i.width+'" height="'+i.width+'" ':"")+g+' shape-rendering="crispEdges">'+u+p+`</svg>
`;return typeof o=="function"&&o(null,b),b}});var pn=y(se=>{var Cr=gt(),Xe=sn(),fn=ln(),xr=dn();function et(t,e,n,o,i){let s=[].slice.call(arguments,1),a=s.length,c=typeof s[a-1]=="function";if(!c&&!Cr())throw new Error("Callback required as last argument");if(c){if(a<2)throw new Error("Too few arguments provided");a===2?(i=n,n=e,e=o=void 0):a===3&&(e.getContext&&typeof i>"u"?(i=o,o=void 0):(i=o,o=n,n=e,e=void 0))}else{if(a<1)throw new Error("Too few arguments provided");return a===1?(n=e,e=o=void 0):a===2&&!e.getContext&&(o=n,n=e,e=void 0),new Promise(function(u,p){try{let g=Xe.create(n,o);u(t(g,e,o))}catch(g){p(g)}})}try{let u=Xe.create(n,o);i(null,t(u,e,o))}catch(u){i(u)}}se.create=Xe.create;se.toCanvas=et.bind(null,fn.render);se.toDataURL=et.bind(null,fn.renderToDataURL);se.toString=et.bind(null,function(t,e,n){return xr.render(t,n)})});var f=typeof browser<"u"?browser:typeof chrome<"u"?chrome:null;if(!f)throw new Error("browser-polyfill: No extension API namespace found (neither browser nor chrome).");var v=typeof browser>"u"&&typeof chrome<"u";function B(t,e){return(...n)=>{try{let o=e.apply(t,n);if(o&&typeof o.then=="function")return o}catch{}return new Promise((o,i)=>{e.apply(t,[...n,(...s)=>{f.runtime&&f.runtime.lastError?i(new Error(f.runtime.lastError.message)):o(s.length<=1?s[0]:s)}])})}}var m={};m.runtime={sendMessage(...t){return v?B(f.runtime,f.runtime.sendMessage)(...t):f.runtime.sendMessage(...t)},onMessage:f.runtime.onMessage,getURL(t){return f.runtime.getURL(t)},openOptionsPage(){return v?B(f.runtime,f.runtime.openOptionsPage)():f.runtime.openOptionsPage()},get id(){return f.runtime.id}};m.storage={local:{get(...t){return v?B(f.storage.local,f.storage.local.get)(...t):f.storage.local.get(...t)},set(...t){return v?B(f.storage.local,f.storage.local.set)(...t):f.storage.local.set(...t)},clear(...t){return v?B(f.storage.local,f.storage.local.clear)(...t):f.storage.local.clear(...t)},remove(...t){return v?B(f.storage.local,f.storage.local.remove)(...t):f.storage.local.remove(...t)}}};m.tabs={create(...t){return v?B(f.tabs,f.tabs.create)(...t):f.tabs.create(...t)},query(...t){return v?B(f.tabs,f.tabs.query)(...t):f.tabs.query(...t)},remove(...t){return v?B(f.tabs,f.tabs.remove)(...t):f.tabs.remove(...t)},update(...t){return v?B(f.tabs,f.tabs.update)(...t):f.tabs.update(...t)},get(...t){return v?B(f.tabs,f.tabs.get)(...t):f.tabs.get(...t)},getCurrent(...t){return v?B(f.tabs,f.tabs.getCurrent)(...t):f.tabs.getCurrent(...t)}};var it=5,k=m.storage.local,Le=[new URL("wss://relay.damus.io"),new URL("wss://relay.primal.net"),new URL("wss://relay.snort.social"),new URL("wss://relay.getalby.com/v1"),new URL("wss://nos.lol"),new URL("wss://brb.io"),new URL("wss://nostr.orangepill.dev")];async function Ne(){await st("profileIndex",0),await st("profiles",[await ct()]);let t=(await k.get({version:0})).version;for(;t<it;)t=await Rn(t,it),await k.set({version:t})}async function Rn(t,e){if(t===0){let n=await x();return n.forEach(o=>o.hosts={}),await k.set({profiles:n}),t+1}if(t===1){let n=await x();return await k.set({profiles:n}),t+1}if(t===2){let n=await x();return n.forEach(o=>o.relayReminder=!0),await k.set({profiles:n}),t+1}if(t===3)return(await k.get({isEncrypted:!1})).isEncrypted||await k.set({isEncrypted:!1}),t+1;if(t===4){let n=await x();return n.forEach(o=>{o.type||(o.type="local"),o.bunkerUrl===void 0&&(o.bunkerUrl=null),o.remotePubkey===void 0&&(o.remotePubkey=null)}),await k.set({profiles:n}),t+1}}async function x(){return(await k.get({profiles:[]})).profiles}async function Z(t){return(await x())[t]}async function at(){return(await x()).map(e=>e.name)}async function J(){return(await k.get({profileIndex:0})).profileIndex}async function Ie(t){await k.set({profileIndex:t})}async function lt(t){let e=await x(),n=await J();if(e.splice(t,1),e.length==0)await Tn(),await Ne();else{let o=n===t?Math.max(t-1,0):n;await k.set({profiles:e,profileIndex:o})}}async function Tn(){let t=await k.get({ignoreInstallHook:!1});await k.clear(),await k.set(t)}async function An(){return await m.runtime.sendMessage({kind:"generatePrivateKey"})}async function ct(t="Default Nostr Profile",e="local"){return{name:t,privKey:e==="local"?await An():"",hosts:{},relays:Le.map(n=>({url:n.href,read:!0,write:!0})),relayReminder:!1,type:e,bunkerUrl:null,remotePubkey:null}}async function st(t,e){let n=(await k.get(t))[t];return n==null||n==null?(await k.set({[t]:e}),e):n}async function Se(t,e){let n=await x();n[t].name=e,await k.set({profiles:n})}async function ut(){let t=await x(),e=await ct("New Profile");return t.push(e),await k.set({profiles:t}),t.length-1}async function Re(t){return(await Z(t)).relays||[]}async function ce(t,e){let n=JSON.parse(JSON.stringify(e)),o=await x(),i=o[t];i.relays=n,await k.set({profiles:o})}async function dt(){let t=await J();return(await Z(t)).relayReminder}async function ft(){let t=await J(),e=await x();e[t].relayReminder=!1,await k.set({profiles:e})}async function ue(){let t=await J();return await m.runtime.sendMessage({kind:"getNpub",payload:t})}var mn=Sn(pn()),l={profileNames:["Default Nostr Profile"],profileIndex:0,relayCount:0,relays:[],showRelayReminder:!0,isLocked:!1,hasPassword:!1,npubQrDataUrl:"",currentNpub:"",profileType:"local",bunkerConnected:!1,currentView:"home",permissions:[],viewingProfileIndex:null,viewNsecVisible:!1,viewNsecValue:"",editingProfileIndex:null,editProfileName:"",editProfileKey:"",keyVisible:!1},r={};function d(t){return document.getElementById(t)}function Lr(){r.lockedView=d("locked-view"),r.unlockedView=d("unlocked-view"),r.unlockForm=d("unlock-form"),r.unlockPassword=d("unlock-password"),r.unlockError=d("unlock-error"),r.lockBtn=d("lock-btn"),r.profileList=d("profile-list"),r.profileDetails=d("profile-details"),r.profileName=d("profile-name"),r.npubDisplay=d("npub-display"),r.addProfileBtn=d("add-profile-btn"),r.copyNpubBtn=d("copy-npub-btn"),r.qrContainer=d("qr-container"),r.qrImage=d("qr-image"),r.copyQrPngBtn=d("copy-qr-png-btn"),r.bunkerStatus=d("bunker-status"),r.bunkerIndicator=d("bunker-indicator"),r.bunkerText=d("bunker-text"),r.relayReminder=d("relay-reminder"),r.relayCountText=d("relay-count-text"),r.addRelaysBtn=d("add-relays-btn"),r.noThanksBtn=d("no-thanks-btn"),r.tabBtns=document.querySelectorAll(".tab-btn"),r.viewSections=document.querySelectorAll(".view-section"),r.relayList=d("relay-list"),r.newRelayInput=d("new-relay-input"),r.addRelayBtn=d("add-relay-btn"),r.permissionsList=d("permissions-list"),r.openSettingsBtn=d("open-settings-btn"),r.openHistoryBtn=d("open-history-btn"),r.openExperimentalBtn=d("open-experimental-btn"),r.openVaultBtn=d("open-vault-btn"),r.openApikeysBtn=d("open-apikeys-btn"),r.vaultNoPassword=d("vault-no-password"),r.vaultLockedGate=d("vault-locked-gate"),r.vaultUnlockedContent=d("vault-unlocked-content"),r.vaultGotoSecurityBtn=d("vault-goto-security-btn"),r.vaultUnlockForm=d("vault-unlock-form"),r.vaultUnlockPassword=d("vault-unlock-password"),r.vaultUnlockError=d("vault-unlock-error"),r.settingsSecurityBtn=d("settings-security-btn"),r.settingsAutolockBtn=d("settings-autolock-btn"),r.unencryptedWarning=d("unencrypted-warning"),r.setupEncryptionBtn=d("setup-encryption-btn"),r.checkVaultBtn=d("check-vault-btn"),r.vaultCheckResult=d("vault-check-result"),r.profileViewTitle=d("profile-view-title"),r.viewProfileName=d("view-profile-name"),r.viewNpub=d("view-npub"),r.viewNsec=d("view-nsec"),r.backFromViewBtn=d("back-from-view-btn"),r.editProfileBtn=d("edit-profile-btn"),r.copyViewNpubBtn=d("copy-view-npub-btn"),r.copyViewNsecBtn=d("copy-view-nsec-btn"),r.toggleViewNsecBtn=d("toggle-view-nsec-btn"),r.profileEditTitle=d("profile-edit-title"),r.editProfileName=d("edit-profile-name"),r.editProfileKey=d("edit-profile-key"),r.toggleKeyVisibility=d("toggle-key-visibility"),r.generateKeyBtn=d("generate-key-btn"),r.saveProfileBtn=d("save-profile-btn"),r.deleteProfileBtn=d("delete-profile-btn"),r.backToProfilesBtn=d("back-to-profiles-btn"),r.profileEditError=d("profile-edit-error"),r.profileEditSuccess=d("profile-edit-success"),r.keySection=d("key-section"),r.forgotPasswordBtn=d("forgot-password-btn"),r.resetConfirm=d("reset-confirm"),r.confirmResetBtn=d("confirm-reset-btn"),r.cancelResetBtn=d("cancel-reset-btn")}function z(){l.isLocked?(r.lockedView.classList.remove("hidden"),r.unlockedView.classList.add("hidden")):(r.lockedView.classList.add("hidden"),r.unlockedView.classList.remove("hidden"),ve())}function ve(){l.hasPassword?r.lockBtn.classList.remove("hidden"):r.lockBtn.classList.add("hidden"),r.settingsAutolockBtn&&(r.settingsAutolockBtn.disabled=!l.hasPassword,r.settingsAutolockBtn.style.opacity=l.hasPassword?"1":"0.4"),r.unencryptedWarning&&(l.hasPassword?r.unencryptedWarning.classList.add("hidden"):r.unencryptedWarning.classList.remove("hidden")),r.vaultNoPassword&&r.vaultLockedGate&&r.vaultUnlockedContent&&(l.hasPassword?l.isLocked?(r.vaultNoPassword.style.display="none",r.vaultLockedGate.style.display="block",r.vaultUnlockedContent.style.display="none"):(r.vaultNoPassword.style.display="none",r.vaultLockedGate.style.display="none",r.vaultUnlockedContent.style.display="block"):(r.vaultNoPassword.style.display="block",r.vaultLockedGate.style.display="none",r.vaultUnlockedContent.style.display="none")),Nr(),Ir()}function Nr(){r.profileList&&(r.profileList.innerHTML=l.profileNames.map((t,e)=>`
        <div class="profile-item flex items-center gap-3 p-3 rounded-lg transition-colors ${e===l.profileIndex?"bg-monokai-bg-lighter border border-monokai-accent":"bg-monokai-bg-light border border-transparent hover:border-monokai-bg-lighter"}" data-index="${e}">
            <div class="profile-select-area flex items-center gap-3 flex-1 min-w-0 cursor-pointer" data-index="${e}">
                <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0" style="background:#272822;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="${e===l.profileIndex?"#a6e22e":"#8f908a"}" stroke-width="1.5">
                        <circle cx="12" cy="8" r="4"></circle>
                        <path d="M4 20c0-4 4-6 8-6s8 2 8 6"></path>
                    </svg>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="font-medium truncate" style="color:${e===l.profileIndex?"#a6e22e":"#f8f8f2"};">${t}</div>
                    <div class="text-xs truncate" style="color:#8f908a;">${e===l.profileIndex?"Active":"Click to select"}</div>
                </div>
            </div>
            <button class="profile-edit-btn flex-shrink-0" data-index="${e}" title="Edit profile" style="padding:8px;background:transparent;border:none;cursor:pointer;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#8f908a" stroke-width="1.5">
                    <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>
            ${e===l.profileIndex?'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#a6e22e" stroke-width="2" class="flex-shrink-0"><path d="M20 6L9 17l-5-5"></path></svg>':""}
        </div>
    `).join(""),r.profileList.querySelectorAll(".profile-select-area").forEach(t=>{t.addEventListener("click",async()=>{let e=parseInt(t.dataset.index,10);e!==l.profileIndex&&await Tr(e)})}),r.profileList.querySelectorAll(".profile-edit-btn").forEach(t=>{t.addEventListener("click",async e=>{e.stopPropagation();let n=parseInt(t.dataset.index,10);await Mr(n)})}))}function Ir(){r.profileDetails&&(r.profileDetails.classList.remove("hidden"),r.profileName.textContent=l.profileNames[l.profileIndex]||"Default",l.currentNpub&&r.npubDisplay&&(r.npubDisplay.textContent=l.currentNpub),l.npubQrDataUrl?(r.qrImage.src=l.npubQrDataUrl,r.qrContainer.classList.remove("hidden")):r.qrContainer.classList.add("hidden"),l.profileType==="bunker"?(r.bunkerStatus.classList.remove("hidden"),r.bunkerIndicator.className=`inline-block w-2 h-2 rounded-full ${l.bunkerConnected?"bg-green-500":"bg-red-500"}`,r.bunkerText.textContent=l.bunkerConnected?"Bunker connected":"Bunker disconnected"):r.bunkerStatus.classList.add("hidden"),r.relayCountText&&(r.relayCountText.textContent=`${l.relayCount} relay${l.relayCount!==1?"s":""} configured`),l.relayCount<1&&l.showRelayReminder?r.relayReminder.classList.remove("hidden"):r.relayReminder.classList.add("hidden"))}async function ae(){await m.runtime.sendMessage({kind:"resetAutoLock"}),await Sr(),await Rr(),await wn(),await le(),await bn(),await kn(),z()}async function Sr(){l.profileNames=await at()}async function Rr(){l.profileIndex=await J()}async function wn(){if(l.profileType=await m.runtime.sendMessage({kind:"getProfileType"}),l.profileType==="bunker"){let t=await m.runtime.sendMessage({kind:"bunker.status"});l.bunkerConnected=t?.connected||!1}else l.bunkerConnected=!1}async function le(){let t=await Re(l.profileIndex);l.relayCount=t.length}async function bn(){l.showRelayReminder=await dt()}async function kn(){try{let t=await ue();if(!t){l.npubQrDataUrl="",l.currentNpub="";return}l.currentNpub=t,l.npubQrDataUrl=await mn.default.toDataURL(t.toUpperCase(),{width:200,margin:2,color:{dark:"#a6e22e",light:"#272822"}})}catch{l.npubQrDataUrl="",l.currentNpub=""}}async function Tr(t){l.profileIndex=t,await Ie(l.profileIndex),await wn(),await le(),await bn(),await kn(),z()}function Ar(){l.editingProfileIndex=null,l.editProfileName="",l.editProfileKey="",l.keyVisible=!1,En()}function En(){r.profileEditTitle&&(r.profileEditTitle.textContent=l.editingProfileIndex===null?"New Profile":"Edit Profile"),r.editProfileName&&(r.editProfileName.value=l.editProfileName),r.editProfileKey&&(r.editProfileKey.value=l.editProfileKey,r.editProfileKey.type=l.keyVisible?"text":"password"),r.deleteProfileBtn&&(l.editingProfileIndex!==null&&l.profileNames.length>1?r.deleteProfileBtn.classList.remove("hidden"):r.deleteProfileBtn.classList.add("hidden")),r.keySection&&(l.editingProfileIndex!==null?r.keySection.classList.add("hidden"):r.keySection.classList.remove("hidden")),r.profileEditError&&r.profileEditError.classList.add("hidden"),r.profileEditSuccess&&r.profileEditSuccess.classList.add("hidden"),W("profile-edit")}function W(t){r.viewSections.forEach(n=>{n.classList.remove("active")});let e=document.getElementById("view-"+t);e&&e.classList.add("active"),l.currentView=t}async function Mr(t){let e=await Z(t);if(!e)return;l.viewingProfileIndex=t,l.viewNsecVisible=!1;let n=await ue(t),o=await m.runtime.sendMessage({kind:"getNsec",payload:t});l.viewNsecValue=o||"",r.viewProfileName&&(r.viewProfileName.textContent=e.name||"Unnamed"),r.viewNpub&&(r.viewNpub.textContent=n||"Not available"),r.viewNsec&&(r.viewNsec.textContent="\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"),r.copyViewNsecBtn&&r.copyViewNsecBtn.classList.add("hidden"),W("profile-view")}function Ur(){l.viewNsecVisible=!l.viewNsecVisible,r.viewNsec&&(r.viewNsec.textContent=l.viewNsecVisible?l.viewNsecValue:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"),r.copyViewNsecBtn&&(l.viewNsecVisible?r.copyViewNsecBtn.classList.remove("hidden"):r.copyViewNsecBtn.classList.add("hidden"))}async function Dr(){r.viewNpub&&await navigator.clipboard.writeText(r.viewNpub.textContent)}async function Vr(){l.viewNsecValue&&await navigator.clipboard.writeText(l.viewNsecValue)}function Kr(){l.viewingProfileIndex!==null&&qr(l.viewingProfileIndex)}async function qr(t){let e=await Z(t);e&&(l.editingProfileIndex=t,l.editProfileName=e.name||"",l.editProfileKey="",l.keyVisible=!1,En())}async function Fr(){try{let t=await m.runtime.sendMessage({kind:"generatePrivateKey"});t&&r.editProfileKey?(l.editProfileKey=t,r.editProfileKey.value=t,l.keyVisible=!0,r.editProfileKey.type="text",Pe("Key generated!")):H("Failed to generate key - no response")}catch(t){H("Failed to generate key: "+t.message)}}function _r(){l.keyVisible=!l.keyVisible,r.editProfileKey&&(r.editProfileKey.type=l.keyVisible?"text":"password")}async function Hr(){let t=r.editProfileName?.value?.trim();if(!t){H("Please enter a profile name");return}try{if(l.editingProfileIndex===null){let e=r.editProfileKey?.value?.trim();if(!e){H("Please enter or generate a private key");return}let n=await ut();await Se(n,t),await m.runtime.sendMessage({kind:"savePrivateKey",payload:[n,e]}),l.profileIndex=n,await Ie(n),Pe("Profile created!")}else await Se(l.editingProfileIndex,t),Pe("Profile updated!");setTimeout(async()=>{await ae(),W("home")},800)}catch(e){H("Failed to save profile: "+e.message)}}async function zr(){if(l.editingProfileIndex!==null){if(l.profileNames.length<=1){H("Cannot delete the only profile");return}if(confirm("Delete this profile? This cannot be undone."))try{await lt(l.editingProfileIndex),Pe("Profile deleted"),setTimeout(async()=>{await ae(),W("home")},800)}catch(t){H("Failed to delete profile: "+t.message)}}}function H(t){r.profileEditError&&(r.profileEditError.textContent=t,r.profileEditError.classList.remove("hidden")),r.profileEditSuccess&&r.profileEditSuccess.classList.add("hidden"),r.editProfileName&&t.toLowerCase().includes("profile name")&&(r.editProfileName.style.borderColor="#f43f5e",r.editProfileName.style.borderWidth="2px")}function Pe(t){r.profileEditSuccess&&(r.profileEditSuccess.textContent=t,r.profileEditSuccess.classList.remove("hidden")),r.profileEditError&&r.profileEditError.classList.add("hidden"),Pn()}function Pn(){r.editProfileName&&(r.editProfileName.style.borderColor="",r.editProfileName.style.borderWidth="")}function Or(){W("home")}async function Jr(){let t=r.unlockPassword.value;if(!t){r.unlockError.textContent="Please enter your master password.",r.unlockError.classList.remove("hidden");return}let e=await m.runtime.sendMessage({kind:"unlock",payload:t});if(!e){r.unlockError.textContent="Service worker not ready \u2014 try again.",r.unlockError.classList.remove("hidden");return}e.success?(l.isLocked=!1,r.unlockPassword.value="",r.unlockError.classList.add("hidden"),await ae()):(r.unlockError.textContent=e.error||"Invalid password.",r.unlockError.classList.remove("hidden"))}async function $r(){await m.runtime.sendMessage({kind:"lock"}),l.isLocked=!0,z()}async function Gr(){let t=r.vaultUnlockPassword.value;if(!t){r.vaultUnlockError.textContent="Please enter your master password.",r.vaultUnlockError.classList.remove("hidden");return}let e=await m.runtime.sendMessage({kind:"unlock",payload:t});if(!e){r.vaultUnlockError.textContent="Service worker not ready \u2014 try again.",r.vaultUnlockError.classList.remove("hidden");return}e.success?(l.isLocked=!1,r.vaultUnlockPassword.value="",r.vaultUnlockError.classList.add("hidden"),ve()):(r.vaultUnlockError.textContent=e.error||"Invalid password.",r.vaultUnlockError.classList.remove("hidden"))}async function Yr(){(await m.runtime.sendMessage({kind:"resetAllData"}))?.success&&(l.isLocked=!1,l.hasPassword=!1,l.profileIndex=0,l.profileNames=["Default Nostr Profile"],r.resetConfirm.classList.add("hidden"),r.forgotPasswordBtn.style.display="inline",await ae())}async function Qr(){let t=await ue();navigator.clipboard?.writeText?await navigator.clipboard.writeText(t):await m.runtime.sendMessage({kind:"copy",payload:t})}async function jr(){if(!(!r.qrImage?.src||!l.npubQrDataUrl))try{let t=document.createElement("canvas"),e=t.getContext("2d"),n=24,o=200,i=40;t.width=o+n*2,t.height=o+i+n*2,e.fillStyle="#3e3d32",e.roundRect(0,0,t.width,t.height,16),e.fill();let s=l.profileNames[l.profileIndex]||"Nostr Profile";e.fillStyle="#f8f8f2",e.font="bold 16px -apple-system, BlinkMacSystemFont, sans-serif",e.textAlign="center",e.fillText(s,t.width/2,n+20);let a=r.qrImage;e.drawImage(a,n,n+i,o,o);let c=await new Promise(g=>t.toBlob(g,"image/png"));await navigator.clipboard.write([new ClipboardItem({"image/png":c})]);let u=r.copyQrPngBtn,p=u.textContent;u.textContent="Copied!",setTimeout(()=>{u.textContent=p},1500)}catch{}}async function Wr(){let t=Le.map(e=>({url:e.href,read:!0,write:!0}));await ce(l.profileIndex,t),await le(),z()}async function Zr(){await ft(),l.showRelayReminder=!1,z()}function Xr(){R("full_settings.html")}function R(t){let e=m.runtime.getURL(t);window.open(e,"nostrkey-options")}async function gn(){l.hasPassword=!!await m.runtime.sendMessage({kind:"isEncrypted"}),l.isLocked=!!await m.runtime.sendMessage({kind:"isLocked"}),ve()}function eo(t){l.currentView=t,r.tabBtns.forEach(e=>{e.dataset.view===t?e.classList.add("active"):e.classList.remove("active")}),r.viewSections.forEach(e=>{e.id===`view-${t}`?e.classList.add("active"):e.classList.remove("active")}),t==="relays"&&to(),t==="permissions"&&no(),t==="vault"&&gn(),t==="settings"&&gn()}async function to(){l.relays=await Re(l.profileIndex),tt()}function tt(){if(r.relayList){if(l.relays.length===0){r.relayList.innerHTML='<p style="color:#8f908a;font-style:italic;">No relays configured.</p>';return}r.relayList.innerHTML=l.relays.map((t,e)=>`
        <div class="flex items-center gap-2 py-2" style="border-bottom:1px solid #49483e;">
            <span class="flex-1 text-sm" style="color:#f8f8f2;word-break:break-all;">${t.url}</span>
            <button class="button relay-delete-btn" data-index="${e}" style="min-width:auto;padding:6px 10px;font-size:12px;">Delete</button>
        </div>
    `).join(""),r.relayList.querySelectorAll(".relay-delete-btn").forEach(t=>{t.addEventListener("click",async()=>{let e=parseInt(t.dataset.index,10);l.relays.splice(e,1),await ce(l.profileIndex,l.relays),tt(),await le()})})}}async function hn(){let t=r.newRelayInput?.value?.trim();!t||!t.startsWith("wss://")||(l.relays.push({url:t,read:!0,write:!0}),await ce(l.profileIndex,l.relays),r.newRelayInput.value="",tt(),await le())}async function no(){try{let t=await m.runtime.sendMessage({kind:"getPermissions"});l.permissions=t||[],yn()}catch{l.permissions=[],yn()}}function yn(){if(r.permissionsList){if(l.permissions.length===0){r.permissionsList.innerHTML='<p style="color:#8f908a;font-style:italic;">No permissions granted yet.</p>';return}r.permissionsList.innerHTML=l.permissions.map(t=>`
        <div class="flex items-center justify-between py-2" style="border-bottom:1px solid #49483e;">
            <span class="text-sm" style="color:#f8f8f2;">${t.host||t.origin||"Unknown"}</span>
            <span class="text-xs" style="color:#8f908a;">${t.level||"granted"}</span>
        </div>
    `).join("")}}function ro(){r.unlockForm.addEventListener("submit",async t=>{t.preventDefault(),await Jr()}),r.forgotPasswordBtn&&r.forgotPasswordBtn.addEventListener("click",()=>{r.resetConfirm.classList.remove("hidden"),r.forgotPasswordBtn.style.display="none"}),r.cancelResetBtn&&r.cancelResetBtn.addEventListener("click",()=>{r.resetConfirm.classList.add("hidden"),r.forgotPasswordBtn.style.display="inline"}),r.confirmResetBtn&&r.confirmResetBtn.addEventListener("click",Yr),r.lockBtn.addEventListener("click",$r),r.copyNpubBtn.addEventListener("click",Qr),r.addRelaysBtn.addEventListener("click",Wr),r.noThanksBtn.addEventListener("click",Zr),r.copyQrPngBtn&&r.copyQrPngBtn.addEventListener("click",jr),r.addProfileBtn&&r.addProfileBtn.addEventListener("click",Ar),r.backFromViewBtn&&r.backFromViewBtn.addEventListener("click",()=>W("home")),r.editProfileBtn&&r.editProfileBtn.addEventListener("click",Kr),r.copyViewNpubBtn&&r.copyViewNpubBtn.addEventListener("click",Dr),r.copyViewNsecBtn&&r.copyViewNsecBtn.addEventListener("click",Vr),r.toggleViewNsecBtn&&r.toggleViewNsecBtn.addEventListener("click",Ur),r.backToProfilesBtn&&r.backToProfilesBtn.addEventListener("click",Or),r.generateKeyBtn&&r.generateKeyBtn.addEventListener("click",Fr),r.toggleKeyVisibility&&r.toggleKeyVisibility.addEventListener("click",_r),r.saveProfileBtn&&r.saveProfileBtn.addEventListener("click",Hr),r.deleteProfileBtn&&r.deleteProfileBtn.addEventListener("click",zr),r.editProfileName&&r.editProfileName.addEventListener("input",Pn),r.tabBtns.forEach(t=>{t.addEventListener("click",()=>eo(t.dataset.view))}),r.addRelayBtn&&r.addRelayBtn.addEventListener("click",hn),r.newRelayInput&&r.newRelayInput.addEventListener("keypress",t=>{t.key==="Enter"&&hn()}),r.vaultUnlockForm&&r.vaultUnlockForm.addEventListener("submit",async t=>{t.preventDefault(),await Gr()}),r.openSettingsBtn&&r.openSettingsBtn.addEventListener("click",Xr),r.openHistoryBtn&&r.openHistoryBtn.addEventListener("click",()=>R("event_history/event_history.html")),r.openExperimentalBtn&&r.openExperimentalBtn.addEventListener("click",()=>R("experimental/experimental.html")),r.openVaultBtn&&r.openVaultBtn.addEventListener("click",()=>R("vault/vault.html")),r.openApikeysBtn&&r.openApikeysBtn.addEventListener("click",()=>R("api-keys/api-keys.html")),r.settingsSecurityBtn&&r.settingsSecurityBtn.addEventListener("click",()=>R("security/security.html")),r.settingsAutolockBtn&&r.settingsAutolockBtn.addEventListener("click",()=>R("security/security.html")),r.vaultGotoSecurityBtn&&r.vaultGotoSecurityBtn.addEventListener("click",()=>R("security/security.html")),r.checkVaultBtn&&r.checkVaultBtn.addEventListener("click",oo),r.setupEncryptionBtn&&r.setupEncryptionBtn.addEventListener("click",()=>R("security/security.html"))}async function oo(){let t=r.vaultCheckResult,e=r.checkVaultBtn;e&&(e.disabled=!0,e.textContent="Checking...");try{(await m.runtime.sendMessage({kind:"hasEncryptedData"}))?.found?(l.hasPassword=!0,l.isLocked=!0,z()):t&&(t.textContent="No existing vault found. Set a new password to get started.",t.style.background="#49483e",t.style.color="#b0b0a8",t.classList.remove("hidden"))}catch{t&&(t.textContent="Could not check \u2014 try again in a moment.",t.style.background="#49483e",t.style.color="#fd971f",t.classList.remove("hidden"))}finally{e&&(e.disabled=!1,e.textContent="Check for Existing Vault")}}async function io(){Lr(),ro(),await Ne();try{let t=await m.runtime.sendMessage({kind:"isEncrypted"});l.hasPassword=!!t;let e=await m.runtime.sendMessage({kind:"isLocked"});l.isLocked=!!e}catch{l.hasPassword=!1,l.isLocked=!1}if(!l.hasPassword)try{(await m.runtime.sendMessage({kind:"hasEncryptedData"}))?.found&&(l.hasPassword=!0,l.isLocked=!0)}catch{}m.runtime.onMessage.addListener(t=>{t.kind==="passwordStateChanged"&&(l.hasPassword=t.hasPassword,ve())}),l.isLocked?z():await ae()}document.addEventListener("DOMContentLoaded",io);})();
