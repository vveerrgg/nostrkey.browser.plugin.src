(()=>{var e=typeof browser<"u"?browser:typeof chrome<"u"?chrome:null;if(!e)throw new Error("browser-polyfill: No extension API namespace found (neither browser nor chrome).");var o=typeof browser>"u"&&typeof chrome<"u";function s(t,a){return(...l)=>{try{let i=a.apply(t,l);if(i&&typeof i.then=="function")return i}catch{}return new Promise((i,c)=>{a.apply(t,[...l,(...p)=>{e.runtime&&e.runtime.lastError?c(new Error(e.runtime.lastError.message)):i(p.length<=1?p[0]:p)}])})}}var r={};r.runtime={sendMessage(...t){return o?s(e.runtime,e.runtime.sendMessage)(...t):e.runtime.sendMessage(...t)},onMessage:e.runtime.onMessage,getURL(t){return e.runtime.getURL(t)},openOptionsPage(){return o?s(e.runtime,e.runtime.openOptionsPage)():e.runtime.openOptionsPage()},get id(){return e.runtime.id}};r.storage={local:{get(...t){return o?s(e.storage.local,e.storage.local.get)(...t):e.storage.local.get(...t)},set(...t){return o?s(e.storage.local,e.storage.local.set)(...t):e.storage.local.set(...t)},clear(...t){return o?s(e.storage.local,e.storage.local.clear)(...t):e.storage.local.clear(...t)},remove(...t){return o?s(e.storage.local,e.storage.local.remove)(...t):e.storage.local.remove(...t)}}};r.tabs={create(...t){return o?s(e.tabs,e.tabs.create)(...t):e.tabs.create(...t)},query(...t){return o?s(e.tabs,e.tabs.query)(...t):e.tabs.query(...t)},remove(...t){return o?s(e.tabs,e.tabs.remove)(...t):e.tabs.remove(...t)},update(...t){return o?s(e.tabs,e.tabs.update)(...t):e.tabs.update(...t)},get(...t){return o?s(e.tabs,e.tabs.get)(...t):e.tabs.get(...t)},getCurrent(...t){return o?s(e.tabs,e.tabs.getCurrent)(...t):e.tabs.getCurrent(...t)}};var L=r.storage.local,N=[new URL("wss://relay.damus.io"),new URL("wss://relay.primal.net"),new URL("wss://relay.snort.social"),new URL("wss://relay.getalby.com/v1"),new URL("wss://nos.lol"),new URL("wss://brb.io"),new URL("wss://nostr.orangepill.dev")],b=[[0,"Metadata","https://github.com/nostr-protocol/nips/blob/master/01.md"],[1,"Text","https://github.com/nostr-protocol/nips/blob/master/01.md"],[2,"Recommend Relay","https://github.com/nostr-protocol/nips/blob/master/01.md"],[3,"Contacts","https://github.com/nostr-protocol/nips/blob/master/02.md"],[4,"Encrypted Direct Messages","https://github.com/nostr-protocol/nips/blob/master/04.md"],[5,"Event Deletion","https://github.com/nostr-protocol/nips/blob/master/09.md"],[6,"Repost","https://github.com/nostr-protocol/nips/blob/master/18.md"],[7,"Reaction","https://github.com/nostr-protocol/nips/blob/master/25.md"],[8,"Badge Award","https://github.com/nostr-protocol/nips/blob/master/58.md"],[16,"Generic Repost","https://github.com/nostr-protocol/nips/blob/master/18.md"],[40,"Channel Creation","https://github.com/nostr-protocol/nips/blob/master/28.md"],[41,"Channel Metadata","https://github.com/nostr-protocol/nips/blob/master/28.md"],[42,"Channel Message","https://github.com/nostr-protocol/nips/blob/master/28.md"],[43,"Channel Hide Message","https://github.com/nostr-protocol/nips/blob/master/28.md"],[44,"Channel Mute User","https://github.com/nostr-protocol/nips/blob/master/28.md"],[1063,"File Metadata","https://github.com/nostr-protocol/nips/blob/master/94.md"],[1311,"Live Chat Message","https://github.com/nostr-protocol/nips/blob/master/53.md"],[1984,"Reporting","https://github.com/nostr-protocol/nips/blob/master/56.md"],[1985,"Label","https://github.com/nostr-protocol/nips/blob/master/32.md"],[4550,"Community Post Approval","https://github.com/nostr-protocol/nips/blob/master/72.md"],[7e3,"Job Feedback","https://github.com/nostr-protocol/nips/blob/master/90.md"],[9041,"Zap Goal","https://github.com/nostr-protocol/nips/blob/master/75.md"],[9734,"Zap Request","https://github.com/nostr-protocol/nips/blob/master/57.md"],[9735,"Zap","https://github.com/nostr-protocol/nips/blob/master/57.md"],[1e4,"Mute List","https://github.com/nostr-protocol/nips/blob/master/51.md"],[10001,"Pin List","https://github.com/nostr-protocol/nips/blob/master/51.md"],[10002,"Relay List Metadata","https://github.com/nostr-protocol/nips/blob/master/65.md"],[13194,"Wallet Info","https://github.com/nostr-protocol/nips/blob/master/47.md"],[22242,"Client Authentication","https://github.com/nostr-protocol/nips/blob/master/42.md"],[23194,"Wallet Request","https://github.com/nostr-protocol/nips/blob/master/47.md"],[23195,"Wallet Response","https://github.com/nostr-protocol/nips/blob/master/47.md"],[24133,"Nostr Connect","https://github.com/nostr-protocol/nips/blob/master/46.md"],[27235,"HTTP Auth","https://github.com/nostr-protocol/nips/blob/master/98.md"],[3e4,"Categorized People List","https://github.com/nostr-protocol/nips/blob/master/51.md"],[30001,"Categorized Bookmark List","https://github.com/nostr-protocol/nips/blob/master/51.md"],[30008,"Profile Badges","https://github.com/nostr-protocol/nips/blob/master/58.md"],[30009,"Badge Definition","https://github.com/nostr-protocol/nips/blob/master/58.md"],[30017,"Create or update a stall","https://github.com/nostr-protocol/nips/blob/master/15.md"],[30018,"Create or update a product","https://github.com/nostr-protocol/nips/blob/master/15.md"],[30023,"Long-Form Content","https://github.com/nostr-protocol/nips/blob/master/23.md"],[30024,"Draft Long-form Content","https://github.com/nostr-protocol/nips/blob/master/23.md"],[30078,"Application-specific Data","https://github.com/nostr-protocol/nips/blob/master/78.md"],[30311,"Live Event","https://github.com/nostr-protocol/nips/blob/master/53.md"],[30315,"User Statuses","https://github.com/nostr-protocol/nips/blob/master/38.md"],[30402,"Classified Listing","https://github.com/nostr-protocol/nips/blob/master/99.md"],[30403,"Draft Classified Listing","https://github.com/nostr-protocol/nips/blob/master/99.md"],[31922,"Date-Based Calendar Event","https://github.com/nostr-protocol/nips/blob/master/52.md"],[31923,"Time-Based Calendar Event","https://github.com/nostr-protocol/nips/blob/master/52.md"],[31924,"Calendar","https://github.com/nostr-protocol/nips/blob/master/52.md"],[31925,"Calendar Event RSVP","https://github.com/nostr-protocol/nips/blob/master/52.md"],[31989,"Handler recommendation","https://github.com/nostr-protocol/nips/blob/master/89.md"],[31990,"Handler information","https://github.com/nostr-protocol/nips/blob/master/89.md"],[34550,"Community Definition","https://github.com/nostr-protocol/nips/blob/master/72.md"]];var n={host:"",permission:"",key:"",event:null,remember:!1,profileType:"local"};function h(t){switch(t){case"getPubKey":return"Read public key";case"signEvent":return"Sign event";case"getRelays":return"Read relay list";case"nip04.encrypt":return"Encrypt private message (NIP-04)";case"nip04.decrypt":return"Decrypt private message (NIP-04)";case"nip44.encrypt":return"Encrypt private message (NIP-44)";case"nip44.decrypt":return"Decrypt private message (NIP-44)";default:return t}}function y(){if(n.permission!=="signEvent"||!n.event)return{};let t=b.find(([c])=>c===n.event.kind),[a,l,i]=t||["Unknown","Unknown","https://github.com/nostr-protocol/nips"];return{kind:a,desc:l,nip:i}}function w(){let t=document.getElementById("perm-host"),a=document.getElementById("perm-type"),l=document.getElementById("bunker-notice"),i=document.getElementById("event-kind-row"),c=document.getElementById("event-preview"),p=document.getElementById("event-preview-pre"),m=document.getElementById("event-kind-link"),d=document.getElementById("by-kind-label");t&&(t.textContent=n.host),a&&(a.textContent=h(n.permission)),l&&(l.style.display=n.profileType==="bunker"?"block":"none");let u=n.permission==="signEvent";if(i&&(i.style.display=u?"block":"none"),c&&(c.style.display=u?"block":"none"),d&&(d.style.display=u?"inline":"none"),u){let f=y();m&&(m.textContent=f.desc,m.href=f.nip),p&&(p.textContent=JSON.stringify(n.event,null,2))}}async function v(){await r.runtime.sendMessage({kind:"allowed",payload:n.key,origKind:n.permission,event:n.event,remember:n.remember,host:n.host}),await g()}async function E(){await r.runtime.sendMessage({kind:"denied",payload:n.key,origKind:n.permission,event:n.event,remember:n.remember,host:n.host}),await g()}async function g(){let t=await r.tabs.getCurrent();await r.tabs.update(t.openerTabId,{active:!0}),window.close()}async function P(){let t=y();t.nip&&await r.tabs.create({url:t.nip,active:!0})}async function x(){let t=new URLSearchParams(location.search);n.host=t.get("host"),n.permission=t.get("kind"),n.key=t.get("uuid"),n.event=JSON.parse(t.get("payload")),n.profileType=await r.runtime.sendMessage({kind:"getProfileType"}),w(),document.getElementById("allow-btn")?.addEventListener("click",v),document.getElementById("deny-btn")?.addEventListener("click",E),document.getElementById("remember")?.addEventListener("change",a=>{n.remember=a.target.checked}),document.getElementById("event-kind-link")?.addEventListener("click",a=>{a.preventDefault(),P()})}window.addEventListener("beforeunload",()=>(r.runtime.sendMessage({kind:"closePrompt"}),!0));document.addEventListener("DOMContentLoaded",x);})();
